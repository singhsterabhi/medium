var tabs={current_index:-1,invalid_tabs:['users','settings'],current_pm_index:-1,nicks:[],init:function(){$(document).bind("keydown","tab",tabs.next_tab);$(document).bind("keydown","shift+tab",tabs.prev_tab);$(document).bind("keydown","ctrl+l",tabs.close_current_pm);tabs.bind();},are_other_overlays:function(){return $(".tip_popup").is(":visible")||$("#login-box").is(":visible");},bind:function(){if($.chat_tabs==undefined){setTimeout(tabs.bind,2000);}
else{$.chat_tabs.after_tab_click=tabs.on_switch_tab;$.chat_tabs.after_private_message_received=tabs.after_private_message_received;$.chat_tabs.after_close_pm=tabs.after_close_pm;}},on_switch_tab:function(){if(tabs.is_pm_active()){var nick=$.chat_tabs.current_pm_nick;var tab=$.chat_tabs.pm_tab_map[nick];if(tab){tab.find("div.separator").remove();}
var msg=interpolate(gettext("PM conversation with %(username)s &lt;ctrl-l to close&gt;"),{username:nick},true);msg="<div class='separator'>"+msg+"</div>";$.add_system_message(msg,tab);}},get_current_index:function(){var i;$(".chat-box ul.buttons li").each(function(index,dom_element){var element=$(dom_element);if(element.hasClass("active")){i=index;return false;}});return i;},is_valid_tab:function(element){var tab=$(element).find("a").data("tab");return tabs.invalid_tabs.indexOf(tab)==-1;},is_pm_tab:function(element){return $(element).find("a").data("tab")=="pm";},tabs_size:function(){return $(".chat-box ul.buttons li").size();},after_private_message_received:function(){tabs.sync_nicks();tabs.sort_nicks();},after_close_pm:function(nick){new_nicks=new Array();for(var i=0;i<tabs.nicks.length;i++){if(tabs.nicks[i]!=nick){new_nicks.push(tabs.nicks[i]);}}
tabs.nicks=new_nicks;tabs.sort_nicks();},sync_nicks:function(){var keys=[];for(var key in $.chat_tabs.unread_pm_map){if((key!=null)&&($.chat_tabs.unread_pm_map[key]!=null)){if($.chat_tabs.unread_pm_map[key]>0){keys.push(key);}}}
for(var i=0;i<$.chat_tabs.opened_pms.length;i++){if($.chat_tabs.opened_pms[i]!=null){if(keys.indexOf($.chat_tabs.opened_pms[i])==-1){keys.push($.chat_tabs.opened_pms[i]);}}}
tabs.nicks=keys;return tabs.nicks;},sort_nicks:function(){tabs.nicks.sort(function(a,b){if($.chat_tabs.unread_pm_map[b]==$.chat_tabs.unread_pm_map[a]){if(a<b){return-1;}
if(a>b){return 1;}
return 0;}
return $.chat_tabs.unread_pm_map[b]-$.chat_tabs.unread_pm_map[a];});return tabs.nicks;},get_current_pm_idx:function(){var nick=$.chat_tabs.current_pm_nick;var nicks=tabs.nicks;for(var i=0;i<nicks.length;i++){if(nicks[i]==nick){return i;}}
return-1;},handle_pm_tab:function(next){var nicks=tabs.nicks;tabs.current_pm_index=tabs.get_current_pm_idx();var element=$(".chat-box .buttons li")[tabs.get_current_index()];var comes_from_not_pm=(!tabs.is_pm_tab(element));if(comes_from_not_pm&&next){tabs.current_pm_index=-1;}
if(comes_from_not_pm&&(!next)){tabs.current_pm_index=nicks.length;}
if(next){tabs.current_pm_index+=1;}
else{tabs.current_pm_index-=1;}
if((!next)&&(tabs.current_pm_index<0)){tabs.current_pm_index=-1;return false;}
if((next)&&(tabs.current_pm_index>=nicks.length)){tabs.current_pm_index=-1;return false;}
$.chat_tabs.open_pm(nicks[tabs.current_pm_index]);return true;},_has_unread_pms:function(){return $(".chat-box a[data-tab='pm'] .pm_count").is(":visible");},_has_unread_chats:function(){return $(".chat-box a[data-tab='chat'] .counter").is(":visible");},_get_first_unread_pm:function(){var nicks=tabs.nicks;for(var i=0;i<nicks.length;i++){var nick=nicks[i];if($.chat_tabs.unread_pm_map.hasOwnProperty(nick)){if($.chat_tabs.unread_pm_map[nick]>0){return nick;}}}
return null;},move_index:function(next){tabs.current_index=tabs.get_current_index();var element=$(".chat-box .buttons li")[tabs.current_index];if((next)&&tabs._has_unread_pms()){nick=tabs._get_first_unread_pm();if(nick!=null){$.chat_tabs.open_pm(nick);return null;}}
if((next)&&tabs._has_unread_chats()){return 0;}
if(tabs.is_pm_tab(element)){if(tabs.handle_pm_tab(next)){return null;}}
do{if(next){tabs.current_index=tabs.current_index+1;}
else{tabs.current_index=tabs.current_index-1;}
if((!next)&&(tabs.current_index<0)){tabs.current_index=tabs.tabs_size()-1;}
if((next)&&tabs.current_index>=tabs.tabs_size()){tabs.current_index=0;}
element=$(".chat-box .buttons li")[tabs.current_index];}while(!tabs.is_valid_tab(element));if(tabs.is_pm_tab(element)){tabs.handle_pm_tab(next);return null;}
return tabs.current_index;},move_tab:function(next){tabs.on_switch_tab();var index=tabs.move_index(next);if(index==null){return;}
$($(".chat-box ul.buttons li")[index]).find("a").click();},next_tab:function(){if(tabs.are_other_overlays()){return true;}
return tabs.move_tab(true);},prev_tab:function(){if(tabs.are_other_overlays()){return true;}
return tabs.move_tab(false);},is_pm_active:function(){return $("a[data-tab='pm']").parent().hasClass("active");},close_current_pm:function(){if(tabs.are_other_overlays()){return true;}
if(tabs.is_pm_active()){$.chat_tabs.close_pm($.chat_tabs.current_pm_nick);}}};$(document).ready(function(){tabs.init();});(function($){$(document).ready(function(){$("a.endless_more").live("click",function(){var container=$(this).closest(".endless_container");var loading=container.find(".endless_loading");$(this).hide();loading.show();var data="querystring_key="+$(this).attr("rel").split(" ")[0];$.get($(this).attr("href"),data,function(data){container.before(data);container.remove();});return false;});$("a.endless_page_link").live("click",function(){var data="querystring_key="+$(this).attr("rel").split(" ")[0];$(this).closest(".endless_page_template").load($(this).attr("href"),data);return false;});});})(jQuery);$(document).ready(function(){$.fn.mColorPicker.init.replace=false;$.fn.mColorPicker.defaults.imageFolder="https://ssl-ccstatic.highwebmedia.com/mColorPicker/images/";$.fn.mColorPicker.init.showLogo=false;$.fn.mColorPicker.init.allowTransparency=false;});(function($){var $o;$.fn.mColorPicker=function(options){$o=$.extend($.fn.mColorPicker.defaults,options);if($o.swatches.length<10)$o.swatches=$.fn.mColorPicker.defaults.swatches
if($("div#mColorPicker").length<1)$.fn.mColorPicker.drawPicker();if($('#css_disabled_color_picker').length<1)$('head').prepend('<style id="css_disabled_color_picker" type="text/css">.mColorPicker[disabled] + span, .mColorPicker[disabled="disabled"] + span, .mColorPicker[disabled="true"] + span {filter:alpha(opacity=50);-moz-opacity:0.5;-webkit-opacity:0.5;-khtml-opacity: 0.5;opacity: 0.5;}</style>');$('.mColorPicker').live('keyup',function(){try{$(this).css({'background-color':$(this).val()}).css({'color':$.fn.mColorPicker.textColor($(this).css('background-color'))}).trigger('change');}catch(r){}});$('.mColorPickerTrigger').live('click',function(){$.fn.mColorPicker.colorShow($(this).attr('id').replace('icp_',''));});this.each(function(){$.fn.mColorPicker.drawPickerTriggers($(this));});return this;};$.fn.mColorPicker.currentColor=false;$.fn.mColorPicker.currentValue=false;$.fn.mColorPicker.color=false;$.fn.mColorPicker.init={replace:'[type=color]',index:0,enhancedSwatches:true,allowTransparency:true,checkRedraw:'DOMUpdated',liveEvents:false,showLogo:true};$.fn.mColorPicker.defaults={imageFolder:'images/',swatches:["#ffffff","#ffff00","#00ff00","#00ffff","#0000ff","#ff00ff","#ff0000","#4c2b11","#3b3b3b","#000000"]};$.fn.mColorPicker.liveEvents=function(){$.fn.mColorPicker.init.liveEvents=true;if($.fn.mColorPicker.init.checkRedraw&&$.fn.mColorPicker.init.replace){$(document).bind($.fn.mColorPicker.init.checkRedraw+'.mColorPicker',function(){$('input[data-mcolorpicker!="true"]').filter(function(){return($.fn.mColorPicker.init.replace=='[type=color]')?this.getAttribute("type")=='color':$(this).is($.fn.mColorPicker.init.replace);}).mColorPicker();});}};$.fn.mColorPicker.drawPickerTriggers=function($t){if($t[0].nodeName.toLowerCase()!='input')return false;var id=$t.attr('id')||'color_'+$.fn.mColorPicker.init.index++,hidden=false;$t.attr('id',id);if($t.attr('text')=='hidden'||$t.attr('data-text')=='hidden')hidden=true;var color=$t.val(),width=($t.width()>0)?$t.width():parseInt($t.css('width'),10),height=($t.height())?$t.height():parseInt($t.css('height'),10),flt=$t.css('float'),image=(color=='transparent')?"url('"+$o.imageFolder+"/grid.gif')":'',colorPicker='';$('body').append('<span id="color_work_area"></span>');$('span#color_work_area').append($t.clone(true));colorPicker=$('span#color_work_area').html().replace(/type="color"/gi,'').replace(/input /gi,(hidden)?'input type="hidden"':'input type="text"');$('span#color_work_area').html('').remove();$t.after((hidden)?'<span style="cursor:pointer;border:1px solid black;float:'+flt+';width:'+width+'px;height:'+height+'px;" id="icp_'+id+'">&nbsp;</span>':'').after(colorPicker).remove();if(hidden){if($('#'+id).prop('class')){$('#icp_'+id).prop('class',$('#'+id).prop('class'));}
$('#icp_'+id).css({'background-color':color,'background-image':image,'display':'inline-block'}).addClass('mColorPickerTrigger');}else{$('#'+id).css({'background-color':color,'background-image':image}).css({'color':$.fn.mColorPicker.textColor($('#'+id).css('background-color'))}).after('<span style="cursor:pointer;" id="icp_'+id+'" class="mColorPickerTrigger"><img src="'+$o.imageFolder+'color.png" style="border:0;margin:0 0 0 3px" align="absmiddle"></span>').addClass('mColorPickerInput');}
$('#icp_'+id).attr('data-mcolorpicker','true');$('#'+id).addClass('mColorPicker');return $('#'+id);};$.fn.mColorPicker.drawPicker=function(){$(document.createElement("div")).attr("id","mColorPicker").css('display','none').html('<div id="mColorPickerWrapper"><div id="mColorPickerImg" class="mColor"></div><div id="mColorPickerImgGray" class="mColor"></div><div id="mColorPickerSwatches"><div class="mClear"></div></div><div id="mColorPickerFooter"><input type="text" size="8" id="mColorPickerInput"/></div></div>').appendTo("body");$(document.createElement("div")).attr("id","mColorPickerBg").css({'display':'none'}).appendTo("body");for(n=9;n>-1;n--){$(document.createElement("div")).attr({'id':'cell'+n,'class':"mPastColor"+((n>0)?' mNoLeftBorder':'')}).html('&nbsp;').prependTo("#mColorPickerSwatches");}
$('#mColorPicker').css({'border':'1px solid #ccc','color':'#fff','z-index':999998,'width':'194px','height':'184px','font-size':'12px','font-family':'times'});$('.mPastColor').css({'height':'18px','width':'18px','border':'1px solid #000','float':'left'});$('#colorPreview').css({'height':'50px'});$('.mNoLeftBorder').css({'border-left':0});$('.mClear').css({'clear':'both'});$('#mColorPickerWrapper').css({'position':'relative','border':'solid 1px gray','z-index':999999});$('#mColorPickerImg').css({'height':'128px','width':'192px','border':0,'cursor':'crosshair','background-image':"url('"+$o.imageFolder+"colorpicker.png')"});$('#mColorPickerImgGray').css({'height':'8px','width':'192px','border':0,'cursor':'crosshair','background-image':"url('"+$o.imageFolder+"graybar.jpg')"});$('#mColorPickerInput').css({'border':'solid 1px gray','font-size':'10pt','margin':'3px','width':'80px'});$('#mColorPickerImgGrid').css({'border':0,'height':'20px','width':'20px','vertical-align':'text-bottom'});$('#mColorPickerSwatches').css({'border-right':'1px solid #000'});$('#mColorPickerFooter').css({'background-image':"url('"+$o.imageFolder+"grid.gif')",'position':'relative','height':'26px'});if($.fn.mColorPicker.init.allowTransparency)$('#mColorPickerFooter').prepend('<span id="mColorPickerTransparent" class="mColor" style="font-size:16px;color:#000;padding-right:30px;padding-top:3px;cursor:pointer;overflow:hidden;float:right;">transparent</span>');if($.fn.mColorPicker.init.showLogo)$('#mColorPickerFooter').prepend('<a href="http://meta100.com/" title="Meta100 - Designing Fun" alt="Meta100 - Designing Fun" style="float:right;" target="_blank"><img src="'+$o.imageFolder+'meta100.png" title="Meta100 - Designing Fun" alt="Meta100 - Designing Fun" style="border:0;border-left:1px solid #aaa;right:0;position:absolute;"/></a>');$("#mColorPickerBg").click($.fn.mColorPicker.closePicker);var swatch=$.fn.mColorPicker.getCookie('swatches'),i=0;if(typeof swatch=='string')swatch=swatch.split('||');if(swatch==null||$.fn.mColorPicker.init.enhancedSwatches||swatch.length<10)swatch=$o.swatches;$(".mPastColor").each(function(){$(this).css('background-color',swatch[i++].toLowerCase());});};$.fn.mColorPicker.closePicker=function(){$(".mColor, .mPastColor, #mColorPickerInput, #mColorPickerWrapper").unbind();$("#mColorPickerBg").hide();$("#mColorPicker").fadeOut()};$.fn.mColorPicker.colorShow=function(id){var $e=$("#icp_"+id);pos=$e.offset(),$i=$("#"+id);hex=$i.attr('data-hex')||$i.attr('hex'),pickerTop=pos.top+$e.outerHeight(),pickerLeft=pos.left,$d=$(document),$m=$("#mColorPicker");if($i.attr('disabled'))return false;if(pickerTop+$m.height()>$d.height())pickerTop=pos.top-$m.height();if(pickerLeft+$m.width()>$d.width())pickerLeft=pos.left-$m.width()+$e.outerWidth();$m.css({'top':(pickerTop)+"px",'left':(pickerLeft)+"px",'position':'absolute'}).fadeIn("fast");$("#mColorPickerBg").css({'z-index':999990,'background':'black','opacity':.01,'position':'absolute','top':0,'left':0,'width':parseInt($d.width(),10)+'px','height':parseInt($d.height(),10)+'px'}).show();var def=$i.val();$('#colorPreview span').text(def);$('#colorPreview').css('background',def);$('#color').val(def);if($('#'+id).attr('data-text'))$.fn.mColorPicker.currentColor=$e.css('background-color');else $.fn.mColorPicker.currentColor=$i.css('background-color');if(hex=='true')$.fn.mColorPicker.currentColor=$.fn.mColorPicker.RGBtoHex($.fn.mColorPicker.currentColor);$("#mColorPickerInput").val($.fn.mColorPicker.currentColor);$('.mColor, .mPastColor').bind('mousemove',function(e){var offset=$(this).offset();$.fn.mColorPicker.color=$(this).css("background-color");if($(this).hasClass('mPastColor')&&hex=='true')$.fn.mColorPicker.color=$.fn.mColorPicker.RGBtoHex($.fn.mColorPicker.color);else if($(this).hasClass('mPastColor')&&hex!='true')$.fn.mColorPicker.color=$.fn.mColorPicker.hexToRGB($.fn.mColorPicker.color);else if($(this).attr('id')=='mColorPickerTransparent')$.fn.mColorPicker.color='transparent';else if(!$(this).hasClass('mPastColor'))$.fn.mColorPicker.color=$.fn.mColorPicker.whichColor(e.pageX-offset.left,e.pageY-offset.top+(($(this).attr('id')=='mColorPickerImgGray')?128:0),hex);$.fn.mColorPicker.setInputColor(id,$.fn.mColorPicker.color);}).click(function(){$.fn.mColorPicker.colorPicked(id);});$('#mColorPickerInput').bind('keyup',function(e){try{$.fn.mColorPicker.color=$('#mColorPickerInput').val();$.fn.mColorPicker.setInputColor(id,$.fn.mColorPicker.color);if(e.which==13)$.fn.mColorPicker.colorPicked(id);}catch(r){}}).bind('blur',function(){$.fn.mColorPicker.setInputColor(id,$.fn.mColorPicker.currentColor);});$('#mColorPickerWrapper').bind('mouseleave',function(){$.fn.mColorPicker.setInputColor(id,$.fn.mColorPicker.currentColor);});};$.fn.mColorPicker.setInputColor=function(id,color){var image=(color=='transparent')?"url('"+$o.imageFolder+"grid.gif')":'',textColor=$.fn.mColorPicker.textColor(color);if($('#'+id).attr('data-text')||$('#'+id).prop('text'))$("#icp_"+id).css({'background-color':color,'background-image':image});$("#"+id).val(color).css({'background-color':color,'background-image':image,'color':textColor}).trigger('change');$("#mColorPickerInput").val(color);};$.fn.mColorPicker.textColor=function(val){if(typeof val=='undefined'||val=='transparent')return"black";val=$.fn.mColorPicker.RGBtoHex(val);return(parseInt(val.substr(1,2),16)+parseInt(val.substr(3,2),16)+parseInt(val.substr(5,2),16)<400)?'white':'black';};$.fn.mColorPicker.setCookie=function(name,value,days){var cookie_string=name+"="+escape(value),expires=new Date();expires.setDate(expires.getDate()+days);cookie_string+="; expires="+expires.toGMTString();document.cookie=cookie_string;};$.fn.mColorPicker.getCookie=function(name){var results=document.cookie.match('(^|;) ?'+name+'=([^;]*)(;|$)');if(results)return(unescape(results[2]));else return null;};$.fn.mColorPicker.colorPicked=function(id){$.fn.mColorPicker.closePicker();if($.fn.mColorPicker.init.enhancedSwatches)$.fn.mColorPicker.addToSwatch();$("#"+id).trigger('colorpicked',[id,$('#mColorPickerInput').val()]);};$.fn.mColorPicker.addToSwatch=function(color){var swatch=[]
i=0;if(typeof color=='string')$.fn.mColorPicker.color=color.toLowerCase();$.fn.mColorPicker.currentValue=$.fn.mColorPicker.currentColor=$.fn.mColorPicker.color;if($.fn.mColorPicker.color!='transparent')swatch[0]=$.fn.mColorPicker.color.toLowerCase();$('.mPastColor').each(function(){$.fn.mColorPicker.color=$(this).css('background-color').toLowerCase();if($.fn.mColorPicker.color!=swatch[0]&&$.fn.mColorPicker.RGBtoHex($.fn.mColorPicker.color)!=swatch[0]&&$.fn.mColorPicker.hexToRGB($.fn.mColorPicker.color)!=swatch[0]&&swatch.length<10)swatch[swatch.length]=$.fn.mColorPicker.color;$(this).css('background-color',swatch[i++])});if($.fn.mColorPicker.init.enhancedSwatches)$.fn.mColorPicker.setCookie('swatches',swatch.join('||'),365);};$.fn.mColorPicker.whichColor=function(x,y,hex){var colorR=colorG=colorB=255;if(x<32){colorG=x*8;colorB=0;}else if(x<64){colorR=256-(x-32)*8;colorB=0;}else if(x<96){colorR=0;colorB=(x-64)*8;}else if(x<128){colorR=0;colorG=256-(x-96)*8;}else if(x<160){colorR=(x-128)*8;colorG=0;}else{colorG=0;colorB=256-(x-160)*8;}
if(y<64){colorR+=(256-colorR)*(64-y)/64;colorG+=(256-colorG)*(64-y)/64;colorB+=(256-colorB)*(64-y)/64;}else if(y<=128){colorR-=colorR*(y-64)/64;colorG-=colorG*(y-64)/64;colorB-=colorB*(y-64)/64;}else if(y>128){colorR=colorG=colorB=256-(x/192*256);}
colorR=Math.round(Math.min(colorR,255));colorG=Math.round(Math.min(colorG,255));colorB=Math.round(Math.min(colorB,255));if(hex=='true'){colorR=colorR.toString(16);colorG=colorG.toString(16);colorB=colorB.toString(16);if(colorR.length<2)colorR=0+colorR;if(colorG.length<2)colorG=0+colorG;if(colorB.length<2)colorB=0+colorB;return"#"+colorR+colorG+colorB;}
return"rgb("+colorR+', '+colorG+', '+colorB+')';};$.fn.mColorPicker.RGBtoHex=function(color){color=color.toLowerCase();if(typeof color=='undefined')return'';if(color.indexOf('#')>-1&&color.length>6)return color;if(color.indexOf('rgb')<0)return color;if(color.indexOf('#')>-1){return'#'+color.substr(1,1)+color.substr(1,1)+color.substr(2,1)+color.substr(2,1)+color.substr(3,1)+color.substr(3,1);}
var hexArray=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],decToHex="#",code1=0;color=color.replace(/[^0-9,]/g,'').split(",");for(var n=0;n<color.length;n++){code1=Math.floor(color[n]/16);decToHex+=hexArray[code1]+hexArray[color[n]-code1*16];}
return decToHex;};$.fn.mColorPicker.hexToRGB=function(color){color=color.toLowerCase();if(typeof color=='undefined')return'';if(color.indexOf('rgb')>-1)return color;if(color.indexOf('#')<0)return color;var c=color.replace('#','');if(c.length<6)c=c.substr(0,1)+c.substr(0,1)+c.substr(1,1)+c.substr(1,1)+c.substr(2,1)+c.substr(2,1);return'rgb('+parseInt(c.substr(0,2),16)+', '+parseInt(c.substr(2,2),16)+', '+parseInt(c.substr(4,2),16)+')';};$(document).ready(function(){if($.fn.mColorPicker.init.replace){$('input[data-mcolorpicker!="true"]').filter(function(){return($.fn.mColorPicker.init.replace=='[type=color]')?this.getAttribute("type")=='color':$(this).is($.fn.mColorPicker.init.replace);}).mColorPicker();$.fn.mColorPicker.liveEvents();}});})(jQuery);$(document).ready(function(){var tabs={photos_url:$('.info-user a[data-tab="photos"]').attr('href'),settings_url:$('.info-user a[data-tab="settings"]').attr('href'),settings_button:$('.info-user a[data-tab="settings"]'),contest_url:$('.info-user a[data-tab="contest"]').attr('href'),memberships_url:$('.info-user a[data-tab="memberships"]').attr('href'),token_rate:0,tab_handles:{photos:null,settings:null,contest:null,memberships:null,token_stats:$(".info-user div.token_stats"),share_and_earn:$(".info-user div.share_and_earn"),leaderboard:$(".info-user div.leaderboard"),bio:$(".info-user div.bio"),apps_and_bots:$(".info-user div.apps_and_bots")},init:function(){$(".info-user .buttons li a").click(tabs.on_tab_button_click);$(".private_settings .value").click(tabs.on_private_settings_clicked);$(".group_show_disabled a").click(tabs.on_groupshow_settings_clicked);},on_groupshow_settings_clicked:function(){tabs._disable_tabs();tabs.settings_button.parent().addClass('active');tabs._show_settings_tab(function(){$('#id_allow_group_shows').focus();});return false;},on_private_settings_clicked:function(){tabs._disable_tabs();tabs.settings_button.parent().addClass('active');tabs._show_settings_tab(function(){$('#id_allow_private_shows').focus();});return false;},on_tab_button_click:function(event){tabs._disable_tabs();$(this).parent().addClass('active');if($(this).data('tab')=='bio'){tabs.tab_handles.bio.show();}else if($(this).data('tab')=='photos'){tabs.refresh_photos();}else if($(this).data('tab')=='apps_and_bots'){tabs._show_apps_and_bots();}else if($(this).data('tab')=='settings'){tabs.refresh_settings();}else if($(this).data('tab')=='contest'){tabs.refresh_contest();}else if($(this).data('tab')=='memberships'){tabs.refresh_memberships();}else if($(this).data('tab')=='token_stats'){tabs._show_token_stats();}else if($(this).data('tab')=='share_and_earn'){tabs._show_share_and_earn();}else if($(this).data('tab')=='leaderboard'){tabs._show_leaderboard();}
return false;},refresh_photos:function(){if(tabs.tab_handles.photos){tabs.tab_handles.photos.remove();tabs.tab_handles.photos=null;}
tabs._show_photos_tab();},refresh_contest:function(){if(tabs.tab_handles.contest){tabs.tab_handles.contest.remove();tabs.tab_handles.contest=null;}
tabs._show_contest_tab();},refresh_memberships:function(){if(tabs.tab_handles.memberships){tabs.tab_handles.memberships.remove();tabs.tab_handles.memberships=null;}
tabs._show_memberships_tab();},refresh_settings:function(callback){if(tabs.tab_handles.settings){tabs.tab_handles.settings.remove();tabs.tab_handles.settings=null;}
tabs._show_settings_tab(callback);},_show_leaderboard:function(){tabs._load_tab(tabs.tab_handles.leaderboard,$(".info-user .buttons a[data-tab='leaderboard']").attr('href'));},_show_token_stats:function(){tabs._load_tab(tabs.tab_handles.token_stats,$(".info-user .buttons a[data-tab='token_stats']").attr('href'),function(){tabs.tab_handles.token_stats.find('.refreshstats').click(tabs._show_token_stats);tabs.tab_handles.token_stats.find('#cashout_form').submit(tabs._on_token_transfer);tabs.tab_handles.token_stats.find('#cashout_to_ads_form').submit(tabs._on_token_transfer_to_ads);tabs.tab_handles.token_stats.find('.account_activity').scroll(tabs._on_token_stats_scroll);tabs.token_rate=parseFloat(tabs.tab_handles.token_stats.find("#token_rate").text());});},_on_token_stats_scroll:function(){var $this=$(this);if($this.scrollTop()+300>=this.scrollHeight-$this.height()){$this.find("a.endless_more").click();}},_on_token_transfer_to_ads:function(){var num_tokens=parseInt($(this).find("#id_transfer_amount_ads").val());var token_balance=parseInt(tabs.tab_handles.token_stats.find('.token_balance').text());var cash_amount=Math.round(num_tokens*0.065*100)/100
if(isNaN(num_tokens)|num_tokens<1){alert("Invalid token amount.");return false;}
if(num_tokens>token_balance){alert("Insufficient tokens.");return false;}
var msg=interpolate(gettext("Convert %(num_tokens)s to \$%(cash_amount)s of ad credit"),{num_tokens:num_tokens,cash_amount:cash_amount},true);if(confirm(msg)){$.ajax({type:'POST',url:$("#cashout_to_ads_form").attr('action'),data:$("#cashout_to_ads_form").serialize(),cache:false,success:function(data){if(data=='OK'){window.location="/";}else{alert(data);}
return false;},error:function(e){alert("Error "+e);}});}
return false;},_on_token_transfer:function(){var num_tokens=parseInt($(this).find("#id_transfer_amount").val());var token_balance=parseInt(tabs.tab_handles.token_stats.find('.token_balance').text());var cash_amount=parseFloat(Math.floor(num_tokens*tabs.token_rate*100)/100).toFixed(2);if(isNaN(num_tokens)||num_tokens<1){alert("Invalid token amount.");return false;}
if(num_tokens>token_balance){alert("Insufficient tokens.");return false;}
var msg=interpolate(gettext("Convert %(num_tokens)s to \$%(cash_amount)s"),{num_tokens:num_tokens,cash_amount:cash_amount},true);return confirm(msg);},_show_share_and_earn:function(){tabs._load_tab(tabs.tab_handles.share_and_earn,$(".info-user .buttons a[data-tab='share_and_earn']").attr('href'));},_show_apps_and_bots:function(){tabs._load_tab(tabs.tab_handles.apps_and_bots,$(".info-user .buttons a[data-tab='apps_and_bots']").attr('href'),function(){$(".stop_link").click(function(){$.ajax({url:$(this).attr('name'),dataType:'text',data:'',type:'POST',success:function(response){$.mydefchatconn('app_tab_refresh');}});});$('#toggle_appserver').one('click',function(){$.ajax({url:$(this).attr('name'),success:function(response){$.mydefchatconn('app_tab_refresh');},error:function(){alert("An Error Occurred")}});});});},_load_tab:function(tab,target,func){tab.show();tab.html(gettext("loading . . ."));if(func){tab.load(target,func);}else{tab.load(target);}},_show_photos_tab:function(){if(tabs.tab_handles.photos===null){var html="<div class='bottompanel fixedheightbottompanel photopages'>"+gettext("loading . . .")+"</div>";tabs.tab_handles.photos=$(html);tabs.tab_handles.bio.after(tabs.tab_handles.photos);tabs.tab_handles.photos.load(tabs.photos_url,function(){tabs.tab_handles.photos.scroll(tabs._on_photos_scroll);tabs.tab_handles.photos.find('.refreshphotos').click(tabs.refresh_photos);});}else{tabs.tab_handles.photos.show();}},_show_settings_tab:function(callback){if(tabs.tab_handles.settings===null){var html="<div class='bottompanel accountsettings'>"+gettext("loading . . .")+"</div>";tabs.tab_handles.settings=$(html);tabs.tab_handles.bio.after(tabs.tab_handles.settings);tabs.tab_handles.settings.load(tabs.settings_url,function(){tabs._init_settings_form();if(callback){callback();}});}else{tabs.tab_handles.settings.show();if(callback){callback();}}},_init_settings_form:function(){tabs.tab_handles.settings.find('a').attr('target','_blank');tabs.tab_handles.settings.find('form').submit(tabs._on_settings_submit);tabs.tab_handles.settings.find('#id_block_from_countries').listselect({listTitle:gettext('Able to view'),selectedTitle:gettext('Blocked countries')});tabs.tab_handles.settings.find('#id_block_from_states').listselect({listTitle:gettext('Able to view'),selectedTitle:gettext('Blocked states')});apply_input_tab_override($('form#broadcaster_settings :input'));},_on_settings_submit:function(){$.ajax({type:'POST',url:$(this).attr('action'),data:$(this).serialize(),dataType:'json',cache:false,success:function(data){tabs.tab_handles.settings.html(data.html);tabs._init_settings_form();if(data.result=='success'){alert(gettext("Settings saved"));}
return false;}});return false;},_show_contest_tab:function(){if(tabs.tab_handles.contest===null){var html="<div class='bottompanel conteststats'>"+gettext("loading . . .")+"</div>";tabs.tab_handles.contest=$(html);tabs.tab_handles.bio.after(tabs.tab_handles.contest);tabs.tab_handles.contest.load(tabs.contest_url,function(){tabs.tab_handles.contest.find('.refreshstats').click(tabs.refresh_contest);});}else{tabs.tab_handles.contest.show();}},_show_memberships_tab:function(){if(tabs.tab_handles.memberships===null){var html="<div class='bottompanel memberships_list'>"+gettext("loading . . .")+"</div>";tabs.tab_handles.memberships=$(html);tabs.tab_handles.bio.after(tabs.tab_handles.memberships);tabs.tab_handles.memberships.load(tabs.memberships_url);}else{tabs.tab_handles.memberships.show();}},_on_photos_scroll:function(){var $this=$(this);if($this.scrollTop()+500>=this.scrollHeight-$this.height()){$this.find("a.endless_more").click();}},_disable_tabs:function(){$(".info-user .buttons li.active").removeClass('active');$(".info-user > div").hide();$(".info-user .headline").show();}};tabs.init();var bio={bio_div:$(document).find('div.bio'),init:function(){$('a.editbio').live('click',bio.on_edit_click);},on_edit_click:function(){bio.bio_div.load($(this).attr('href'),bio._init_form);return false;},on_form_submit:function(){var next=$(this).find('input[name="next"]').val();$.ajax({type:'POST',url:$(this).attr('action'),data:$(this).serialize(),dataType:'json',cache:false,success:function(data){if(data.result=='success'){bio.bio_div.load(next);}else{bio.bio_div.html(data.html);bio._init_form();}
return false;}});return false;},_init_form:function(){bio.bio_div.find('textarea').attr('rows','1');bio.bio_div.find('textarea').elastic();bio.bio_div.find('form').submit(bio.on_form_submit);bio.bio_div.find('.canceleditbio').click(bio._on_cancel_edit_click);},_on_cancel_edit_click:function(){bio.bio_div.load($(this).attr('href'));return false;}};bio.init();var follow={on_follow_click:function(){var link=$(this);var loader=$(".button_follow_dim");if(login_required()){return false;}
link.parent().hide();loader.show();$.ajax({url:link.data('followurl'),type:'POST',data:{'csrf_token':link.data('csrf')},success:function(){link.parent().removeClass('button_follow');link.parent().addClass('button_unfollow');link.html(link.data('unfollowtext'));loader.hide();link.parent().show();}});return false;},on_unfollow_click:function(){var link=$(this);var loader=$(".button_unfollow_dim");link.parent().hide();loader.show();$.ajax({url:link.data('unfollowurl'),type:'POST',data:{'csrf_token':link.data('csrf')},success:function(){link.parent().removeClass('button_unfollow');link.parent().addClass('button_follow');link.html(link.data('followtext'));loader.hide();link.parent().show();}});return false;}};$(".button_follow a").live('click',follow.on_follow_click);$(".button_unfollow a").live('click',follow.on_unfollow_click);var report={_div_overlay:$("#report_popup"),on_cancel:function(){report._clear_and_close();return false;},on_submit:function(){var $this=$(this);if($this.find('select[name="category"]').val()===""){alert(gettext("Please choose a category."));return false;}
if($this.find('select[name="category"]').val()=="other"&&$this.find('textarea[name="additional_comments"]').val().length<3){alert(gettext('Please add a desciption of the abuse being reported.'));return false;}
$.ajax({type:'POST',url:$this.attr('action'),data:$this.serialize(),dataType:'json',cache:false,success:function(data){if(data['result']==='success'){report._clear_and_close();alert(gettext("Your abuse report has been submitted."));}else{alert("An error occurred.");}},error:function(request,status,error){alert(request.responseText);}});return false;},overlay_toggle:function(){report._div_overlay.toggle();if(report._div_overlay.is(":visible")){report._div_overlay.find('textarea').focus();report._div_overlay.find('textarea').select();$.mydefchatconn('disable_html5_video_controls');}
else{$.mydefchatconn('enable_html5_video_controls');}},init:function(){$("#report_popup_link").click(report.overlay_toggle);report._div_overlay.find(".button_abuse_cancel a").click(report.on_cancel);report._div_overlay.find(".button_abuse_report a").click(function(){report._div_overlay.find("form").submit();return false;});report._div_overlay.find("form").submit(report.on_submit);$(".disputerecording").live('click',function(){var msg=gettext("Are the reports that this is a recording false?\n\nPlease only vote if you have confirmed that this cam is live.\n\nAsk something like \"hold up 2 fingers to prove you are live\" first!");if(confirm(msg)){$.ajax({type:'POST',url:$("#report_popup form").attr('action'),data:{'category':'recordingdispute'},dataType:'json',cache:false,success:function(data){if(data['result']==='success'){report._clear_and_close();alert(gettext("Your report has been submitted."));}else{alert("An error occurred.");}}});}});},_clear_and_close:function(){report._div_overlay.hide();report._div_overlay.find('textarea').val("");$.mydefchatconn('enable_html5_video_controls');}};report.init();$('a.dismiss_notice').click(function(){var d=new Date;var dismissable_div=$(this).closest('.dismissable_notice');d.setTime(d.getTime()+1000*60*60*24*60);$.cookie(dismissable_div.data('cookie'),'1',{expires:d,path:'/'});$(dismissable_div).hide();return false;});$('.dismissable_notice').each(function(){if($.cookie($(this).data('cookie'))!='1'){$(this).show();}});$("a.deletephotolink").live('click',function(){var deletelink=$(this);if(confirm(gettext("Are you sure you want to delete?"))){$.post(deletelink.attr('href'),function(){deletelink.closest('.image_container').remove()});}
return false;});$("a.disablephotoslink, a.enablephotoslink").live('click',function(){if(confirm(gettext("Are you sure?"))){$.post($(this).attr('href'),{'foo':'bar'},function(){tabs.refresh_photos();});}
return false;});$('a[rel*=facebox]').live('mousedown',function(){$(this).facebox();});});