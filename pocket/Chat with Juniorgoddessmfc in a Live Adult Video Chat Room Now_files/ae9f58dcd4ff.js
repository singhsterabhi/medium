var MEDIA_URL='https://ssl-ccstatic.highwebmedia.com/';function apply_input_tab_override(inputs){inputs.bind('keydown','tab',function(e){e.preventDefault();var input_to=null;if(e.shiftKey){input_to=inputs.get(inputs.index(this)-1);}else{input_to=inputs.get(inputs.index(this)+1);}
if(input_to){input_to.focus();}else{inputs[0].focus();}});}
(function(c,j){function k(a,b){var d=a.nodeName.toLowerCase();if("area"===d){b=a.parentNode;d=b.name;if(!a.href||!d||b.nodeName.toLowerCase()!=="map")return false;a=c("img[usemap=#"+d+"]")[0];return!!a&&l(a)}return(/input|select|textarea|button|object/.test(d)?!a.disabled:"a"==d?a.href||b:b)&&l(a)}function l(a){return!c(a).parents().andSelf().filter(function(){return c.curCSS(this,"visibility")==="hidden"||c.expr.filters.hidden(this)}).length}c.ui=c.ui||{};if(!c.ui.version){c.extend(c.ui,{version:"1.8.16",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}});c.fn.extend({propAttr:c.fn.prop||c.fn.attr,_focus:c.fn.focus,focus:function(a,b){return typeof a==="number"?this.each(function(){var d=this;setTimeout(function(){c(d).focus();b&&b.call(d)},a)}):this._focus.apply(this,arguments)},scrollParent:function(){var a;a=c.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(c.curCSS(this,"position",1))&&/(auto|scroll)/.test(c.curCSS(this,"overflow",1)+c.curCSS(this,"overflow-y",1)+c.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(c.curCSS(this,"overflow",1)+c.curCSS(this,"overflow-y",1)+c.curCSS(this,"overflow-x",1))}).eq(0);return/fixed/.test(this.css("position"))||!a.length?c(document):a},zIndex:function(a){if(a!==j)return this.css("zIndex",a);if(this.length){a=c(this[0]);for(var b;a.length&&a[0]!==document;){b=a.css("position");if(b==="absolute"||b==="relative"||b==="fixed"){b=parseInt(a.css("zIndex"),10);if(!isNaN(b)&&b!==0)return b}a=a.parent()}}return 0},disableSelection:function(){return this.bind((c.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});c.each(["Width","Height"],function(a,b){function d(f,g,m,n){c.each(e,function(){g-=parseFloat(c.curCSS(f,"padding"+this,true))||0;if(m)g-=parseFloat(c.curCSS(f,"border"+this+"Width",true))||0;if(n)g-=parseFloat(c.curCSS(f,"margin"+this,true))||0});return g}var e=b==="Width"?["Left","Right"]:["Top","Bottom"],h=b.toLowerCase(),i={innerWidth:c.fn.innerWidth,innerHeight:c.fn.innerHeight,outerWidth:c.fn.outerWidth,outerHeight:c.fn.outerHeight};c.fn["inner"+b]=function(f){if(f===j)return i["inner"+b].call(this);return this.each(function(){c(this).css(h,d(this,f)+"px")})};c.fn["outer"+b]=function(f,g){if(typeof f!=="number")return i["outer"+b].call(this,f);return this.each(function(){c(this).css(h,d(this,f,true,g)+"px")})}});c.extend(c.expr[":"],{data:function(a,b,d){return!!c.data(a,d[3])},focusable:function(a){return k(a,!isNaN(c.attr(a,"tabindex")))},tabbable:function(a){var b=c.attr(a,"tabindex"),d=isNaN(b);return(d||b>=0)&&k(a,!d)}});c(function(){var a=document.body,b=a.appendChild(b=document.createElement("div"));c.extend(b.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});c.support.minHeight=b.offsetHeight===100;c.support.selectstart="onselectstart"in b;a.removeChild(b).style.display="none"});c.extend(c.ui,{plugin:{add:function(a,b,d){a=c.ui[a].prototype;for(var e in d){a.plugins[e]=a.plugins[e]||[];a.plugins[e].push([b,d[e]])}},call:function(a,b,d){if((b=a.plugins[b])&&a.element[0].parentNode)for(var e=0;e<b.length;e++)a.options[b[e][0]]&&b[e][1].apply(a.element,d)}},contains:function(a,b){return document.compareDocumentPosition?a.compareDocumentPosition(b)&16:a!==b&&a.contains(b)},hasScroll:function(a,b){if(c(a).css("overflow")==="hidden")return false;b=b&&b==="left"?"scrollLeft":"scrollTop";var d=false;if(a[b]>0)return true;a[b]=1;d=a[b]>0;a[b]=0;return d},isOverAxis:function(a,b,d){return a>b&&a<b+d},isOver:function(a,b,d,e,h,i){return c.ui.isOverAxis(a,d,h)&&c.ui.isOverAxis(b,e,i)}})}})(jQuery);(function(b,j){if(b.cleanData){var k=b.cleanData;b.cleanData=function(a){for(var c=0,d;(d=a[c])!=null;c++)try{b(d).triggerHandler("remove")}catch(e){}k(a)}}else{var l=b.fn.remove;b.fn.remove=function(a,c){return this.each(function(){if(!c)if(!a||b.filter(a,[this]).length)b("*",this).add([this]).each(function(){try{b(this).triggerHandler("remove")}catch(d){}});return l.call(b(this),a,c)})}}b.widget=function(a,c,d){var e=a.split(".")[0],f;a=a.split(".")[1];f=e+"-"+a;if(!d){d=c;c=b.Widget}b.expr[":"][f]=function(h){return!!b.data(h,a)};b[e]=b[e]||{};b[e][a]=function(h,g){arguments.length&&this._createWidget(h,g)};c=new c;c.options=b.extend(true,{},c.options);b[e][a].prototype=b.extend(true,c,{namespace:e,widgetName:a,widgetEventPrefix:b[e][a].prototype.widgetEventPrefix||a,widgetBaseClass:f},d);b.widget.bridge(a,b[e][a])};b.widget.bridge=function(a,c){b.fn[a]=function(d){var e=typeof d==="string",f=Array.prototype.slice.call(arguments,1),h=this;d=!e&&f.length?b.extend.apply(null,[true,d].concat(f)):d;if(e&&d.charAt(0)==="_")return h;e?this.each(function(){var g=b.data(this,a),i=g&&b.isFunction(g[d])?g[d].apply(g,f):g;if(i!==g&&i!==j){h=i;return false}}):this.each(function(){var g=b.data(this,a);g?g.option(d||{})._init():b.data(this,a,new c(d,this))});return h}};b.Widget=function(a,c){arguments.length&&this._createWidget(a,c)};b.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(a,c){b.data(c,this.widgetName,this);this.element=b(c);this.options=b.extend(true,{},this.options,this._getCreateOptions(),a);var d=this;this.element.bind("remove."+this.widgetName,function(){d.destroy()});this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return b.metadata&&b.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(a,c){var d=a;if(arguments.length===0)return b.extend({},this.options);if(typeof a==="string"){if(c===j)return this.options[a];d={};d[a]=c}this._setOptions(d);return this},_setOptions:function(a){var c=this;b.each(a,function(d,e){c._setOption(d,e)});return this},_setOption:function(a,c){this.options[a]=c;if(a==="disabled")this.widget()[c?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",c);return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_trigger:function(a,c,d){var e=this.options[a];c=b.Event(c);c.type=(a===this.widgetEventPrefix?a:this.widgetEventPrefix+a).toLowerCase();d=d||{};if(c.originalEvent){a=b.event.props.length;for(var f;a;){f=b.event.props[--a];c[f]=c.originalEvent[f]}}this.element.trigger(c,d);return!(b.isFunction(e)&&e.call(this.element[0],c,d)===false||c.isDefaultPrevented())}}})(jQuery);(function(b){var d=false;b(document).mouseup(function(){d=false});b.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var a=this;this.element.bind("mousedown."+this.widgetName,function(c){return a._mouseDown(c)}).bind("click."+this.widgetName,function(c){if(true===b.data(c.target,a.widgetName+".preventClickEvent")){b.removeData(c.target,a.widgetName+".preventClickEvent");c.stopImmediatePropagation();return false}});this.started=false},_mouseDestroy:function(){this.element.unbind("."+
this.widgetName)},_mouseDown:function(a){if(!d){this._mouseStarted&&this._mouseUp(a);this._mouseDownEvent=a;var c=this,f=a.which==1,g=typeof this.options.cancel=="string"&&a.target.nodeName?b(a.target).closest(this.options.cancel).length:false;if(!f||g||!this._mouseCapture(a))return true;this.mouseDelayMet=!this.options.delay;if(!this.mouseDelayMet)this._mouseDelayTimer=setTimeout(function(){c.mouseDelayMet=true},this.options.delay);if(this._mouseDistanceMet(a)&&this._mouseDelayMet(a)){this._mouseStarted=this._mouseStart(a)!==false;if(!this._mouseStarted){a.preventDefault();return true}}true===b.data(a.target,this.widgetName+".preventClickEvent")&&b.removeData(a.target,this.widgetName+".preventClickEvent");this._mouseMoveDelegate=function(e){return c._mouseMove(e)};this._mouseUpDelegate=function(e){return c._mouseUp(e)};b(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate);a.preventDefault();return d=true}},_mouseMove:function(a){if(b.browser.msie&&!(document.documentMode>=9)&&!a.button)return this._mouseUp(a);if(this._mouseStarted){this._mouseDrag(a);return a.preventDefault()}if(this._mouseDistanceMet(a)&&this._mouseDelayMet(a))(this._mouseStarted=this._mouseStart(this._mouseDownEvent,a)!==false)?this._mouseDrag(a):this._mouseUp(a);return!this._mouseStarted},_mouseUp:function(a){b(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate);if(this._mouseStarted){this._mouseStarted=false;a.target==this._mouseDownEvent.target&&b.data(a.target,this.widgetName+".preventClickEvent",true);this._mouseStop(a)}return false},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return true}})})(jQuery);(function(e){e.widget("ui.resizable",e.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:false,animate:false,animateDuration:"slow",animateEasing:"swing",aspectRatio:false,autoHide:false,containment:false,ghost:false,grid:false,handles:"e,s,se",helper:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1E3},_create:function(){var b=this,a=this.options;this.element.addClass("ui-resizable");e.extend(this,{_aspectRatio:!!a.aspectRatio,aspectRatio:a.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:a.helper||a.ghost||a.animate?a.helper||"ui-resizable-helper":null});if(this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)){/relative/.test(this.element.css("position"))&&e.browser.opera&&this.element.css({position:"relative",top:"auto",left:"auto"});this.element.wrap(e('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")}));this.element=this.element.parent().data("resizable",this.element.data("resizable"));this.elementIsWrapper=true;this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")});this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0});this.originalResizeStyle=this.originalElement.css("resize");this.originalElement.css("resize","none");this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"}));this.originalElement.css({margin:this.originalElement.css("margin")});this._proportionallyResize()}this.handles=a.handles||(!e(".ui-resizable-handle",this.element).length?"e,s,se":{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"});if(this.handles.constructor==String){if(this.handles=="all")this.handles="n,e,s,w,se,sw,ne,nw";var c=this.handles.split(",");this.handles={};for(var d=0;d<c.length;d++){var f=e.trim(c[d]),g=e('<div class="ui-resizable-handle '+("ui-resizable-"+f)+'"></div>');/sw|se|ne|nw/.test(f)&&g.css({zIndex:++a.zIndex});"se"==f&&g.addClass("ui-icon ui-icon-gripsmall-diagonal-se");this.handles[f]=".ui-resizable-"+f;this.element.append(g)}}this._renderAxis=function(h){h=h||this.element;for(var i in this.handles){if(this.handles[i].constructor==String)this.handles[i]=e(this.handles[i],this.element).show();if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var j=e(this.handles[i],this.element),l=0;l=/sw|ne|nw|se|n|s/.test(i)?j.outerHeight():j.outerWidth();j=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join("");h.css(j,l);this._proportionallyResize()}e(this.handles[i])}};this._renderAxis(this.element);this._handles=e(".ui-resizable-handle",this.element).disableSelection();this._handles.mouseover(function(){if(!b.resizing){if(this.className)var h=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);b.axis=h&&h[1]?h[1]:"se"}});if(a.autoHide){this._handles.hide();e(this.element).addClass("ui-resizable-autohide").hover(function(){if(!a.disabled){e(this).removeClass("ui-resizable-autohide");b._handles.show()}},function(){if(!a.disabled)if(!b.resizing){e(this).addClass("ui-resizable-autohide");b._handles.hide()}})}this._mouseInit()},destroy:function(){this._mouseDestroy();var b=function(c){e(c).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};if(this.elementIsWrapper){b(this.element);var a=this.element;a.after(this.originalElement.css({position:a.css("position"),width:a.outerWidth(),height:a.outerHeight(),top:a.css("top"),left:a.css("left")})).remove()}this.originalElement.css("resize",this.originalResizeStyle);b(this.originalElement);return this},_mouseCapture:function(b){var a=false;for(var c in this.handles)if(e(this.handles[c])[0]==b.target)a=true;return!this.options.disabled&&a},_mouseStart:function(b){var a=this.options,c=this.element.position(),d=this.element;this.resizing=true;this.documentScroll={top:e(document).scrollTop(),left:e(document).scrollLeft()};if(d.is(".ui-draggable")||/absolute/.test(d.css("position")))d.css({position:"absolute",top:c.top,left:c.left});e.browser.opera&&/relative/.test(d.css("position"))&&d.css({position:"relative",top:"auto",left:"auto"});this._renderProxy();c=m(this.helper.css("left"));var f=m(this.helper.css("top"));if(a.containment){c+=e(a.containment).scrollLeft()||0;f+=e(a.containment).scrollTop()||0}this.offset=this.helper.offset();this.position={left:c,top:f};this.size=this._helper?{width:d.outerWidth(),height:d.outerHeight()}:{width:d.width(),height:d.height()};this.originalSize=this._helper?{width:d.outerWidth(),height:d.outerHeight()}:{width:d.width(),height:d.height()};this.originalPosition={left:c,top:f};this.sizeDiff={width:d.outerWidth()-d.width(),height:d.outerHeight()-d.height()};this.originalMousePosition={left:b.pageX,top:b.pageY};this.aspectRatio=typeof a.aspectRatio=="number"?a.aspectRatio:this.originalSize.width/this.originalSize.height||1;a=e(".ui-resizable-"+this.axis).css("cursor");e("body").css("cursor",a=="auto"?this.axis+"-resize":a);d.addClass("ui-resizable-resizing");this._propagate("start",b);return true},_mouseDrag:function(b){var a=this.helper,c=this.originalMousePosition,d=this._change[this.axis];if(!d)return false;c=d.apply(this,[b,b.pageX-c.left||0,b.pageY-c.top||0]);this._updateVirtualBoundaries(b.shiftKey);if(this._aspectRatio||b.shiftKey)c=this._updateRatio(c,b);c=this._respectSize(c,b);this._propagate("resize",b);a.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"});!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize();this._updateCache(c);this._trigger("resize",b,this.ui());return false},_mouseStop:function(b){this.resizing=false;var a=this.options,c=this;if(this._helper){var d=this._proportionallyResizeElements,f=d.length&&/textarea/i.test(d[0].nodeName);d=f&&e.ui.hasScroll(d[0],"left")?0:c.sizeDiff.height;f=f?0:c.sizeDiff.width;f={width:c.helper.width()-f,height:c.helper.height()-d};d=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null;var g=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null;a.animate||this.element.css(e.extend(f,{top:g,left:d}));c.helper.height(c.size.height);c.helper.width(c.size.width);this._helper&&!a.animate&&this._proportionallyResize()}e("body").css("cursor","auto");this.element.removeClass("ui-resizable-resizing");this._propagate("stop",b);this._helper&&this.helper.remove();return false},_updateVirtualBoundaries:function(b){var a=this.options,c,d,f;a={minWidth:k(a.minWidth)?a.minWidth:0,maxWidth:k(a.maxWidth)?a.maxWidth:Infinity,minHeight:k(a.minHeight)?a.minHeight:0,maxHeight:k(a.maxHeight)?a.maxHeight:Infinity};if(this._aspectRatio||b){b=a.minHeight*this.aspectRatio;d=a.minWidth/this.aspectRatio;c=a.maxHeight*this.aspectRatio;f=a.maxWidth/this.aspectRatio;if(b>a.minWidth)a.minWidth=b;if(d>a.minHeight)a.minHeight=d;if(c<a.maxWidth)a.maxWidth=c;if(f<a.maxHeight)a.maxHeight=f}this._vBoundaries=a},_updateCache:function(b){this.offset=this.helper.offset();if(k(b.left))this.position.left=b.left;if(k(b.top))this.position.top=b.top;if(k(b.height))this.size.height=b.height;if(k(b.width))this.size.width=b.width},_updateRatio:function(b){var a=this.position,c=this.size,d=this.axis;if(k(b.height))b.width=b.height*this.aspectRatio;else if(k(b.width))b.height=b.width/this.aspectRatio;if(d=="sw"){b.left=a.left+(c.width-b.width);b.top=null}if(d=="nw"){b.top=a.top+(c.height-b.height);b.left=a.left+(c.width-b.width)}return b},_respectSize:function(b){var a=this._vBoundaries,c=this.axis,d=k(b.width)&&a.maxWidth&&a.maxWidth<b.width,f=k(b.height)&&a.maxHeight&&a.maxHeight<b.height,g=k(b.width)&&a.minWidth&&a.minWidth>b.width,h=k(b.height)&&a.minHeight&&a.minHeight>b.height;if(g)b.width=a.minWidth;if(h)b.height=a.minHeight;if(d)b.width=a.maxWidth;if(f)b.height=a.maxHeight;var i=this.originalPosition.left+this.originalSize.width,j=this.position.top+this.size.height,l=/sw|nw|w/.test(c);c=/nw|ne|n/.test(c);if(g&&l)b.left=i-a.minWidth;if(d&&l)b.left=i-a.maxWidth;if(h&&c)b.top=j-a.minHeight;if(f&&c)b.top=j-a.maxHeight;if((a=!b.width&&!b.height)&&!b.left&&b.top)b.top=null;else if(a&&!b.top&&b.left)b.left=null;return b},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var b=this.helper||this.element,a=0;a<this._proportionallyResizeElements.length;a++){var c=this._proportionallyResizeElements[a];if(!this.borderDif){var d=[c.css("borderTopWidth"),c.css("borderRightWidth"),c.css("borderBottomWidth"),c.css("borderLeftWidth")],f=[c.css("paddingTop"),c.css("paddingRight"),c.css("paddingBottom"),c.css("paddingLeft")];this.borderDif=e.map(d,function(g,h){g=parseInt(g,10)||0;h=parseInt(f[h],10)||0;return g+h})}e.browser.msie&&(e(b).is(":hidden")||e(b).parents(":hidden").length)||c.css({height:b.height()-this.borderDif[0]-this.borderDif[2]||0,width:b.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var b=this.options;this.elementOffset=this.element.offset();if(this._helper){this.helper=this.helper||e('<div style="overflow:hidden;"></div>');var a=e.browser.msie&&e.browser.version<7,c=a?1:0;a=a?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+
a,height:this.element.outerHeight()+a,position:"absolute",left:this.elementOffset.left-c+"px",top:this.elementOffset.top-c+"px",zIndex:++b.zIndex});this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(b,a){return{width:this.originalSize.width+a}},w:function(b,a){return{left:this.originalPosition.left+a,width:this.originalSize.width-a}},n:function(b,a,c){return{top:this.originalPosition.top+c,height:this.originalSize.height-c}},s:function(b,a,c){return{height:this.originalSize.height+
c}},se:function(b,a,c){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[b,a,c]))},sw:function(b,a,c){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[b,a,c]))},ne:function(b,a,c){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[b,a,c]))},nw:function(b,a,c){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[b,a,c]))}},_propagate:function(b,a){e.ui.plugin.call(this,b,[a,this.ui()]);b!="resize"&&this._trigger(b,a,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}});e.extend(e.ui.resizable,{version:"1.8.16"});e.ui.plugin.add("resizable","alsoResize",{start:function(){var b=e(this).data("resizable").options,a=function(c){e(c).each(function(){var d=e(this);d.data("resizable-alsoresize",{width:parseInt(d.width(),10),height:parseInt(d.height(),10),left:parseInt(d.css("left"),10),top:parseInt(d.css("top"),10),position:d.css("position")})})};if(typeof b.alsoResize=="object"&&!b.alsoResize.parentNode)if(b.alsoResize.length){b.alsoResize=b.alsoResize[0];a(b.alsoResize)}else e.each(b.alsoResize,function(c){a(c)});else a(b.alsoResize)},resize:function(b,a){var c=e(this).data("resizable");b=c.options;var d=c.originalSize,f=c.originalPosition,g={height:c.size.height-d.height||0,width:c.size.width-d.width||0,top:c.position.top-
f.top||0,left:c.position.left-f.left||0},h=function(i,j){e(i).each(function(){var l=e(this),q=e(this).data("resizable-alsoresize"),p={},r=j&&j.length?j:l.parents(a.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(r,function(n,o){if((n=(q[o]||0)+(g[o]||0))&&n>=0)p[o]=n||null});if(e.browser.opera&&/relative/.test(l.css("position"))){c._revertToRelativePosition=true;l.css({position:"absolute",top:"auto",left:"auto"})}l.css(p)})};typeof b.alsoResize=="object"&&!b.alsoResize.nodeType?e.each(b.alsoResize,function(i,j){h(i,j)}):h(b.alsoResize)},stop:function(){var b=e(this).data("resizable"),a=b.options,c=function(d){e(d).each(function(){var f=e(this);f.css({position:f.data("resizable-alsoresize").position})})};if(b._revertToRelativePosition){b._revertToRelativePosition=false;typeof a.alsoResize=="object"&&!a.alsoResize.nodeType?e.each(a.alsoResize,function(d){c(d)}):c(a.alsoResize)}e(this).removeData("resizable-alsoresize")}});e.ui.plugin.add("resizable","animate",{stop:function(b){var a=e(this).data("resizable"),c=a.options,d=a._proportionallyResizeElements,f=d.length&&/textarea/i.test(d[0].nodeName),g=f&&e.ui.hasScroll(d[0],"left")?0:a.sizeDiff.height;f={width:a.size.width-(f?0:a.sizeDiff.width),height:a.size.height-g};g=parseInt(a.element.css("left"),10)+(a.position.left-a.originalPosition.left)||null;var h=parseInt(a.element.css("top"),10)+(a.position.top-a.originalPosition.top)||null;a.element.animate(e.extend(f,h&&g?{top:h,left:g}:{}),{duration:c.animateDuration,easing:c.animateEasing,step:function(){var i={width:parseInt(a.element.css("width"),10),height:parseInt(a.element.css("height"),10),top:parseInt(a.element.css("top"),10),left:parseInt(a.element.css("left"),10)};d&&d.length&&e(d[0]).css({width:i.width,height:i.height});a._updateCache(i);a._propagate("resize",b)}})}});e.ui.plugin.add("resizable","containment",{start:function(){var b=e(this).data("resizable"),a=b.element,c=b.options.containment;if(a=c instanceof e?c.get(0):/parent/.test(c)?a.parent().get(0):c){b.containerElement=e(a);if(/document/.test(c)||c==document){b.containerOffset={left:0,top:0};b.containerPosition={left:0,top:0};b.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}}else{var d=e(a),f=[];e(["Top","Right","Left","Bottom"]).each(function(i,j){f[i]=m(d.css("padding"+j))});b.containerOffset=d.offset();b.containerPosition=d.position();b.containerSize={height:d.innerHeight()-f[3],width:d.innerWidth()-f[1]};c=b.containerOffset;var g=b.containerSize.height,h=b.containerSize.width;h=e.ui.hasScroll(a,"left")?a.scrollWidth:h;g=e.ui.hasScroll(a)?a.scrollHeight:g;b.parentData={element:a,left:c.left,top:c.top,width:h,height:g}}}},resize:function(b){var a=e(this).data("resizable"),c=a.options,d=a.containerOffset,f=a.position;b=a._aspectRatio||b.shiftKey;var g={top:0,left:0},h=a.containerElement;if(h[0]!=document&&/static/.test(h.css("position")))g=d;if(f.left<(a._helper?d.left:0)){a.size.width+=a._helper?a.position.left-d.left:a.position.left-g.left;if(b)a.size.height=a.size.width/c.aspectRatio;a.position.left=c.helper?d.left:0}if(f.top<(a._helper?d.top:0)){a.size.height+=a._helper?a.position.top-d.top:a.position.top;if(b)a.size.width=a.size.height*c.aspectRatio;a.position.top=a._helper?d.top:0}a.offset.left=a.parentData.left+a.position.left;a.offset.top=a.parentData.top+a.position.top;c=Math.abs((a._helper?a.offset.left-g.left:a.offset.left-g.left)+a.sizeDiff.width);d=Math.abs((a._helper?a.offset.top-g.top:a.offset.top-
d.top)+a.sizeDiff.height);f=a.containerElement.get(0)==a.element.parent().get(0);g=/relative|absolute/.test(a.containerElement.css("position"));if(f&&g)c-=a.parentData.left;if(c+a.size.width>=a.parentData.width){a.size.width=a.parentData.width-c;if(b)a.size.height=a.size.width/a.aspectRatio}if(d+a.size.height>=a.parentData.height){a.size.height=a.parentData.height-d;if(b)a.size.width=a.size.height*a.aspectRatio}},stop:function(){var b=e(this).data("resizable"),a=b.options,c=b.containerOffset,d=b.containerPosition,f=b.containerElement,g=e(b.helper),h=g.offset(),i=g.outerWidth()-b.sizeDiff.width;g=g.outerHeight()-b.sizeDiff.height;b._helper&&!a.animate&&/relative/.test(f.css("position"))&&e(this).css({left:h.left-d.left-c.left,width:i,height:g});b._helper&&!a.animate&&/static/.test(f.css("position"))&&e(this).css({left:h.left-d.left-c.left,width:i,height:g})}});e.ui.plugin.add("resizable","ghost",{start:function(){var b=e(this).data("resizable"),a=b.options,c=b.size;b.ghost=b.originalElement.clone();b.ghost.css({opacity:0.25,display:"block",position:"relative",height:c.height,width:c.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof a.ghost=="string"?a.ghost:"");b.ghost.appendTo(b.helper)},resize:function(){var b=e(this).data("resizable");b.ghost&&b.ghost.css({position:"relative",height:b.size.height,width:b.size.width})},stop:function(){var b=e(this).data("resizable");b.ghost&&b.helper&&b.helper.get(0).removeChild(b.ghost.get(0))}});e.ui.plugin.add("resizable","grid",{resize:function(){var b=e(this).data("resizable"),a=b.options,c=b.size,d=b.originalSize,f=b.originalPosition,g=b.axis;a.grid=typeof a.grid=="number"?[a.grid,a.grid]:a.grid;var h=Math.round((c.width-d.width)/(a.grid[0]||1))*(a.grid[0]||1);a=Math.round((c.height-d.height)/(a.grid[1]||1))*(a.grid[1]||1);if(/^(se|s|e)$/.test(g)){b.size.width=d.width+h;b.size.height=d.height+a}else if(/^(ne)$/.test(g)){b.size.width=d.width+h;b.size.height=d.height+a;b.position.top=f.top-a}else{if(/^(sw)$/.test(g)){b.size.width=d.width+h;b.size.height=d.height+a}else{b.size.width=d.width+h;b.size.height=d.height+a;b.position.top=f.top-a}b.position.left=f.left-h}}});var m=function(b){return parseInt(b,10)||0},k=function(b){return!isNaN(parseInt(b,10))}})(jQuery);!function(a){function f(a,b){if(!(a.originalEvent.touches.length>1)){a.preventDefault();var c=a.originalEvent.changedTouches[0],d=document.createEvent("MouseEvents");d.initMouseEvent(b,!0,!0,window,1,c.screenX,c.screenY,c.clientX,c.clientY,!1,!1,!1,!1,0,null),a.target.dispatchEvent(d)}}if(a.support.touch="ontouchend"in document,a.support.touch){var e,b=a.ui.mouse.prototype,c=b._mouseInit,d=b._mouseDestroy;b._touchStart=function(a){var b=this;!e&&b._mouseCapture(a.originalEvent.changedTouches[0])&&(e=!0,b._touchMoved=!1,f(a,"mouseover"),f(a,"mousemove"),f(a,"mousedown"))},b._touchMove=function(a){e&&(this._touchMoved=!0,f(a,"mousemove"))},b._touchEnd=function(a){e&&(f(a,"mouseup"),f(a,"mouseout"),this._touchMoved||f(a,"click"),e=!1)},b._mouseInit=function(){var b=this;b.element.bind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),c.call(b)},b._mouseDestroy=function(){var b=this;b.element.unbind({touchstart:a.proxy(b,"_touchStart"),touchmove:a.proxy(b,"_touchMove"),touchend:a.proxy(b,"_touchEnd")}),d.call(b)}}}(jQuery);(function(jQuery){jQuery.hotkeys={version:"0.8.1",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",91:"command",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":"\"",",":"<",".":">","/":"?","\\":"|"}};function keyHandler(handleObj){if(typeof handleObj.data!=="string"){return;}
var origHandler=handleObj.handler,keys=handleObj.data.toLowerCase().split(" ");var isCommandPressed=false;handleObj.handler=function(event){var special=event.type!=="keypress"&&jQuery.hotkeys.specialKeys[event.which],character=String.fromCharCode(event.which).toLowerCase(),key,modif="",possible={};if(event.altKey&&special!=="alt"){modif+="alt+";}
if(event.ctrlKey&&special!=="ctrl"){modif+="ctrl+";}
if(jQuery.hotkeys.specialKeys[event.which]==="command"){isCommandPressed=true;}
if(event.metaKey&&!event.ctrlKey&&special!=="meta"&&special!=="command"){if(isCommandPressed){modif+="command+";}else{modif+="meta+";}}
if(event.shiftKey&&special!=="shift"){modif+="shift+";}
if(special){possible[modif+special]=true;}else{possible[modif+character]=true;possible[modif+jQuery.hotkeys.shiftNums[character]]=true;if(modif==="shift+"){possible[jQuery.hotkeys.shiftNums[character]]=true;}}
for(var i=0,l=keys.length;i<l;i++){if(possible[keys[i]]){isCommandPressed=false;return origHandler.apply(this,arguments);}}};}
jQuery.each(["keydown","keyup","keypress"],function(){jQuery.event.special[this]={add:keyHandler};});})(jQuery);﻿
(function($){$.fn.jscontext=function(options){var settings={html:'default',bind:'right-click',closeOnMouseLeave:false,fade:false,fadeSpeed:"normal",show:null,open:null,close:null,mouseover:null,mouseleave:null,sticky:false};var methods={initMenu:function(elm,settings){$("html").mousemove(function(e){mouse.x=e.pageX;mouse.y=e.pageY;if(element.current!=undefined&&element.moveit){element.current.css("top",(mouse.y+10)+'px');element.current.css("left",(mouse.x+10)+'px');if(settings.mouseover!=null)
settings.mouseover.call();}});$("html").click(function(){if(element.close())
methods.closeMenu(null,null);});$("html").mouseleave(function(){methods.closeMenu(null,null);});switch(settings.bind){case"right-click":$(elm).bind("contextmenu",function(e){var elementcurrent=$("#"+elm.id+"jscontext");if(elementcurrent.length==0){methods.openMenu(elm,settings);jscontextElm(elm);if(settings.show!=null)
settings.show.call();element.moveit=false;return false;}});break;case"click":$(elm).click(function(e){var elementcurrent=$("#"+elm.id+"jscontext");if(elementcurrent.length==0){methods.openMenu(elm,settings);jscontextElm(elm);if(settings.show!=null)
settings.show.call();element.moveit=false;return false;}});break;case"anyclick":$(elm).bind("contextmenu",function(e){var elementcurrent=$("#"+elm.id+"jscontext");if(elementcurrent.length==0){methods.openMenu(elm,settings);jscontextElm(elm);if(settings.show!=null)
settings.show.call();element.moveit=false;return false;}});$(elm).click(function(e){var elementcurrent=$("#"+elm.id+"jscontext");if(elementcurrent.length==0){methods.openMenu(elm,settings);jscontextElm(elm);if(settings.show!=null)
settings.show.call();element.moveit=false;return false;}});break;case"hover":$(elm).hover(function(e){var elementcurrent=$("#"+elm.id+"jscontext");if(elementcurrent.length==0){methods.openMenu(elm,settings);jscontextElm(elm);if(settings.show!=null)
settings.show.call();if(settings.sticky)
element.moveit=true;return false;}},function(e){if(settings.sticky){if(element.close())
methods.closeMenu($(element.current).attr("id"),null);}
element.moveit=false;});break;}},openMenu:function(elm,settings){methods.createMenu(elm,settings);element.current=$("#"+elm.id+"jscontext");if(settings.html instanceof Function){element.current.html(settings.html(elm));}else{element.current.html(settings.html.clone(true));}
var jscontextBtn=$(".jscontextBtn");if(settings.open!=null)
settings.open.call();if(settings.closeOnMouseLeave&&!settings.sticky){element.current.mouseleave(function(){if(element.close())
methods.closeMenu($(element.current).attr("id"),null);});}
try{var winWidth=window.innerWidth||document.documentElement.clientWidth||document.body.offsetWidth;if(mouse.x>=winWidth-element.current.width())
element.current.css("left",mouse.x-(element.current.width()-15)+"px");}
catch(e){}},createMenu:function(elm,settings){var jscontextID=elm.id+"jscontext";var afterClose=function(){var jscontextElement=document.createElement('div');jscontextElement.id=jscontextID;jscontextElement.style.position='absolute';jscontextElement.style.display='none';if(mouse.y==undefined)
mouse.y=0;if(mouse.x==undefined)
mouse.x=0;jscontextElement.style.top=(mouse.y-(settings.sticky==true?0:15))+'px';jscontextElement.style.left=(mouse.x-(settings.sticky==true?0:15))+'px';jscontextElement.style.zIndex='9999';document.body.appendChild(jscontextElement);var jscontext=$("#"+jscontextID);jscontext.addClass("jscontextContainer");if(settings.fade){jscontext.fadeIn(settings.fadeSpeed);element.fade=true;}
else{jscontext.show();element.fade=false;}}
methods.closeMenu(null,afterClose);},closeMenu:function(elmID,afterClose){var remove=function(){if(elmID){if($("#"+elmID).length>0)
document.body.removeChild(document.getElementById(elmID));}
else{$(".jscontextContainer").remove();}}
if(element.fade){if(elmID){if($("#"+elmID).length>0)
$("#"+elmID).fadeOut(settings.fadeSpeed,remove);}
else{$(".jscontextContainer").fadeOut(settings.fadeSpeed,remove);}}
else{remove.call();}
if(settings.close!=null)
settings.close.call();if(afterClose!=null)
afterClose.call();}};return this.each(function(){if(options&&typeof options==='object'){$.extend(settings,options);methods.initMenu(this,settings);}
else if(typeof options==='string'){switch(options){case"":break;}}});};})(jQuery);jscontext=function(option){switch(option){case"close":$(".jscontextContainer").remove();break;}}
jscontextElm=function(elm){jscontextObj=$(elm);}
var element={current:null,moveit:false,fade:false,close:function(){if(element.current==null)
return true;if((mouse.x<element.current.position().left+5)||(mouse.x>(element.current.position().left+element.current.width()-5))||(mouse.y<element.current.position().top+5)||(mouse.y>(element.current.position().top+element.current.height()-5)))
return true;else
return false;}};var mouse={x:null,y:null};var jscontextObj=$();;(function($,undefined){var tag2attr={a:'href',img:'src',form:'action',base:'href',script:'src',iframe:'src',link:'href'},key=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","fragment"],aliases={"anchor":"fragment"},parser={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},querystring_parser=/(?:^|&|;)([^&=;]*)=?([^&;]*)/g,fragment_parser=/(?:^|&|;)([^&=;]*)=?([^&;]*)/g;function parseUri(url,strictMode)
{var str=decodeURI(url),res=parser[strictMode||false?"strict":"loose"].exec(str),uri={attr:{},param:{},seg:{}},i=14;while(i--)
{uri.attr[key[i]]=res[i]||"";}
uri.param['query']={};uri.param['fragment']={};uri.attr['query'].replace(querystring_parser,function($0,$1,$2){if($1)
{uri.param['query'][$1]=$2;}});uri.attr['fragment'].replace(fragment_parser,function($0,$1,$2){if($1)
{uri.param['fragment'][$1]=$2;}});uri.seg['path']=uri.attr.path.replace(/^\/+|\/+$/g,'').split('/');uri.seg['fragment']=uri.attr.fragment.replace(/^\/+|\/+$/g,'').split('/');uri.attr['base']=uri.attr.host?uri.attr.protocol+"://"+uri.attr.host+(uri.attr.port?":"+uri.attr.port:''):'';return uri;};function getAttrName(elm)
{var tn=elm.tagName;if(tn!==undefined)return tag2attr[tn.toLowerCase()];return tn;}
$.fn.url=function(strictMode)
{var url='';if(this.length)
{url=$(this).attr(getAttrName(this[0]))||'';}
return $.url(url,strictMode);};$.url=function(url,strictMode)
{if(arguments.length===1&&url===true)
{strictMode=true;url=undefined;}
strictMode=strictMode||false;url=url||window.location.toString();return{data:parseUri(url,strictMode),attr:function(attr)
{attr=aliases[attr]||attr;return attr!==undefined?this.data.attr[attr]:this.data.attr;},param:function(param)
{return param!==undefined?this.data.param.query[param]:this.data.param.query;},fparam:function(param)
{return param!==undefined?this.data.param.fragment[param]:this.data.param.fragment;},segment:function(seg)
{if(seg===undefined)
{return this.data.seg.path;}
else
{seg=seg<0?this.data.seg.path.length+seg:seg-1;return this.data.seg.path[seg];}},fsegment:function(seg)
{if(seg===undefined)
{return this.data.seg.fragment;}
else
{seg=seg<0?this.data.seg.fragment.length+seg:seg-1;return this.data.seg.fragment[seg];}}};};})(jQuery);function urlencode(str){return escape(str).replace('+','%2B').replace('%20','+').replace('*','%2A').replace('/','%2F').replace('@','%40');}
function urldecode(str){return unescape(str.replace('+',' '));}
var __slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i;}return-1;};(function($,window){var SimpleSlider;SimpleSlider=(function(){function SimpleSlider(input,options){var ratio,_this=this;this.input=input;this.defaultOptions={animate:true,snapMid:false,classPrefix:null,classSuffix:null,theme:null,highlight:false};this.settings=$.extend({},this.defaultOptions,options);if(this.settings.theme){this.settings.classSuffix="-"+this.settings.theme;}
this.input.hide();this.slider=$("<div>").addClass("slider"+(this.settings.classSuffix||"")).css({position:"relative",userSelect:"none",boxSizing:"border-box"}).insertBefore(this.input);if(this.input.attr("id")){this.slider.attr("id",this.input.attr("id")+"-slider");}
this.track=this.createDivElement("track").css({width:"100%"});if(this.settings.highlight){this.highlightTrack=this.createDivElement("highlight-track").css({width:"0"});}
this.dragger=this.createDivElement("dragger");this.slider.css({minHeight:this.dragger.outerHeight(),marginLeft:this.dragger.outerWidth()/2,marginRight:this.dragger.outerWidth()/2});this.track.css({marginTop:this.track.outerHeight()/-2});if(this.settings.highlight){this.highlightTrack.css({marginTop:this.track.outerHeight()/-2});}
this.dragger.css({marginTop:this.dragger.outerHeight()/-2,marginLeft:this.dragger.outerWidth()/-2});this.track.mousedown(function(e){return _this.trackEvent(e);});if(this.settings.highlight){this.highlightTrack.mousedown(function(e){return _this.trackEvent(e);});}
this.dragger.mousedown(function(e){if(e.which!==1){return;}
_this.dragging=true;_this.dragger.addClass("dragging");_this.input.addClass("is_dragging");_this.domDrag(e.pageX,e.pageY);return false;});$("body").mousemove(function(e){if(_this.dragging){_this.domDrag(e.pageX,e.pageY);return $("body").css({cursor:"pointer"});}}).mouseup(function(e){if(_this.dragging){_this.dragging=false;_this.dragger.removeClass("dragging");_this.input.removeClass("is_dragging");return $("body").css({cursor:"auto"});}});this.pagePos=0;if(this.input.val()===""){this.value=this.getRange().min;this.input.val(this.value);}else{this.value=this.nearestValidValue(this.input.val());}
this.setSliderPositionFromValue(this.value);ratio=this.valueToRatio(this.value);this.input.trigger("slider:ready",{value:this.value,ratio:ratio,position:ratio*this.slider.outerWidth(),el:this.slider});}
SimpleSlider.prototype.createDivElement=function(classname){var item;item=$("<div>").addClass(classname).css({position:"absolute",top:"50%",userSelect:"none",cursor:"pointer"}).appendTo(this.slider);return item;};SimpleSlider.prototype.setRatio=function(ratio){var value;ratio=Math.min(1,ratio);ratio=Math.max(0,ratio);value=this.ratioToValue(ratio);this.setSliderPositionFromValue(value);return this.valueChanged(value,ratio,"setRatio");};SimpleSlider.prototype.setValue=function(value,fire_event){var ratio;value=this.nearestValidValue(value);ratio=this.valueToRatio(value);this.setSliderPositionFromValue(value);if(fire_event){return this.valueChanged(value,ratio,"setValue");}
return true;};SimpleSlider.prototype.trackEvent=function(e){if(e.which!==1){return;}
this.domDrag(e.pageX,e.pageY,true);this.dragging=true;return false;};SimpleSlider.prototype.domDrag=function(pageX,pageY,animate){var pagePos,ratio,value;if(animate==null){animate=false;}
pagePos=pageX-this.slider.offset().left;pagePos=Math.min(this.slider.outerWidth(),pagePos);pagePos=Math.max(0,pagePos);if(this.pagePos!==pagePos){this.pagePos=pagePos;ratio=pagePos/this.slider.outerWidth();value=this.ratioToValue(ratio);this.valueChanged(value,ratio,"domDrag");if(this.settings.snap){return this.setSliderPositionFromValue(value,animate);}else{return this.setSliderPosition(pagePos,animate);}}};SimpleSlider.prototype.setSliderPosition=function(position,animate){if(animate==null){animate=false;}
if(animate&&this.settings.animate){this.dragger.animate({left:position},200);if(this.settings.highlight){return this.highlightTrack.animate({width:position},200);}}else{this.dragger.css({left:position});if(this.settings.highlight){return this.highlightTrack.css({width:position});}}};SimpleSlider.prototype.setSliderPositionFromValue=function(value,animate){var ratio;if(animate==null){animate=false;}
ratio=this.valueToRatio(value);return this.setSliderPosition(ratio*this.slider.outerWidth(),animate);};SimpleSlider.prototype.getRange=function(){if(this.settings.allowedValues){return{min:Math.min.apply(Math,this.settings.allowedValues),max:Math.max.apply(Math,this.settings.allowedValues)};}else if(this.settings.range){return{min:parseFloat(this.settings.range[0]),max:parseFloat(this.settings.range[1])};}else{return{min:0,max:1};}};SimpleSlider.prototype.nearestValidValue=function(rawValue){var closest,maxSteps,range,steps;range=this.getRange();rawValue=Math.min(range.max,rawValue);rawValue=Math.max(range.min,rawValue);if(this.settings.allowedValues){closest=null;$.each(this.settings.allowedValues,function(){if(closest===null||Math.abs(this-rawValue)<Math.abs(closest-rawValue)){return closest=this;}});return closest;}else if(this.settings.step){maxSteps=(range.max-range.min)/this.settings.step;steps=Math.floor((rawValue-range.min)/this.settings.step);if((rawValue-range.min)%this.settings.step>this.settings.step/2&&steps<maxSteps){steps+=1;}
return steps*this.settings.step+range.min;}else{return rawValue;}};SimpleSlider.prototype.valueToRatio=function(value){var allowedVal,closest,closestIdx,idx,range,_i,_len,_ref;if(this.settings.equalSteps){_ref=this.settings.allowedValues;for(idx=_i=0,_len=_ref.length;_i<_len;idx=++_i){allowedVal=_ref[idx];if(!(typeof closest!=="undefined"&&closest!==null)||Math.abs(allowedVal-value)<Math.abs(closest-value)){closest=allowedVal;closestIdx=idx;}}
if(this.settings.snapMid){return(closestIdx+0.5)/this.settings.allowedValues.length;}else{return closestIdx/(this.settings.allowedValues.length-1);}}else{range=this.getRange();return(value-range.min)/(range.max-range.min);}};SimpleSlider.prototype.ratioToValue=function(ratio){var idx,range,rawValue,step,steps;if(this.settings.equalSteps){steps=this.settings.allowedValues.length;step=Math.round(ratio*steps-0.5);idx=Math.min(step,this.settings.allowedValues.length-1);return this.settings.allowedValues[idx];}else{range=this.getRange();rawValue=ratio*(range.max-range.min)+range.min;return this.nearestValidValue(rawValue);}};SimpleSlider.prototype.valueChanged=function(value,ratio,trigger){var eventData;if(value.toString()===this.value.toString()){return;}
this.value=value;eventData={value:value,ratio:ratio,position:ratio*this.slider.outerWidth(),trigger:trigger,el:this.slider};return this.input.val(value).trigger($.Event("change",eventData)).trigger("slider:changed",eventData);};return SimpleSlider;})();$.extend($.fn,{simpleSlider:function(){var params,publicMethods,settingsOrMethod;settingsOrMethod=arguments[0],params=2<=arguments.length?__slice.call(arguments,1):[];publicMethods=["setRatio","setValue"];return $(this).each(function(){var obj,settings;if(settingsOrMethod&&__indexOf.call(publicMethods,settingsOrMethod)>=0){obj=$(this).data("slider-object");return obj[settingsOrMethod].apply(obj,params);}else{settings=settingsOrMethod;return $(this).data("slider-object",new SimpleSlider($(this),settings));}});}});return $(function(){return $("[data-slider]").each(function(){var $el,allowedValues,settings,x;$el=$(this);settings={};allowedValues=$el.data("slider-values");if(allowedValues){settings.allowedValues=(function(){var _i,_len,_ref,_results;_ref=allowedValues.split(",");_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){x=_ref[_i];_results.push(parseFloat(x));}
return _results;})();}
if($el.data("slider-range")){settings.range=$el.data("slider-range").split(",");}
if($el.data("slider-step")){settings.step=$el.data("slider-step");}
settings.snap=$el.data("slider-snap");settings.equalSteps=$el.data("slider-equal-steps");if($el.data("slider-theme")){settings.theme=$el.data("slider-theme");}
if($el.attr("data-slider-highlight")){settings.highlight=$el.data("slider-highlight");}
if($el.data("slider-animate")!=null){settings.animate=$el.data("slider-animate");}
return $el.simpleSlider(settings);});});})(this.jQuery||this.Zepto,this);if(!('ucfirst'in String.prototype)){String.prototype.ucfirst=function(){return this.charAt(0).toUpperCase()+this.substr(1);}}
(function($){$.fn.defchat=function(options){var settings={'domain':'localhost','username':null,'password':null,'my_username':'','textinput':this.find('.chat-box input.text'),'form':this.find('form.chat-form'),'chatlist':this.find('.chat-list'),'userslist':this.find('.users-list'),'buttons':this.find('.chat-box ul.buttons'),'submitbutton':this.find('.send_message_button'),'usercount':this.find('.usercount'),'handler':null,'force_handler':null,'subject':'','room':'mymucroom@conference.localhost','private_room':'mymucroom@conference.localhost','throttlechat':false,'throttle_message':null,'add_moderator_url':null,'remove_moderator_url':null,'media_url':'','hashtag_url':'','ban_url':null,'silence_url':null,'is_broadcasting':false,'is_moderator':false,'is_age_verified':'','allow_tipping':true,'domroot':this,'current_subject':'','default_subject':'','login_required_callback':null,'submenu_profile_url':null,'emoticon_overlay_url':null,'tipping_current_tokens_url':null,'welcome_message':null,'app_info_json':null,'welcome_warning':null,'first_post_warning':null,'parse_subject':null,'interested_in':[],'group_show_tokens_per_minute_url':null,'group_show_request_url':null,'group_show_decline_url':null,'group_show_cancel_url':null,'return_from_away_url':null,'spy_on_private_show_tokens_per_minute_url':null,'spy_on_private_show_request_url':null,'private_show_tokens_per_minute_url':null,'private_show_request_url':null,'private_show_approve_url':null,'private_show_decline_url':null,'private_show_cancel_url':null,'get_chat_user_menu_url':null,'spy_on_cams_url':null,'get_panel_url':null,'cancel_tip_goal_url':null,'tips_in_last_24_url':null,'scroll_on_load':true,'room_goal':{},'debug_mode':false,'num_users_waiting_for_group_show':0,'num_users_required_for_group_show':0,'html_chat_poll_url':'','saved_scroll_top':0,'scroll_saving_allowed':true,'site_name':'','support_email':'','silence_broadcasters':false,'users_that_can_chat':'','show_emoticons':true,'emoticon_autocomplete_delay':'0','chat_settings_url':'','font_size':'9pt','sort_users_key':'a','room_entry_for':'orgb','room_leave_for':'orgb','chat_ignore_list_url':'','chat_mod_list_url':'','chat_fan_list_url':'','chat_geo_list_url':'','load_ignored_users':'','min_tips_reqd_to_vote':2147483647,'initial_viewer_count':null,'change_room_title_url':'','ignored_emoticons':[],'v_tip_vol':10,'b_tip_vol':10,'broadcaster_gender':'','private_price':'','group_price':'','spy_price':'','mod_status_changed':false};window.defchat_settings=settings;if(options){$.extend(settings,options);}
$.extend(settings,{'user':settings.username+'@'+settings.domain,'muc_nickname':settings.username,'chat_host':'http://'+settings.domain+':5280/http-bind'});if(options){$.extend(settings,options);}
if(settings.force_handler!=null){settings.handler=settings.force_handler;}
else if(HasFlash()){settings.handler=flash_handler;}
else{settings.handler=html_handler;}
function consolelog(msg){}
function update_tips_in_last_24(){$.ajax({url:settings.tips_in_last_24_url,dataType:'json',success:function(response){settings.tipped_performer_last_24hrs=parseInt(response.tipped_performer_last_24hrs);tipping.tipped_performer_last_24hrs=settings.tipped_performer_last_24hrs;tipping.check_rating_ctrl();}});}
function get_contextual_menu_html(domele){var h=$("<div class='jscontextMenu' style='display: none;'></div>");var nick=$(domele).attr('data-nick');var jid=nick;var account_name=settings.handler.get_account_name(jid);var target_is_mod=false;var source_is_mod=false;h.append("<p class=\"jscontextLabel\"><img src=\""+settings.media_url+"images/red-arrow-down.gif\" width=\""+"9\" height=\"5\" alt=\"\" />"+nick+"</p><hr>");h.append("<div class=\"submenu_profile\" style=\"padding-left:8px\"> Loading...</div>");$.ajax({url:settings.get_chat_user_menu_url,data:{fromuser:settings.muc_nickname,touser:nick,roomname:settings.handler.room_owner_nick},type:'POST',success:function(data,textStatus,xhr){h.children().remove();if(!xhr.getResponseHeader('X-Successful')){h.append("<p class=\"jscontextLabel\"><img src=\""+
settings.media_url+"images/red-arrow-down.gif\" width=\""+"9\" height=\"5\" alt=\"\" />"+nick+"</p><hr>");h.append("<div class=\"submenu_profile\" "+"style=\"padding-left:8px\">An error occurred.</div>");return;}
if(xhr.getResponseHeader('X-Source_Is_Mod')){source_is_mod=true;}
if(xhr.getResponseHeader('X-Target_Is_Mod')){target_is_mod=true;}
function get_header_int_value(xhr,header_key){var header=xhr.getResponseHeader(header_key);if(header){return parseInt(header);}
return null;}
function get_tip_display(tip_amount){if(tip_amount&&tip_amount>0){return tip_amount.toString();}
return"0";}
function add_link(cls,text,callback){var line=$("<p class='jscontextBtn "+cls+"' data-nick='"+nick+"'>"+text+"</p>");line.click(function(){jscontext('close')});line.click(callback);h.append(line);}
h.append("<p class=\"jscontextLabel\"><img src=\""+settings.media_url+"images/red-arrow-down.gif\" width=\""+"9\" height=\"5\" alt=\"\" />"+nick+"</p><hr>");h.append("<div class=\"submenu_profile\"></div><hr>");if(nick!=settings.muc_nickname){add_link("pm",gettext("Send private message"),function(){tabs.open_pm(nick);});if($.inArray(jid,message_receiver.ignored_users)!==-1){add_link("unignore",gettext("Unignore This User"),function(event){var ignorenick=$(event.target).attr('data-nick');public_methods.unignore_user(ignorenick);});}else{add_link("ignore",gettext("Ignore This User"),function(event){var ignorenick=$(event.target).attr('data-nick');$('#ignore_user_form_username').val(ignorenick);$('#ignore_user_form_remove').val('');$.post(settings.chat_ignore_list_url,$('#ignore_user_form').serialize(),function(response){if(response==="max"){add_system_message("Please signup to enable this feature.",tabs.get_current_tab_domele());tabs._show_chat_tab();}
else{message_receiver.ignored_users.push(response);var msg=interpolate(gettext("Ignoring %(username)s"),{username:response},true);add_system_message(msg,tabs.get_current_tab_domele());tabs._show_chat_tab();}});});}
if(source_is_mod){if(!target_is_mod&&nick!=settings.handler.room_owner_nick){h.append("<hr>");add_link("",gettext("Silence for 6 hours"),function(event){var bannick=$(event.target).attr('data-nick');var jid=bannick;var msg=interpolate(gettext("Silence %(username)s?"),{username:bannick},true);if(confirm(msg)){msg=interpolate(gettext("Silencing %(username)s"),{username:bannick},true);add_system_message(msg,tabs.get_current_tab_domele());var account_name=settings.handler.get_account_name(jid);var url=settings.silence_url.replace('USERNAMESLUG',account_name);$.post(url,{'foo':'bar'});}});}
if(settings.muc_nickname===settings.handler.room_owner_jid){add_link("",gettext("Kick/Ban"),function(event){var bannick=$(event.target).attr('data-nick');var msg=interpolate(gettext("Ban %(username)s?"),{username:bannick},true);if(confirm(msg)){msg=interpolate(gettext("Kicking and banning %(username)s"),{username:bannick},true);add_system_message(msg,tabs.get_current_tab_domele());settings.handler.message_outbound.send_kickban_user(bannick);var account_name=settings.handler.get_account_name(bannick);var url=settings.ban_url.replace('USERNAMESLUG',account_name);$.post(url,{'foo':'bar'});}});h.append("<hr>");if(!target_is_mod){add_link("",gettext("Promote to Moderator"),function(event){var nick=$(event.target).attr('data-nick');public_methods.promote_user_to_moderator(nick);});}else{add_link("",gettext("Remove Moderator Status"),function(event){public_methods.revoke_moderator_status_from_user(nick);});}}}}
var tipped_performer_last_hour=get_header_int_value(xhr,'X-Tipped_Performer_Last_Hour');var tipped_performer_last_24_hours=get_header_int_value(xhr,'X-Tipped_Performer_Last_24_Hours');var tipped_performer_last_two_weeks=get_header_int_value(xhr,'X-Tipped_Performer_Last_Two_Weeks');if(settings.is_broadcasting&&settings.muc_nickname!=nick){h.append("<hr>");h.append("<div class=\"jscontextLabel\" style=\"margin:0px 5px\"><img src=\""+settings.media_url+"images/ico-tip.gif\" width=\""+"9\" height=\"9\" alt=\"\" />"+nick+" has tipped me:</div>");h.append("<div style=\"padding-left:19px\">"+get_tip_display(tipped_performer_last_hour)+" in the past hour</div>");h.append("<div style=\"padding-left:19px\">"+get_tip_display(tipped_performer_last_24_hours)+" in the past day</div>");h.append("<div style=\"padding-left:19px\">"+get_tip_display(tipped_performer_last_two_weeks)+" in the past 2 weeks</div>");}
var url=settings.submenu_profile_url.replace('USERNAMESLUG',account_name);consolelog("Loading menu from "+url);h.find(".submenu_profile").load(url);h.fadeIn(200);if($(window).height()-h.offset().top+$(window).scrollTop()<160){$('.jscontextContainer .jscontextMenu').css('margin-top',-130);}}});return h;}
function add_system_message(message,domele,index){if(index===undefined){index=0;}
message_receiver.add_message('<div id="'+index+'" class="text">'+'<p>'+message+'</p></div>',domele,index);}
$.add_system_message=add_system_message;function insert_user(newhtml,nick,token_balance){var sort_key=tabs.get_sort_users_key();var inserted=false;settings.userslist.find("div.text").each(function(index,domEle){var $domEle=$(domEle);var domnick=String($domEle.attr('data-nick'));if(sort_key=='a'){var new_val=nick.replace('__anonymous__','zzzz');var current_val=domnick.replace('__anonymous__','zzzz');}
else{var new_val=parseInt(token_balance);var current_val=parseInt($domEle.data('tokenbalance'));}
if((sort_key=='a')&&(new_val<current_val)){$domEle.before(newhtml);inserted=true;return false;}
if((sort_key=='t')&&(new_val>current_val)){$domEle.before(newhtml);inserted=true;return false;}});if(!inserted){settings.userslist.append(newhtml);}}
function facebox_revealed(){var windowHeight=$(window).height();var faceboxHeight=$('#facebox').height();if(faceboxHeight<windowHeight){$('#facebox').css('top',(Math.floor((windowHeight-faceboxHeight)/2)+$(window).scrollTop()));}}
$(document).bind('afterReveal.facebox',facebox_revealed);var public_methods={clear_app:function(){panel.clear_app();},apperrorlog:function(msg){if(settings.debug_mode|settings.is_broadcasting){add_system_message("Error: "+msg);}},appnotice:function(msg,background,foreground,weight){var back_color=message_receiver._validate_hex_color(background,'#FFFFFF');var fore_color=message_receiver._validate_hex_color(foreground,'#000000');var font_weight=message_receiver._validate_font_weight(weight,'normal');message_receiver.add_message('<div class="text"><p><span style="background-color: '+
back_color+'; color: '+fore_color+'; font-weight: '+font_weight+'">'+"Notice: "+message_receiver._add_emoticons(msg)+'</span></p></div>');},appprivatenotice:function(msg,to_user,background,foreground,weight){if(to_user==settings.my_username){var back_color=message_receiver._validate_hex_color(background,'#FFFFFF');var fore_color=message_receiver._validate_hex_color(foreground,'#000000');var font_weight=message_receiver._validate_font_weight(weight,'normal');message_receiver.add_message('<div class="text"><p><span style="background-color: '+
back_color+'; color: '+fore_color+'; font-weight: '+font_weight+'">'+"Notice: "+message_receiver._add_emoticons(msg)+'</span></p></div>');}},debuglog:function(msg){if(settings.debug_mode){add_system_message("Debug: "+msg);}},update_panel:function(){panel.update();},app_tab_refresh:function(){apps_and_bots.refresh_panel();panel.update();},spy_on_private:function(){groups_and_privates.start_spy_on_private_clicked();},exit_away_mode:function(){groups_and_privates.return_from_away_mode_clicked();},join_group_show:function(){groups_and_privates.start_group_show_clicked();},change_title:function(title){if(title==settings.current_subject){return;}
$.cookie('my_room_subject',title,{expires:365});settings.handler.message_outbound.send_change_title(title);},select_emoticon:function(emoticon){settings.textinput.val(settings.textinput.val()+" "+emoticon);},is_goal_set:function(){return settings.room_goal.hasOwnProperty('amount');},increment_public_tab_counter:function(){if(tabs.current_tab!='chat'){var counter=$('div.chat-box span.counter');var value=parseInt(counter.find('span.val').text());value+=1;counter.find('.val').text(value);counter.show();}},do_get_or_create_pm_tab_for_nick:function(nick,show_alert){return tabs.get_or_create_pm_tab_for_nick(nick,show_alert);},do_private_message_received:function(nick){tabs.private_message_received(nick);},do_reset_users_list_html:function(){settings.userslist.html("");},do_update_token_balance:function(new_balance){tipping.current_balance=new_balance;$('.tokencount').html(tipping.current_balance);update_tips_in_last_24();},do_show_reconnect_message:function(){add_system_message(gettext("trying to reconnect"));},do_show_system_message:function(message){add_system_message(message,tabs.get_current_tab_domele());},do_show_kicked_message:function(reason){switch(reason){case"rejoined":add_system_message("You were kicked because you have joined "+"this room again.",tabs.get_current_tab_domele());break;case"kicked":add_system_message("The broadcaster has kicked you "+"from the room.",tabs.get_current_tab_domele());break;default:add_system_message("You were kicked from the room.",tabs.get_current_tab_domele());break;}},promote_user_to_moderator:function(nick){$.post(settings.add_moderator_url.replace('USERNAMESLUG',nick),{'foo':'bar'});},revoke_moderator_status_from_user:function(nick){var url=settings.remove_moderator_url.replace('USERNAMESLUG',nick);$.post(url,{'foo':'bar'});tabs._show_chat_tab();},do_announce_promote:function(from_user,to_user,index){if(to_user==settings.username){settings.mod_status_changed=true;}
if(index===undefined){index=0;}
var msg=interpolate(gettext("%(from)s has granted moderator privileges to %(to)s."),{from:from_user,to:to_user},true);add_system_message(msg,null,index);},do_announce_revoke:function(from_user,to_user,index){if(to_user==settings.username){settings.mod_status_changed=true;}
if(index===undefined){index=0;}
var msg=interpolate(gettext("%(from)s has revoked moderator privileges from %(to)s."),{from:from_user,to:to_user},true);add_system_message(msg,null,index);},do_get_current_tab:function(){return tabs.get_current_tab_domele()},update_viewer_count:function(amount){settings.usercount.text(amount);},scroll_to_bottom:function(){tabs._scroll_to_bottom();},enable_html5_video_controls:function(){if(!HasFlash()||(navigator.userAgent.toLowerCase().indexOf('safari')>-1)){if(!settings.domroot.find(".tip_popup").is(":visible")&&!$("#report_popup").is(":visible")){$("#still_video_object").attr("controls","controls");var isiPhone=navigator.userAgent.toLowerCase().indexOf("iphone");var isiPad=navigator.userAgent.toLowerCase().indexOf("ipad");var isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox");var isChrome=navigator.userAgent.toLowerCase().indexOf("chrome");var isAndroid=navigator.userAgent.toLowerCase().indexOf("android");var isIE=isAnyIE();if(isiPhone!=-1){$("#still_video_object").show();}
if((isiPhone<0)&&(isiPad<0)&&(isFirefox<0)&&(isChrome<0)&&(!isIE)&&(isAndroid<0)){audio_volume_persist_handle();}}}},disable_html5_video_controls:function(){$("#still_video_object").removeAttr("controls");if(navigator.platform.indexOf("iPhone")!=-1){$("#still_video_object").hide();}},room_entry:function(username,is_mod,in_fanclub,tipped_recently,has_tokens,tipped_alot_recently,tipped_tons_recently){if(tipped_alot_recently===undefined)
tipped_alot_recently=false;if(tipped_tons_recently===undefined)
tipped_tons_recently=false;if(settings.room_entry_for=='none'&&(settings.is_broadcasting||settings.is_moderator)){return;}
if(settings.room_entry_for=='orgb'||settings.room_entry_for==undefined||(!settings.is_broadcasting&&!settings.is_moderator)||((settings.room_entry_for=='org'&&username===settings.handler.room_owner_jid)||(settings.room_entry_for=='org'&&is_mod)||(settings.room_entry_for=='org'&&in_fanclub))){var label_class=message_receiver.get_username_class(username,is_mod,in_fanclub,tipped_recently,has_tokens,tipped_alot_recently,tipped_tons_recently);var prefix=message_receiver.get_username_prefix(username,is_mod,in_fanclub);add_system_message(prefix+'<span class="username othermessagelabel '+label_class+'" '+'data-nick="'+username+'">'+username+'</span> '+' has joined the room.');}},room_leave:function(username,is_mod,in_fanclub,tipped_recently,has_tokens,tipped_alot_recently,tipped_tons_recently){if(tipped_alot_recently===undefined)
tipped_alot_recently=false;if(tipped_tons_recently===undefined)
tipped_tons_recently=false;if(settings.room_leave_for=='none'&&(settings.is_broadcasting||settings.is_moderator)){return;}
if(settings.room_leave_for=='orgb'||settings.room_leave_for==undefined||(!settings.is_broadcasting&&!settings.is_moderator)||((settings.room_leave_for=='org'&&username===settings.handler.room_owner_jid)||(settings.room_leave_for=='org'&&is_mod)||(settings.room_leave_for=='org'&&in_fanclub))){var label_class=message_receiver.get_username_class(username,is_mod,in_fanclub,tipped_recently,has_tokens,tipped_alot_recently,tipped_tons_recently);var prefix=message_receiver.get_username_prefix(username,is_mod,in_fanclub);add_system_message(prefix+'<span class="username othermessagelabel '+label_class+'" '+'data-nick="'+username+'">'+username+'</span> '+' has left the room.');}},unignore_user:function(username){$('#ignore_user_form_username').val(username);$('#ignore_user_form_remove').val('1');$.post(settings.chat_ignore_list_url,$('#ignore_user_form').serialize(),function(username){message_receiver.ignored_users=$.grep(message_receiver.ignored_users,function(a){return(a!=username);});var msg=interpolate(gettext("No longer ignoring %(username)s"),{username:username},true);add_system_message(msg,tabs.get_current_tab_domele());tabs._show_chat_tab();});},scroll_chat_into_view:function(){if(settings.scroll_on_load&&settings.textinput.offset()!=null){$(document).scrollTop(settings.textinput.offset().top-$(window).height()+settings.textinput.outerHeight()+12);function isScrolledIntoView(elem){var docViewTop=$(window).scrollTop();var docViewBottom=docViewTop+$(window).height();var elemTop=$(elem).offset().top;var elemBottom=elemTop+$(elem).height();return((elemBottom>=docViewTop)&&(elemTop<=docViewBottom));}
if($('.top-section').length>0){if(!isScrolledIntoView($('.top-section'))){$(document).scrollTop($('.top-section').offset().top);}}
save_scrolling();}}};function remove_user_from_list(nick){settings.userslist.find("[data-nick='"+nick+"']").remove();}
$(document).bind("disconnected.defchat",function(){add_system_message(gettext("chat disconnected"));consolelog("Trying to re connect to "+settings.chat_host+" with "+
settings.user+":"+settings.password);public_methods.do_show_reconnect_message();setTimeout(settings.handler.reconnect,2000);});$(document).bind("connectionfailed.defchat",function(){add_system_message(gettext("unable to connect"));});$(document).bind("connecting.defchat",function(){add_system_message(gettext("connecting"));});function htmlDecode(value){return $('<div/>').html(value).text();}
function connected(){add_system_message(gettext("connection established"));settings.handler.initializer.join_room();if(settings.welcome_message){add_system_message(settings.welcome_message);}
if(settings.welcome_warning){add_system_message(settings.welcome_warning);}
if(settings.app_info_json){var msginfo=htmlDecode(settings.app_info_json).split(',');var links=new Array();for(var i=0;i<msginfo.length;i++){var name=settings.handler.striphtml(msginfo[i].split('|')[0]);var url=settings.handler.striphtml(msginfo[i].split('|')[1]);var link="<a href=\""+url+"\" target=\"_blank\">"+name+"</a>";if(url==""){links.push(name);}
else{links.push(link);}}
if(msginfo.length>0){if(settings.handler.room_owner_nick==settings.handler.user){add_system_message("You are running these apps: "+
links.join(", "));}
else{add_system_message("Broadcaster "+settings.handler.room_owner_nick+" is running these apps: "+links.join(", "));}}}
if(settings.num_users_waiting_for_group_show>0&&settings.num_users_required_for_group_show>0){groups_and_privates.show_group_show_waiting_message(settings.num_users_waiting_for_group_show,settings.num_users_required_for_group_show)}
$(window).unload(function(){settings.handler.disconnect();});}
$(document).bind("connected.defchat",connected);$(document).bind("disconnected.defchat",settings.handler.initializer.on_disconnect);var tabs={pm_tab_visible:false,current_tab:'chat',pm_tab:null,pm_tab_map:{},settings_body:null,unread_pm_map:{},total_unread_pms:0,current_pm_nick:null,opened_pms:new Array(),is_blinking:false,open_pm:function(nick){tabs._show_pm_tab();tabs._remove_unread_pms_for_nick(nick);settings.domroot.find('.chat-box > div').hide();tabs.get_or_create_pm_tab_for_nick(nick,false).show();tabs.current_tab='pm';tabs.current_pm_nick=nick;tabs._enable_form();tabs._scroll_to_bottom();},after_close_pm:function(nick){},close_pm:function(nick){tabs._show_pm_tab();tabs._remove_unread_pms_for_nick(nick);settings.domroot.find('.chat-box > div').hide();tabs.pm_tab_map[nick].remove();tabs.pm_tab_map[nick]=null;tabs._show_chat_tab();var newopens=new Array();for(var i=0;i<tabs.opened_pms.length;i++){if(tabs.opened_pms[i]!=nick){newopens.push(tabs.opened_pms[i]);}}
tabs.opened_pms=newopens;tabs.after_close_pm(nick);},refresh_userlist:function(){var sort_key=tabs.get_sort_users_key();var newhtml=$("<div class='text' data-nick=''>"+"<class='hostmessagelabel'>Loading user list...</class></div>");public_methods.do_reset_users_list_html();settings.userslist.append(newhtml);$('#get_chat_user_list_form_room_sort_by').val(sort_key);$('#get_chat_user_list_form_room_roomname').val(settings.handler.room_owner_nick);$('#get_chat_user_list_form_room_private').val(flash_handler.initializer.is_on_private_room);$.ajax({url:$('#get_chat_user_list_form').attr('action'),data:$('#get_chat_user_list_form').serialize(),type:'POST',success:function(data,textStatus,xhr){if(!xhr.getResponseHeader('X-Successful')){alert("An error occurred");return;}
public_methods.do_reset_users_list_html();var newhtml=$("<div class='text' data-nick='' "+"style='float:right'> <a href=\"#\">"+"refresh userlist</a></div>");newhtml.bind('click',tabs.refresh_userlist);settings.userslist.append(newhtml);var results=data.split(',');for(var i in results){if(i>0){var results_split=results[i].split('|');var name=results_split[0];var color=results_split[1];var newhtml=$("<div class='text' data-nick='"+
name+"'><strong class='color-"+
color+"'>"+name+"</strong></div>");newhtml.jscontext({html:get_contextual_menu_html,bind:'anyclick'});settings.userslist.append(newhtml);}}
$.mydefchatconn('update_viewer_count',parseInt(results[0])+results.length-1);if(results[0]>0){var newhtml=$("<div class='text' data-nick=''>"+"<class='hostmessagelabel'>+"+
results[0]+" anonymous"+
(results[0]==1?" user":" users")+"</class></div>");settings.userslist.append(newhtml);}}});},on_tab_click:function(){var tab=$(this).data("tab");tabs.before_tab_click();settings.domroot.find('.chat-box > div').hide();if(tab=='users'){tabs._deactivate_tabs();$(this).closest('li').addClass('active');settings.domroot.find('.chat-box > div.users-list').show();tabs.current_tab='users';tabs._disable_form();tabs.refresh_userlist();}else if(tab=='chat'){tabs._show_chat_tab();}else if(tab=='settings'){tabs._show_settings_tab();tabs._disable_form();}else{consolelog("Unknown tab "+tab);}
tabs.after_tab_click();return false;},before_tab_click:function(tab){},after_tab_click:function(tab){},get_or_create_pm_tab_for_nick:function(nick,show_alert){if(tabs.pm_tab_map[nick]){return tabs.pm_tab_map[nick];}
if(show_alert){var msg=interpolate(gettext(("New private conversation from <span class='username' data-nick='%(username)s'>%(username)s"+"</span> <span class='pmalert'>(Press tab to cycle through your conversations or click the PM tab)"+"</span>")),{username:nick},true);add_system_message(msg);}
tabs.opened_pms.push(nick);tabs.opened_pms.sort();tabs._create_pm_tab();if(tabs.opened_pms.length>1){tabs._set_pm_tab_jscontext();}else{tabs._set_pm_tab_direct(nick);}
tabs.pm_tab_map[nick]=$("<div class='chat-list' style='display: none;'></div>");settings.domroot.find('.chat-box > div').last().after(tabs.pm_tab_map[nick]);msg=interpolate(gettext("Caution: %(sitename)s staff will NEVER contact you via chat or ask for your password. <br/><br/>"+"Private conversation with %(username)s"),{username:nick,sitename:settings.site_name,supportemail:settings.support_email},true);add_system_message(msg,tabs.pm_tab_map[nick]);return tabs.pm_tab_map[nick];},after_private_message_received:function(){},private_message_received:function(nick){if(tabs.current_tab==='pm'&&tabs.current_pm_nick==nick){return;}
if(tabs.unread_pm_map[nick]){tabs.unread_pm_map[nick]+=1;}else{tabs.unread_pm_map[nick]=1;}
tabs.total_unread_pms+=1;tabs._refresh_pm_tab_count();if(!tabs.pm_tab.hasClass('active')){if(!tabs.is_blinking){tabs._blink_pm(6,250);}}
tabs.after_private_message_received();},_blink_pm:function(numblinks,timeout){if(tabs.current_tab==='pm'){tabs.is_blinking=false;return;}
if(numblinks==0){tabs.pm_tab.removeClass('active');tabs.is_blinking=false;return;}
if(!tabs.pm_tab.hasClass('active')){tabs.pm_tab.addClass('active');}else{tabs.pm_tab.removeClass('active');}
tabs.is_blinking=true;setTimeout(function(){tabs._blink_pm(numblinks-1,timeout);},timeout);},get_current_tab_domele:function(){var r=settings.domroot.find('div.chat-list:visible');if(r.length===0){return settings.chatlist;}else{return r;}},_show_chat_tab:function(){tabs._deactivate_tabs();settings.buttons.find('li:first').addClass('active');settings.domroot.find('.chat-box > div').hide();settings.domroot.find('.chat-box > div.chat-list:first').show();var counter=$('div.chat-box span.counter');counter.find('span.val').text('0');counter.hide();settings.domroot.find('> div.chat-box span.counter').hide();tabs.current_tab='chat';tabs._enable_form();tabs._scroll_to_bottom();},_scroll_to_bottom:function(){var chat=tabs.get_current_tab_domele().get(0);$(".chat-list").height($("#player").height()+32);chat.scrollTop=chat.scrollHeight;},_disable_form:function(){settings.textinput.blur();settings.textinput.focus(function(event){settings.textinput.unbind(event);tabs._show_chat_tab();});},_enable_form:function(){settings.textinput.unbind('focus');settings.textinput.focus(save_scrolling);settings.textinput.focusout(load_scrolling);},_remove_unread_pms_for_nick:function(nick){if(tabs.unread_pm_map[nick]&&tabs.unread_pm_map[nick]>0){tabs.total_unread_pms=tabs.total_unread_pms-tabs.unread_pm_map[nick];tabs.unread_pm_map[nick]=0;tabs._refresh_pm_tab_count();}},_refresh_pm_tab_count:function(){var str;if(tabs.total_unread_pms==0){str="";}else{str="("+tabs.total_unread_pms+")";}
tabs.pm_tab.find('.pm_count').text(str);},_create_pm_tab:function(){if(!tabs.pm_tab_visible){tabs.pm_tab_visible=true;tabs.pm_tab=$("<li><a href='#' data-tab='pm'>"+"PM <span class='pm_count'></span></a></li>");settings.buttons.find('li:last').before(tabs.pm_tab);}},_set_pm_tab_direct:function(nick){tabs.pm_tab.unbind('click');tabs.pm_tab.bind('click',function(){tabs.open_pm(nick);return false;});},_set_pm_tab_jscontext:function(){tabs.pm_tab.unbind('click');tabs.pm_tab.jscontext({html:function(){var h=$("<div class='jscontextMenu'></div>");function add_link(nick,text,callback){var line=$("<div class=\"pmline\"><div class=\"user\" data-nick='"+nick+"'>"+text+"</div><div class=\"close\" data-nick='"+nick+"'></div></div>");line.find("div.user").click(callback);line.find("div.user").click(function(){jscontext('close');});line.find("div.close").click(function(event){tabs.close_pm($(event.target).attr('data-nick'));jscontext('close');});h.append(line);}
h.append("<p class=\"jscontextLabel\"><img src=\""+settings.media_url+"images/orange-arrow-down.gif\" width=\"9\" height=\"5\" alt=\"\" />Private Message with:</p><hr>");for(var i=0;i<tabs.opened_pms.length;i++){var nick=tabs.opened_pms[i];var unread=tabs.unread_pm_map[nick];if(unread&&unread>0){unread=" ("+unread+")";}else{unread="";}
add_link(nick,nick+unread,function(event){var nick=$(event.target).data('nick');tabs.open_pm(nick);});}
return h;},bind:"click"});},_deactivate_tabs:function(){settings.buttons.find('li').removeClass('active');},_show_pm_tab:function(){tabs._deactivate_tabs();tabs._create_pm_tab();tabs.pm_tab.addClass('active');},_sort_users_list:function(){var sort_key=tabs.get_sort_users_key();if(sort_key=='a'){var mylist=$('div.users-list');var listitems=mylist.children('div.text').get();listitems.sort(function(a,b){var compA=String($(a).data("nick"));compA=compA.replace('__anonymous__','zzzz');var compB=String($(b).data("nick"));compB=compB.replace('__anonymous__','zzzz');return(compA<compB)?-1:(compA>compB)?1:0;});$.each(listitems,function(idx,itm){mylist.append(itm);})}
else{var mylist=$('div.users-list');var listitems=mylist.children('div.text').get();listitems.sort(function(a,b){var compA=parseInt($(a).data("tokenbalance"));var compB=parseInt($(b).data("tokenbalance"));return(compA<compB)?1:(compA>compB)?-1:0;});$.each(listitems,function(idx,itm){mylist.append(itm);})}},apply_font_size:function(){$("div.chat-list").css("font-size",settings.font_size);},get_sort_users_key:function(){if(!settings.is_broadcasting){return'a';}
return settings.sort_users_key;},_submit_settings:function(){$.ajax({type:"POST",url:settings.chat_settings_url,data:$("#chat_settings").serialize(),success:function(response){if(response==="supporter"){alert("You must be a supporter to change this.");$("#chat_color_id").val("#494949");$('option:selected',"#id_font_family").removeAttr('selected');$("#id_font_family").find('option[value="default"]').attr('selected',true);return;}
try{var data=$.parseJSON(response);}catch(e){alert("An error occurred.");return;}
display_notice('Chat settings saved');settings.font_size=data.font_size;settings.show_emoticons=data.show_emoticons;settings.emoticon_autocomplete_delay=data.emoticon_autocomplete_delay;settings.sort_users_key=data.sort_users_key;settings.room_entry_for=data.room_entry_for;settings.room_leave_for=data.room_leave_for;settings.silence_broadcasters=data.silence_broadcasters;settings.b_tip_vol=data.b_tip_vol;settings.v_tip_vol=data.v_tip_vol;tabs.apply_font_size();if(settings.is_broadcasting){SetTipVolume(settings.b_tip_vol);if($("#tip_slider").val()!=settings.b_tip_vol){$("#tip_slider").simpleSlider("setValue",settings.b_tip_vol,false);}
$("#tip_slider_label").text("Tip Volume ("+settings.b_tip_vol+"%)");}
else{SetTipVolume(settings.v_tip_vol);if($("#tip_slider").val()!=settings.v_tip_vol){$("#tip_slider").simpleSlider("setValue",settings.v_tip_vol,false);}
$("#tip_slider_label").text("Tip Volume ("+settings.v_tip_vol+"%)");}
$("#id_broadcaster_tip_volume").val(settings.b_tip_vol);$("#id_viewer_tip_volume").val(settings.v_tip_vol);$("#id_v").val(settings.v_tip_vol);},error:function(){alert("An error occurred.");}});},_show_settings_tab:function(){tabs.current_tab='settings';settings.domroot.find('.chat-box > div').hide();if(!tabs.settings_body||settings.mod_status_changed){$(".settings-list").remove();tabs.settings_body=$("<div class='settings-list'></div>");tabs.settings_body.height($('.chat-list').height());tabs.settings_body.load(settings.chat_settings_url,function(){settings.mod_status_changed=false;if(defchat_settings.is_age_verified=='false'){var allowed_users_dropdown=$('#id_allowed_chat');allowed_users_dropdown.parent().attr('title','Only age verified broadcasters can change this setting.');allowed_users_dropdown.prev().text(allowed_users_dropdown.prev().text()+' (Age Verifcation Required)').css('color','#888');allowed_users_dropdown.prop('disabled',true);allowed_users_dropdown.after('<input type="hidden" name="allowed_chat" value="all" />');}
$("#chat_settings").live("change",function(){if(login_required()){return false;}
else{if(settings.is_broadcasting){if($("#tip_slider").hasClass('is_dragging')){settings.b_tip_vol=parseFloat($("#tip_slider").val());$("#tip_slider_label").text("Tip Volume ("+settings.b_tip_vol+"%)");$("#id_broadcaster_tip_volume").val(settings.b_tip_vol);return false;}}
else{if($("#tip_slider").hasClass('is_dragging')){settings.v_tip_vol=parseFloat($("#tip_slider").val());$("#tip_slider_label").text("Tip Volume ("+settings.v_tip_vol+"%)");$("#id_viewer_tip_volume").val(settings.v_tip_vol);return false;}}
if(settings.is_broadcasting){settings.b_tip_vol=parseFloat($("#tip_slider").val());$("#tip_slider_label").text("Tip Volume ("+settings.b_tip_vol+"%)");$("#id_broadcaster_tip_volume").val(settings.b_tip_vol);}
else{settings.v_tip_vol=parseFloat($("#tip_slider").val());$("#tip_slider_label").text("Tip Volume ("+settings.v_tip_vol+"%)");$("#id_viewer_tip_volume").val(settings.v_tip_vol);}
setTimeout(tabs._submit_settings,500);return false;}});$('#chat_color_id').mColorPicker();$('#chat_color_id').bind('colorpicked',function(){$.ajax({url:$(this).parent().attr('action'),data:$(this).parent().serialize(),type:'POST',success:function(response){if(response==="supporter"){alert("You must be a supporter to change this.");$("#chat_color_id").val("#494949");$('option:selected',"#id_font_family").removeAttr('selected');$("#id_font_family").find('option[value="default"]').attr('selected',true);return;}
display_notice('Chat settings saved');},failure:function(){alert('An error occurred.');}});});$("#ignored_users_id").click(function(){if(login_required()){return false;}
jQuery.facebox({ajax:settings.chat_ignore_list_url});});$("#mod_list_link").click(function(){if(login_required()){return false;}
jQuery.facebox({ajax:settings.chat_mod_list_url});});$("#fan_list_link").click(function(){if(login_required()){return false;}
jQuery.facebox({ajax:settings.chat_fan_list_url});});$("#geo_list_link").click(function(){if(login_required()){return false;}
jQuery.facebox({ajax:settings.chat_geo_list_url});});});settings.domroot.find('.chat-box > div').last().after(tabs.settings_body);}
tabs.settings_body.show();tabs._deactivate_tabs();settings.buttons.find('a[data-tab="settings"]').parent().addClass('active');}};settings.buttons.find('a').click(tabs.on_tab_click);$.chat_tabs=tabs;$("body").mouseup(function(e){if($("#tip_slider").hasClass('is_dragging')){tabs._submit_settings();}});var message_sender={message_to_send:'',confirmed_send:false,_recent_message_log:new Array(),_handle_action:function(){var msg=settings.textinput.val();if(msg.charAt(0)!=='/'){return false;}
var params=msg.split(" ");var action=params.shift();if(action==="/tip"){var amount=parseInt(params.shift());var message=params.join(" ");tipping.toggle_overlay(amount,message);return true;}else if(action=='/debug'){if(settings.debug_mode){settings.debug_mode=false;add_system_message("Debug mode disabled.")}else{settings.debug_mode=true;add_system_message("Debug mode enabled. "+"Type /debug again to disable.")}
return true;}
return false;},on_form_submit:function(){if($.trim(settings.textinput.val())==""){message_sender._reset_form();return false;}
if(message_sender._handle_action()){message_sender._reset_form();return false;}
if(settings.first_post_warning!==null){if(!message_sender.confirmed_send){if(!confirm(settings.first_post_warning)){return false;}
message_sender.confirmed_send=true;}}
if(!settings.handler.initializer.joined){add_system_message('not connected');return false;}
if(settings.password==='anonymous'){if(settings.login_required_callback){settings.login_required_callback();}else{add_system_message(gettext("anonymous users cannot chat - create your free account"),tabs.get_current_tab_domele());}
return false;}
message_sender.message_to_send=settings.textinput.val();message_sender._reset_form();message_sender._translate_and_send();message_sender._recent_message_log.push(new Date());return false;},_get_recent_message_log_count:function(){message_sender._remove_old_messages_from_log();return message_sender._recent_message_log.length;},_remove_old_messages_from_log:function(){var now=new Date();message_sender._recent_message_log=$.grep(message_sender._recent_message_log,function(a){return((now-a)<(10*1000));});},_user_has_tokens:function(){return(tipping.current_balance>0?'1':'0');},_translate_and_send:function(){message_sender._reset_form();if(tabs.current_tab==='pm'){settings.handler.message_outbound.send_private_message(message_sender.message_to_send,"","",tabs.current_pm_nick);}else{settings.handler.message_outbound.send_room_message(message_sender.message_to_send,"","");}},_reset_form:function(){settings.textinput.val('');settings.textinput.blur();tabs._scroll_to_bottom();}};$message_sender=message_sender;var panel={poll_timeout:null,poll_again:false,update:function(){if(panel.poll_timeout!=null){panel.poll_again=true;return;}
panel.poll_timeout=setTimeout(panel.do_future_update,2000);},do_future_update:function(){if(settings.get_panel_url){panel.poll_again=false;$('.goal_display').load(settings.get_panel_url+'?_='+(new Date()).getTime(),function(response,textStatus,jqXhr){if(response===""){if(!settings.handler.initializer.is_on_private_room){groups_and_privates.change_broadcaster_panel('default');}
$('.apps_running_launchbar').hide();$('.apps_not_running_launchbar').show();}else{$('.app_name').html(jqXhr.getResponseHeader('x-app-name'));if(!settings.handler.initializer.is_on_private_room&$('.broadcaster_panel_default').is(':visible')){groups_and_privates.change_broadcaster_panel('goal_display');}
$('.apps_running_launchbar').show();$('.apps_not_running_launchbar').hide();}
panel.poll_timeout=null;if(panel.poll_again){panel.poll_timeout=setTimeout(panel.do_future_update,2000);}});}},clear_app:function(){panel.update();public_methods.app_tab_refresh();},init:function(){panel.update();$('.stop_app').click(function(){if(confirm(gettext("Are you sure you want to remove this app?"))){$.post($(this).attr('href'),{'foo':'bar'});}
return false;});}};panel.init();var emoticons={_emoticons_loaded:false,_popup_window:null,init:function(){settings.domroot.find(".emoticon_button").click(emoticons.on_emoticon_button_clicked);},on_emoticon_button_clicked:function(ev){if(settings.login_required_callback){if(settings.login_required_callback()){return false;}}
emoticons.toggle_overlay();},on_body_clicked_while_overlay_up:function(ev){if(settings.domroot.find('.emote_popup').has(ev.target).length||settings.domroot.find('.emoticon_button').is(ev.target)){return;}
emoticons.toggle_overlay();},on_popup_clicked:function(ev){if(!emoticons._popup_window||emoticons._popup_window.closed){emoticons._popup_window=window.open($(this).attr('href'),'_blank','status=0,toolbar=0,menubar=0,directories=0,resizable=1,'+'scrollbars=1,height=615,width=850');emoticons._popup_window.onload=function(){emoticons._popup_window.RunCallbackFunction=emoticons.on_popup_callback;};$(window).unload(emoticons.on_document_closing);}
emoticons.toggle_overlay();emoticons._popup_window.focus();return false;},on_document_closing:function(){if(emoticons._popup_window){if(!emoticons._popup_window.closed){emoticons._popup_window.close();}}},on_popup_callback:function(){alert("popup callback");},on_emoticon_clicked:function(){emoticons.toggle_overlay();settings.textinput.val(settings.textinput.val()+" "+
$(this).data('emoticon')+" ");},toggle_overlay:function(){var ep=settings.domroot.find(".emote_popup");if(ep.is(":visible")){$("body").unbind('click',emoticons.on_body_clicked_while_overlay_up);ep.hide();}else{$("body").click(emoticons.on_body_clicked_while_overlay_up);if(emoticons._emoticons_loaded){ep.show();}else{emoticons._emoticons_loaded=true;ep.load(settings.emoticon_overlay_url,function(){ep.show();ep.find('.more a').click(emoticons.on_popup_clicked);ep.find('img.emoticon').click(emoticons.on_emoticon_clicked);});}}}};emoticons.init();var message_receiver={ignored_users:settings.load_ignored_users.split(','),ignore_delayed:false,on_settingsupdate:function(allow_privates,allow_groups,minimum_users_for_group_show,private_price,group_price,spy_price){if(allow_privates===true||allow_privates==='True'){$('.private_settings .value').html(gettext("Allowed"));groups_and_privates.show_private_show_controls(true);}else{$('.private_settings .value').html(gettext("Disabled"));groups_and_privates.hide_private_show_controls(true);}
if(allow_groups===true||allow_groups==='True'){$('.group_show_disabled').hide();$('.group_show_active').show();groups_and_privates.show_group_show_controls(true);}else{$('.group_show_active').hide();$('.group_show_disabled').show();groups_and_privates.hide_group_show_controls(true);}
$('.num_users_required_for_group').html(minimum_users_for_group_show);if(private_price&&private_price!=settings.private_price){var msg=interpolate(gettext('%(username)s changed Private Show price to %(price)s tokens per minute'),{username:settings.handler.room_owner_nick,price:private_price},true);add_system_message(msg,tabs.get_current_tab_domele());settings.private_price=private_price;}
if(group_price&&group_price!=settings.group_price){var msg=interpolate(gettext('%(username)s changed Group Show price to %(price)s tokens per minute'),{username:settings.handler.room_owner_nick,price:group_price},true);add_system_message(msg,tabs.get_current_tab_domele());settings.group_price=group_price;}
if(spy_price&&spy_price!=settings.spy_price){var msg=interpolate(gettext('%(username)s changed Spy on Private Show price to %(price)s tokens per minute'),{username:settings.handler.room_owner_nick,price:spy_price},true);add_system_message(msg,tabs.get_current_tab_domele());settings.spy_price=spy_price;}
return true;},get_username_class:function(username,is_mod,in_fanclub,tipped_recently,has_tokens,tipped_alot_recently,tipped_tons_recently){if(tipped_alot_recently===undefined)
tipped_alot_recently=false;if(tipped_tons_recently===undefined)
tipped_tons_recently=false;if(username===settings.handler.room_owner_jid){return'hostmessagelabel';}else if(is_mod){return'moderatormessagelabel';}else if(in_fanclub){return'fanclubmessagelabel';}else if(tipped_tons_recently){return'tippedtonsrecentlymessagelabel';}else if(tipped_alot_recently){return'tippedalotrecentlymessagelabel';}else if(tipped_recently){return'tippedrecentlymessagelabel';}else if(has_tokens){return'hastokensmessagelabel';}
return'';},get_username_prefix:function(username,is_mod,in_fanclub){if(username===settings.handler.room_owner_jid){return'Broadcaster ';}else if(is_mod){return'Moderator ';}else if(in_fanclub){return'Fan Club member ';}
return'';},_get_tip_sound_level:function(amount){if(amount>=1000){return'huge';}
else if(amount>=500){return'large';}
else if(amount>=100){return'medium';}
else if(amount>=15){return'small';}
return'tiny';},on_tipalert:function(amount,from_username,to_username,message,is_delayed,is_mod,in_fanclub,tipped_recently,has_tokens,index,tipped_alot_recently,tipped_tons_recently){if(index===undefined)
index=0;if(tipped_alot_recently===undefined)
tipped_alot_recently=false;if(tipped_tons_recently===undefined)
tipped_tons_recently=false;var msg=interpolate(gettext("tipped %(amount)s"+((amount===1)?' token':' tokens')),{amount:amount},true)
if(settings.is_broadcasting){if(!is_delayed){if($.trim(message)!=""){msg=msg+" -- "+message;}}
$.ajax({url:'/tipping/get_token_balance/',dataType:'json',type:'POST',success:function(response){if(response.success){$('.tokencount').html(response.token_balance);}}});}
if(!is_delayed){PlayBeep(message_receiver._get_tip_sound_level(amount));}
var label_class=message_receiver.get_username_class(from_username,is_mod,in_fanclub,tipped_recently,has_tokens,tipped_alot_recently,tipped_tons_recently);var msg='<span class="tipalert">'+'<span class="username othermessagelabel '+
label_class+'" '+'data-nick="'+from_username+'">'+
from_username+'</span> '+msg+'</span>';add_system_message(msg,tabs.get_current_tab_domele(),index);if(tabs.current_tab==='pm'){add_system_message(msg,settings.chatlist);}},on_purchase_alert:function(msg){add_system_message("<span class='purchasealert'>"+
msg+"</span>",tabs.get_current_tab_domele());update_tips_in_last_24();},on_user_banned:function(username){$(".chat-list div.text [data-nick='"+username+"']").each(function(index,value){$(this).parent("div.text").remove();});var text=gettext('User')+' '+username+' ';text+=gettext('was kicked out of the room and his/her messages have been removed');add_system_message(text,tabs.get_current_tab_domele());},on_user_silenced:function(silenced_nick,silencer_nick,index){if(index===undefined){index=0;}
$(".chat-list div.text [data-nick='"+silenced_nick+"']").each(function(index,value){$(this).parent("div.text").remove();});var text=interpolate(gettext("User %(username)s was silenced by %(silencer)s and his/her messages have been removed"),{username:silenced_nick,silencer:silencer_nick},true);add_system_message(text,tabs.get_current_tab_domele(),index);},on_subject_change:function(subject,show_in_chat,index){if(show_in_chat==undefined){show_in_chat='1';}
if(index===undefined){index=0;}
subject=subject.replace(new RegExp('#([a-z0-9\\-_]{2,50})','gm'),function(x){return x.toLowerCase();});var msg=interpolate(gettext("room subject changed to \"%(subject)s\""),{subject:subject.replace(new RegExp('#([a-z0-9\\-_]{2,50})','gm'),'<a href="'+settings.hashtag_url+'$1/'+settings.broadcaster_gender+'">#$1</a>')},true);if(show_in_chat==='1'){add_system_message("<span class='roommessagelabel'>"+msg+"</span>",null,index);}
$(document).trigger("subjectchanged.defchat",subject);display_subject=settings.parse_subject(subject);settings.subject.html(display_subject);settings.current_subject=subject;},add_message:function(message,domele,index){if(!domele){domele=settings.chatlist;}
var chat=domele.get(0);var should_scroll=chat.scrollTop>=chat.scrollHeight-chat.clientHeight-20;if(index!=undefined&&index!=0){var prior=null;var after=null;domele.find(".text").each(function(){if((prior===null||$(this).attr('id')<index)&&$(this).attr('id')!=undefined&&$(this).attr('id')>0){prior=$(this).attr('id');}
else if(after==null&&$(this).attr('id')!=undefined&&$(this).attr('id')>index){after=$(this).attr('id');}});if(prior===null||after===null){domele.append(message);}
else{domele.find('#'+prior).after(message);}}
else{domele.append(message);}
domele.find('div:last').find('a[rel*=facebox]').facebox();domele.find('div:last span.username').jscontext({html:get_contextual_menu_html,bind:'anyclick'});if(should_scroll){chat.scrollTop=chat.scrollHeight;}
while(domele.find('div.text').length>200){domele.find('div.text:first').empty().remove();}},_format_message:function(message,nick,room,color,font,is_mod,has_tokens,tipped_recently,in_fanclub,background_color,index,tipped_alot_recently,tipped_tons_recently){if(tipped_alot_recently===undefined)
tipped_alot_recently=false;if(tipped_tons_recently===undefined)
tipped_tons_recently=false;if(index===undefined){index=0;}
if(room==settings.handler.room){var body=message_receiver._add_emoticons(message);var r=$('<div id="'+index+'" class="text">'+'<span class="username messagelabel" '+'data-nick="'+nick+'">'+nick+':</span>'+body+'</div>');if(font!=='default'){r.css('font-family',font);}
if(background_color){r.css('background',background_color);}
r.css('color',color);if(nick===settings.handler.room_owner_jid){r.find('.messagelabel').addClass('hostmessagelabel');}else if(is_mod){r.find('.messagelabel').addClass('moderatormessagelabel');}else if(in_fanclub){r.find('.messagelabel').addClass('fanclubmessagelabel');}else if(tipped_tons_recently){r.find('.messagelabel').addClass('tippedtonsrecentlymessagelabel');}else if(tipped_alot_recently){r.find('.messagelabel').addClass('tippedalotrecentlymessagelabel');}else if(tipped_recently){r.find('.messagelabel').addClass('tippedrecentlymessagelabel');}else if(has_tokens){r.find('.messagelabel').addClass('hastokensmessagelabel');}}
return r;},_add_emoticons:function(in_body){var body=in_body;while(true){var match=body.match(/%%%\[emoticon ([^\s]+)\]%%%/);if(!match){break;}
var urlparts=match[1].split(/\|/);var show_icon=settings.show_emoticons;var ignored_emoticons=settings.ignored_emoticons;var str='<a class="facebox_link@IS_THUMBNAIL@" href="#report_emoticon" rel="facebox"><input type="hidden" name="image_url" value="@IMAGE_URL@" /><input type="hidden" name="report_url" value="@REPORT_URL@" />@IMG_HTML@</a>';var is_thumbnail=(urlparts.length==6);var img_html='<img src="'+urlparts[1]+'" title=":'+urlparts[0]+'" height="'+urlparts[3]+'" width="'+urlparts[2]+'" style="" />';if(!(show_icon)||$.inArray(urlparts[0],defchat_settings.ignored_emoticons)>=0){img_html=img_html.replace('style=""','style="display: none;"')+'<span class="emoticon_slug">:'+urlparts[0]+'</span>';}
str=str.replace('@IMG_HTML@',img_html);if(is_thumbnail){str=str.replace('@IS_THUMBNAIL@',' thumbnail');str=str.replace('@IMAGE_URL@',urlparts[4]);}else{str=str.replace('@IS_THUMBNAIL@','');str=str.replace('@IMAGE_URL@',urlparts[1]);}
str=str.replace('@REPORT_URL@',urlparts[urlparts.length-1]);body=body.replace(match[0],str);}
return body;},_validate_hex_color:function(color,default_color){if(/^#[0-9a-f]{3}([0-9a-f]{3})?$/i.test(color)){return color;}
return default_color;},_validate_font_weight:function(weight,default_weight){if(weight==='normal'||weight==='bold'||weight==='bolder'){return weight;}
return default_weight;}};var apps_and_bots={refresh_panel:function(){$('.info-user a[data-tab="apps_and_bots"]').click();}}
var groups_and_privates={init:function(){$('.start_group_show').click(groups_and_privates.start_group_show_clicked);$('.start_group_show_cancel').click(groups_and_privates.cancel_group_chat_request);$('.start_private_show').click(groups_and_privates.start_private_show_clicked);$('.start_private_show_cancel').click(groups_and_privates.cancel_private_chat_request);$('.broadcaster_panel_show_requested .accept').click(groups_and_privates.approve_private_show_clicked);$('.broadcaster_panel_show_requested .decline').click(groups_and_privates.decline_private_show_clicked);$('.broadcaster_panel_private_show .decline').click(groups_and_privates.decline_private_show_clicked);$('.broadcaster_panel_group_show_requested .accept').click(groups_and_privates.approve_group_show_clicked);$('.broadcaster_panel_group_show_requested .decline').click(groups_and_privates.decline_group_show_clicked);$('.broadcaster_panel_group_show .decline').click(groups_and_privates.decline_group_show_clicked);$('.start_group_show_link').live('click',groups_and_privates.start_group_show_clicked);$('.return_from_away_mode').live('click',groups_and_privates.return_from_away_mode_clicked);},approve_private_show_clicked:function(){if(groups_and_privates.is_responding_to_private_request()){$.post(settings.private_show_approve_url,{'foo':'bar'});}},decline_private_show_clicked:function(){if(!confirm(gettext("Are you sure?"))){return}
$.post(settings.private_show_decline_url,{'foo':'bar'});},approve_group_show_clicked:function(){$.post(settings.group_show_approve_url,{'foo':'bar'});},return_from_away_mode_clicked:function(){$.post(settings.return_from_away_url,{'foo':'bar'});settings.handler.initializer.leave_away_mode();},decline_group_show_clicked:function(){if(!confirm(gettext("Are you sure?"))){return}
$.post(settings.group_show_decline_url,{'foo':'bar'});},start_spy_on_private_clicked:function(){if(settings.login_required_callback){if(settings.login_required_callback()){return false;}}
groups_and_privates.change_private_show_link('processing');$.post(settings.spy_on_private_show_tokens_per_minute_url,{'foo':'bar'},function(data){if(parseInt(data)==0){var msg=gettext("Spy has been disabled by the broadcaster");alert(msg);return;}
var msg=interpolate(gettext("Spy on private show for (%(price)s tokens per minute)"),{modelname:settings.handler.room_owner_nick,price:data},true);if(confirm(msg)){$.post(settings.spy_on_private_show_request_url,{'chat_username':settings.muc_nickname},function(data){if(data.success){groups_and_privates.change_private_show_link('active');add_system_message("<span class='privatealert'>"+
gettext("Now spying on private show.")+"</span>");}else{if(data.message){alert(data.message);}
groups_and_privates.change_private_show_link();}},'json').error(groups_and_privates.error_starting_private_show);}else{groups_and_privates.change_private_show_link();}}).error(groups_and_privates.error_starting_private_show);},start_group_show_clicked:function(){if(settings.login_required_callback){if(settings.login_required_callback()){return false;}}
if(!settings.handler.privates_and_groups_enabled){alert("This feature is not enabled on your device.");return;}
groups_and_privates.change_group_show_link('processing');$.post(settings.group_show_tokens_per_minute_url,{'foo':'bar'},function(data){var msg=interpolate(gettext("Enter group chat with %(modelname)s? (%(price)s tokens per minute)"),{modelname:settings.handler.room_owner_nick,price:data},true);if(confirm(msg)){$.post(settings.group_show_request_url,{'chat_username':settings.muc_nickname,'price':data},function(data){if(data.success){if(!$('.start_group_show_active').is(':visible')){groups_and_privates.change_group_show_link('waiting');}
add_system_message("<span class='privatealert'>"+
gettext("Group show request has been sent.")+"</span>");}else{if(data.message){alert(data.message);}
groups_and_privates.change_group_show_link();}},'json').error(groups_and_privates.error_starting_group_show);}else{groups_and_privates.change_group_show_link();}}).error(groups_and_privates.error_starting_group_show);},show_group_show_waiting_message:function(users_waiting,users_required,index){if(index===undefined){index=0;}
if(!settings.handler.initializer.is_on_private_room){add_system_message("<span class='privatealert'>"+parseInt(users_waiting)+" of "+parseInt(users_required)+" users are ready to start a group show ("+"<a href='#' class='start_group_show_link'>join group show</a> | "+"<a href='"+settings.spy_on_cams_url+"'>more shows</a>)</span>",null,index);}
$('.num_users_waiting_for_group').html(users_waiting);},on_groupshowrequest_message:function(users_waiting,users_required,tokens_per_minute,index){if(index===undefined){index=0;}
groups_and_privates.show_group_show_waiting_message(users_waiting,users_required,index);if(settings.is_broadcasting&!settings.handler.initializer.is_on_private_room){if(parseInt(users_waiting)==parseInt(users_required)){$('.broadcaster_panel_group_show_requested .tokens_per_minute').html(tokens_per_minute);groups_and_privates.change_broadcaster_panel('group_show_requested');PlayBeep("show");}}},start_private_show_clicked:function(){if(settings.login_required_callback){if(settings.login_required_callback()){return false;}}
if(!settings.handler.privates_and_groups_enabled){alert("This feature is not enabled on your device.");return;}
groups_and_privates.change_private_show_link('processing');$.post(settings.private_show_tokens_per_minute_url,{'foo':'bar'},function(data){try{var response_data=$.parseJSON(data);}catch(e){groups_and_privates.error_starting_private_show();return;}
var msg=interpolate(gettext("Enter private chat with %(modelname)s? (%(price)s tokens per minute)"),{modelname:settings.handler.room_owner_nick,price:response_data.price},true);if(response_data.recordings_allowed){msg+="\n\nThis broadcaster allows private show recordings, so you will receive a recorded video of this show in your collection."}
else{msg+="\n\nThis broadcaster does not allow private show recordings, so you will not receive a recorded video of this show in your collection."}
if(confirm(msg)){$.post(settings.private_show_request_url,{'chat_username':settings.muc_nickname,'price':response_data.price},function(data){if(data.success){groups_and_privates.change_private_show_link('waiting');add_system_message("<span class='privatealert'>"+
gettext("Private show request has been sent. Waiting on broadcaster to approve.")+"</span>");}else{if(data.message){alert(data.message);}
groups_and_privates.change_private_show_link();}},'json').error(groups_and_privates.error_starting_private_show);}else{groups_and_privates.change_private_show_link();}}).error(groups_and_privates.error_starting_private_show);},is_requesting_group_chat:function(){return $('.start_group_show_waiting').is(':visible')|$('.start_group_show_processing').is(':visible');},is_requesting_private_chat:function(){return $('.start_private_show_waiting').is(':visible');},is_responding_to_private_request:function(){return $('.broadcaster_panel_show_requested').is(':visible');},on_groupshowrequest_approvemessage:function(tokens_per_minute){add_system_message("<span class='privatealert'>"+
gettext("Group show has started.")+"</span>");if(settings.handler.initializer.is_on_private_room){return;}
$('.tokens_per_minute').html(tokens_per_minute);if(groups_and_privates.is_requesting_group_chat()|settings.is_broadcasting){groups_and_privates.change_group_show_link('active');groups_and_privates.change_broadcaster_panel('group_show');settings.handler.initializer.change_to_private_room(true);}},on_privateshowrequest_approvemessage:function(tokens_per_minute){add_system_message("<span class='privatealert'>"+
gettext("Private show has started.")+"</span>");if(settings.handler.initializer.is_on_private_room){return;}
if(groups_and_privates.is_requesting_private_chat()|settings.is_broadcasting){groups_and_privates.change_private_show_link('active');groups_and_privates.change_broadcaster_panel('private_show');$('.tokens_per_minute').html(tokens_per_minute);settings.handler.initializer.change_to_private_room(false);}},change_broadcaster_panel:function(name){if(public_methods.is_goal_set()&&name=='default'){name='goal_display';}
$('.broadcaster_panel_default').hide();$('.broadcaster_panel_private_show').hide();$('.broadcaster_panel_group_show').hide();$('.broadcaster_panel_show_requested').hide();$('.broadcaster_panel_group_show_requested').hide();$('.broadcaster_panel_goal_configuration').hide();$('.broadcaster_panel_goal_display').hide();$('.broadcaster_panel_away').hide();$(".broadcaster_panel_"+name).show();},on_groupshowrequest_cancelmessage:function(index){if(index===undefined){index=0;}
$('.num_users_waiting_for_group').html('0');if(settings.handler.initializer.is_on_private_room){if(settings.is_broadcasting){groups_and_privates.change_broadcaster_panel('away');}
add_system_message("<span class='privatealert'>"+
gettext("Group show has finished.")+"</span>",null,index);settings.handler.initializer.leave_private_room();groups_and_privates.change_group_show_link();}else{if(groups_and_privates.is_requesting_group_chat()){add_system_message("<span class='privatealert'>"+
gettext("Group show has been declined.")+"</span>",null,index);groups_and_privates.change_group_show_link();}
if(settings.is_broadcasting){groups_and_privates.change_broadcaster_panel('default');}}},on_awaystatus_cancelmessage:function(){if(settings.is_broadcasting){groups_and_privates.change_broadcaster_panel('default');}},on_privateshowrequest_cancelmessage:function(index){if(index===undefined){index=0;}
if(settings.handler.initializer.is_on_private_room){add_system_message("<span class='privatealert'>"+
gettext("Private show has finished.")+"</span>");settings.handler.initializer.leave_private_room();groups_and_privates.change_private_show_link();if(settings.is_broadcasting){groups_and_privates.change_broadcaster_panel('away');}}else{if(groups_and_privates.is_requesting_private_chat()){add_system_message("<span class='privatealert'>"+
gettext("Private show has been declined.")+"</span>");groups_and_privates.change_private_show_link();}
if(settings.is_broadcasting){groups_and_privates.change_broadcaster_panel('default');}else{groups_and_privates.change_private_show_link();add_system_message("<span class='privatealert'>"+
gettext("Private show has finished.")+"</span>",null,index);}}},on_leaveprivateroom_message:function(username){if(username==settings.my_username){settings.handler.initializer.leave_private_room();groups_and_privates.change_group_show_link();}},on_privateshowrequest_message:function(requester_username,tokens_per_minute){if(settings.is_broadcasting){$('.broadcaster_panel_show_requested .requester_username').html(requester_username);$('.broadcaster_panel_show_requested .tokens_per_minute').html(tokens_per_minute);groups_and_privates.change_broadcaster_panel('show_requested');PlayBeep("show");$('.privatealert').unbind('click',groups_and_privates.approve_private_show_clicked);add_system_message("<span class='privatealert'>"+requester_username+" wants to start a private show (<a href=\"#\">start private show</a>)</span>");$('.privatealert').bind('click',groups_and_privates.approve_private_show_clicked);}},error_starting_group_show:function(){alert(gettext("There was an error requesting your show. Please try again."));groups_and_privates.change_group_show_link();},error_starting_private_show:function(){alert(gettext("There was an error requesting your show. Please try again."));groups_and_privates.change_private_show_link();},cancel_group_chat_request:function(){if(confirm(gettext("Are you sure?"))){$.post(settings.group_show_cancel_url,{'foo':'bar'});groups_and_privates.change_group_show_link();}},cancel_private_chat_request:function(){if(confirm(gettext("Are you sure?"))){$.post(settings.private_show_cancel_url,{'foo':'bar'});groups_and_privates.change_private_show_link();}},change_group_show_link:function(link){$('.start_group_show').hide();$('.start_group_show_waiting').hide();$('.start_group_show_processing').hide();$('.start_group_show_active').hide();var key='.start_group_show';if(link){key=key+"_"+link;groups_and_privates.hide_private_show_controls();}else{groups_and_privates.show_private_show_controls();}
$(key).show();},change_private_show_link:function(link){$('.start_private_show').hide();$('.start_private_show_processing').hide();$('.start_private_show_waiting').hide();$('.start_private_show_active').hide();var key='.start_private_show';if(link){key=key+"_"+link;groups_and_privates.hide_group_show_controls();}else{groups_and_privates.show_group_show_controls();}
$(key).show();},hide_private_show_controls:function(force){$('.private_show_controls').hide();if(force){$('.private_show_controls').data('forcehidden','1');}
groups_and_privates.show_group_show_controls();},show_private_show_controls:function(force){if(force|$('.private_show_controls').data('forcehidden')!='1'){$('.private_show_controls').show();}},hide_group_show_controls:function(force){$('.group_show_controls').hide();if(force){$('.group_show_controls').data('forcehidden','1');}},show_group_show_controls:function(force){if(force|$('.group_show_controls').data('forcehidden')!='1'){$('.group_show_controls').show();}}};groups_and_privates.init();var tipping={current_balance:0,tipped_performer_last_24hrs:0,last_tip_option:'',init:function(){$(".tip_button").click(tipping.on_tipping_button_clicked);settings.domroot.find('.tip_popup form').submit(tipping.on_form_submit);tipping.current_balance=settings.token_balance;tipping.tipped_performer_last_24hrs=settings.tipped_performer_last_24hrs;$(document).bind('keydown','ctrl+s',tipping.on_key_down);$(document).bind('keydown','command+s',tipping.on_key_down);$(document).bind('keydown','esc',tipping._hide_tip_overlay);$("#rate_up").click(function(){tipping.rate_model(10);});$("#rate_down").click(function(){tipping.rate_model(0);});tipping.check_rating_ctrl();},_hide_tip_overlay:function(event){var ep=settings.domroot.find(".tip_popup");if(ep.is(":visible")){$("body").unbind('click',tipping.on_body_clicked_while_overlay_up);$("#id_tip_amount").blur();$("#tip_message").blur();ep.hide();public_methods.enable_html5_video_controls();return true;}
return false;},on_key_down:function(event){tipping.toggle_overlay();return false;},on_form_submit:function(){var amount=parseInt($("#id_tip_amount").val());if(isNaN(amount)|amount<1){alert(gettext("Invalid tip amount."));return false;}
if(amount>tipping.current_balance){alert(gettext("You do not have enough tokens."));return false;}
var msg=interpolate(gettext("Send %(tokens)s tokens to %(username)s?"),{username:settings.handler.room_owner_nick,tokens:amount},true);tipping.last_tip_option=$("#tip_options_select").val();if(amount>100){if(!confirm(msg)){return false;}}
var $form=$(this);$.ajax({url:$(this).attr('action'),dataType:'json',data:$(this).serialize(),type:'POST',success:function(response){if(response.error){alert(response.error);}else if(response.success){$form.find("textarea").val("");tipping.current_balance=parseInt(response.token_balance);tipping.tipped_performer_last_24hrs=parseInt(response.tipped_performer_last_24hrs);$('.tokencount').html(response.token_balance);$('.balance ').load(window.location.pathname+' .balance');$('.token_balance').load(window.location.pathname+' .token_balance');tipping.check_rating_ctrl();}else{alert('An error occurred.');}}});tipping.toggle_overlay();return false;},rate_model:function(rating){if(rating===settings.last_vote_in_past_24_hours||(rating<5&&!confirm(interpolate(gettext("Are you sure you want to rate %(username)s thumbs down?"),{username:settings.handler.room_owner_nick.ucfirst()},true)))){return false;}
$.ajax({url:settings.rate_model_url,dataType:'json',data:{csrfmiddlewaretoken:$.cookie('csrftoken'),rating:rating},type:'POST',success:function(response){if(response.error){alert(response.error);}else if(response.success){settings.last_vote_in_past_24_hours=rating;tipping.highlight_chosen_thumb();tipping.rating_response_message(interpolate(gettext("Note: Your confidential vote of %(vote)s for %(performer)s has been recorded. You may change your vote at any time today. You can register another vote each day. Thank you for your feedback."),{vote:rating>=5?'thumbs up':'thumbs down',performer:settings.handler.room_owner_nick.ucfirst()},true));}else{tipping.rating_response_message(interpolate(gettext("Note: Your vote for %(performer)s was NOT recorded. Your 24 hour window of eligibility to vote may have very recently expired."),{performer:settings.handler.room_owner_nick.ucfirst()},true));tipping.tipped_performer_last_24hrs=0;tipping.check_rating_ctrl();}}});},highlight_chosen_thumb:function(){if(settings.last_vote_in_past_24_hours===undefined){return false;}
if(settings.last_vote_in_past_24_hours>=5){$("#thumb_up_off").hide();$("#thumb_up_on").show();$("#thumb_down_on").hide();$("#thumb_down_off").show();}else{$("#thumb_up_on").hide();$("#thumb_up_off").show();$("#thumb_down_off").hide();$("#thumb_down_on").show();}
return true;},rating_response_message:function(msg){if($('.chat-box').length){add_system_message(msg);}else{setTimeout(function(){alert(msg);},100);}},check_rating_ctrl:function(){var eligible=(tipping.tipped_performer_last_24hrs>=settings.min_tips_reqd_to_vote);if(tipping.eligible_to_vote===false&&eligible){setTimeout(function(){tipping.rating_response_message(interpolate(gettext("Note: For tipping at least %(min)s tokens today, you can now vote what you think about %(performer)s. Your vote is confidential. See below for the satisfaction feedback controls."),{min:settings.min_tips_reqd_to_vote,performer:settings.handler.room_owner_nick.ucfirst()},true));},500);}
if(eligible){$("#model_rating_ctrl_dim").hide();$("#model_rating_ctrl").show();$("#model_rating_ctrl_dim_with_scores").hide();$("#model_rating_ctrl_with_scores").show();tipping.highlight_chosen_thumb();}else{$("#model_rating_ctrl").hide();$("#model_rating_ctrl_dim").show();$("#model_rating_ctrl_with_scores").hide();$("#model_rating_ctrl_dim_with_scores").show();}
tipping.eligible_to_vote=eligible;return eligible},on_tipping_button_clicked:function(ev){if(settings.login_required_callback){if(settings.login_required_callback()){return false;}}
if(!(tabs.current_tab=='pm'|tabs.current_tab=='chat')){tabs._show_chat_tab();}
tipping.toggle_overlay();},on_body_clicked_while_overlay_up:function(ev){if(settings.domroot.find('.tip_popup').has(ev.target).length||$('.tip_button').is(ev.target)){return;}
tipping.toggle_overlay();},toggle_overlay:function(amount,message){if(!settings.allow_tipping){return;}
if(!(typeof _gaq==='undefined')){_gaq.push(['_trackPageview','/tracking/toggle_tipping_overlay/']);}
var ep=settings.domroot.find(".tip_popup");if(!tipping._hide_tip_overlay()){$("body").click(tipping.on_body_clicked_while_overlay_up);public_methods.disable_html5_video_controls();$.ajax({url:settings.tipping_current_tokens_url,type:'GET',data:'foo=bar&room='+settings.handler.room_owner_nick,dataType:'json',cache:false,success:function(response){tipping.current_balance=parseInt(response.token_balance);$("#tip_message").show();$("#tip_options").hide();$("#tip_options_select").empty();if(response.tip_options){try{var tipoptions=$.parseJSON(response.tip_options).tip_options;if(tipoptions){$("#tip_message").hide();$("#tip_options").show();$("#tip_options_select").empty();$("#tip_options_select_label").text(tipoptions.label);$("#tip_options_select").append($("<option/>").attr("value","").text("-- Select One --"));$(tipoptions.options).each(function(index,elem){var newoption=$("<option/>").attr("value",elem.label).text(elem.label);if(elem.label==tipping.last_tip_option){newoption.attr("selected",'1');}
$("#tip_options_select").append(newoption);});}}catch(err){alert("Unable to construct tip panel. Perhaps an app returned invalid tip options.")
return;}}
$('.tokencount').html(response.token_balance);ep.css('z-index','999999');ep.show();ep.find('#id_tip_amount').focus();ep.find('#id_tip_msg_input').val("");if(amount!=='undefined'&&typeof amount==="number"&&!isNaN(amount)){ep.find('#id_tip_amount').val(amount);if(message!=='undefined'&&typeof message==="string"&&message.length>0){ep.find('#id_tip_msg_input').val(message);}}
ep.find('#id_tip_amount').select();}});}}};tipping.init();function shiftCode(shift,code){if(code===27||code===8||code===9||code===20||code===16||code===17||code===91||code===13||code===92||code===18){return'';}
if(typeof shift!="boolean"||typeof code!="number"){return'';}
var shift_chars=[];shift_chars[192]="~";shift_chars[49]="!";shift_chars[50]="@";shift_chars[51]="#";shift_chars[52]="$";shift_chars[53]="%";shift_chars[54]="^";shift_chars[55]="&";shift_chars[56]="*";shift_chars[57]="(";shift_chars[48]=")";shift_chars[109]="_";shift_chars[189]="_";shift_chars[107]="+";shift_chars[187]="+";shift_chars[219]="{";shift_chars[221]="}";shift_chars[220]="|";shift_chars[59]=":";shift_chars[186]=":";shift_chars[222]="\"";shift_chars[188]="<";shift_chars[190]=">";shift_chars[191]="?";shift_chars[32]=" ";var special_chars=[];special_chars[192]='`';special_chars[189]='-';special_chars[187]='=';special_chars[219]='[';special_chars[221]=']';special_chars[220]='\\';special_chars[186]=';';special_chars[222]='\'';special_chars[188]=',';special_chars[190]='.';special_chars[191]='/';if(shift){if(code>=65&&code<=90){return String.fromCharCode(code);}
return shift_chars[code];}else{if(code>=65&&code<=90){return String.fromCharCode(code).toLowerCase();}
if(special_chars[code]){return special_chars[code];}
return String.fromCharCode(code);}}
var keybinder={current_focus:null,init:function(){$(document).keydown(keybinder.handle_keydown);$(":input").live('focus',keybinder.on_focus);$(":input").live('blur',keybinder.on_blur);},handle_keydown:function(e){if(e.which===8&&!$(e.target).is("input, textarea")){settings.textinput.focus();return;}
if(keybinder.current_focus!==null||e.metaKey){return;}
if(e.keyCode===13){message_sender.on_form_submit();return;}
if((e.keyCode>=65&&e.keyCode<=90)||(e.keyCode>=48&&e.keyCode<=57)||(e.keyCode>=186&&e.keyCode<=222)){if($('#xmovie').is(":focus")){settings.textinput.focus().val(settings.textinput.val()+
shiftCode(e.shiftKey,e.keyCode));}
else{settings.textinput.focus().val(settings.textinput.val());}}},on_blur:function(){keybinder.current_focus=null;},on_focus:function(){keybinder.current_focus=this.id;}};keybinder.init();tabs.apply_font_size();settings.form.submit(message_sender.on_form_submit);settings.submitbutton.click(message_sender.on_form_submit);if(settings.throttlechat){if(settings.welcome_message){add_system_message(settings.welcome_message);}
if(settings.welcome_warning){add_system_message(settings.welcome_warning);}
add_system_message(settings.throttle_message);}else{settings.handler.connect(settings.chat_host,settings.user,settings.password,message_receiver,settings.room,settings,groups_and_privates);}
if(!settings.handler.is_broadcasting){message_receiver.on_subject_change(settings.handler.sanitize(settings.default_subject),false);}
if(settings.initial_viewer_count!=null){public_methods.update_viewer_count(settings.initial_viewer_count);}
function zoomDisable(){$('head meta[name=viewport]').remove();$('head').prepend('<meta name="viewport" content="user-scalable=0" />');}
function zoomEnable(){$('head meta[name=viewport]').remove();$('head').prepend('<meta name="viewport" content="user-scalable=1" />');}
function allow_scroll_saving(){settings.scroll_saving_allowed=true;}
function save_scrolling(){settings.scroll_saving_allowed=false;setTimeout(allow_scroll_saving,1000);settings.saved_scroll_top=$(document).scrollTop();zoomDisable();}
function load_scrolling(){$(document).scrollTop(settings.saved_scroll_top);zoomEnable();}
settings.textinput.focus(save_scrolling);settings.textinput.focusout(load_scrolling);$('#id_tip_msg_input').focus(save_scrolling);$('#id_tip_msg_input').focusout(load_scrolling);$("#id_tip_amount").focus(save_scrolling);$("#id_tip_amount").focusout(load_scrolling);$('#id_additional_comments').focus(save_scrolling);$('#id_additional_comments').focusout(load_scrolling);$(document).scroll(function(){if(settings.scroll_saving_allowed&&settings.textinput.is(":focus")){settings.saved_scroll_top=$(document).scrollTop();}});$(document).bind('keydown','tab',function(e){if($('#login_inputs').is(":visible")){return;}
e.preventDefault();});$(document).bind('keydown','shift+tab',function(e){if($('#login_inputs').is(":visible")){return;}
e.preventDefault();});$(document).bind('keyup','shift+tab',function(e){if($('#login_inputs').is(":visible")){var focus_within=false;$('#login_inputs').children().each(function(){$(this).children().each(function(){if($(this).is(":focus")){focus_within=true;}});});if(!focus_within){$('#id_forgotpw_link').focus();}}});$(document).bind('keyup','tab',function(e){if($('#login_inputs').is(":visible")){var focus_within=false;$('#login_inputs').children().each(function(){$(this).children().each(function(){if($(this).is(":focus")){focus_within=true;}});});if(!focus_within){$('#id_close_link').focus();}}});apply_input_tab_override($('#id_tip_amount, #id_tip_msg_input, #id_tip_message'));apply_input_tab_override($('#id_tip_amount, #tip_options_select, #id_tip_message'));apply_input_tab_override($('#id_abuse_category_select, #id_additional_comments, '+'#abuse_cancel_button, #abuse_report_button'));var returnhandle=function(method){if(public_methods[method]){return public_methods[method].apply(this,Array.prototype.slice.call(arguments,1));}else if(typeof method==='object'||!method){return public_methods.init.apply(this,arguments);}else{$.error('Method '+method+' does not exist in defchat');}};return returnhandle;};})(jQuery);var notice_timeout;function display_notice(message){var notice=$('#settings_notice');notice.stop(true,true);clearTimeout(notice_timeout);var chat_box=$('.chat-box');notice.text(message);notice.css({top:chat_box.offset().top+30,left:chat_box.offset().left+chat_box.width()-notice.width()-32});notice.fadeIn('fast');notice_timeout=setTimeout(function(){notice.fadeOut('slow');},3000);}
function isAnyIE(){if(navigator.appName=='Microsoft Internet Explorer'||!!(navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/rv 11/))||$.browser.msie==1)
return true;else
return false;}
var mock_handler={user:"",password:"",flash_initialized:false,room:"",room_owner_jid:"",room_owner_nick:"",defchat_message_receiver:null,defchat_settings:null,defchat_groups_and_privates:null,connect:function(flash_host,user,password,msg_receiver,room,settings,groups_and_privates){if(room.indexOf("@")!=-1){room=room.split("@")[0];}
mock_handler.room_owner_jid=room;mock_handler.room_owner_nick=room;},disconnect:function(){},start_connection_process:function(){},reconnect:function()
{},consolelog:function(msg){},errorlog:function(msg){if('console'in window&&'log'in window.console){console.error(msg);}},reinit:function(){},connect_callbacks:{connected:function(){return true;},connecting:function(){return true;},disconnected:function(){return true;},failed:function(allow_reconnect){return true;},initialized:function(){return true;}},striphtml:function(data){if(data==null){return"";}
return $('<div/>').text(data).html();},sanitize:function(data){if(data==null){return"";}
return $('<div/>').text(unescape(data)).html();},user_is_ignored:function(nick){return false;},message_inbound:{user_personally_joined_room:function(){return true;},user_personally_left_room:function(){return true;},user_personally_kicked:function(reason){return true;},user_promoted:function(to_nick,from_nick){return true;},user_revoked:function(to_nick,from_nick){return true;},user_silenced:function(silenced_nick,silencer_nick){return true;},user_kicked:function(nick){return true;},title_changed:function(title){return true;},on_room_message:function(nick,message){return true;},on_private_message:function(from_nick,message,tab_nick){return true;},on_room_user_list:function(user_list,role_list,token_list){return true;},notify_goalset:function(amount,current,hightipper,hightipper_amount,lasttipper,lasttipper_amount){return true;},notify_messagechangerequest:function(subject){return true;},notify_goalcancel:function(){return true;},notify_tipalert:function(amount,from_username,to_username,message,history){return true;},notify_goalreached:function(){return true;},notify_settingsupdate:function(allow_privates,allow_groups,minimum_users_for_group_show,private_price,group_price,spy_price){return true;},notify_privateshowrequest:function(requester_username,tokens_per_minute){return true;},notify_groupshowrequest:function(users_waiting,users_required,tokens_per_minute)
{return true;},notify_privateshowcancel:function(){return true;},notify_groupshowcancel:function(){return true;},notify_privateshowapprove:function(tokens_per_minute){return true;},notify_groupshowapprove:function(tokens_per_minute){return true;},notify_tokenbalanceupdate:function(usernames,token_amounts){return true;},notify_leaveprivateroom:function(username){return true;},notify:function(message){return true;}},message_outbound:{send_room_message:function(message,color,font){},send_private_message:function(message,color,font,pm_nick){},send_kickban_user:function(nick){},send_change_title:function(title){}},try_to_connect:function(){},get_conn:function(){return null;},get_account_name:function(jid){return jid;},initializer:{attempts:0,joined:false,joined_at:null,is_on_private_room:false,leave_away_mode:function(){},retry_join_room:function(){},join_room:function(){},change_to_private_room:function(){},leave_private_room:function(){},leave_room:function(){},on_disconnect:function(){}},};var html_handler={user:"",password:"",room:"",room_owner_jid:"",room_owner_nick:"",defchat_message_receiver:null,defchat_settings:null,defchat_groups_and_privates:null,connected:false,chat_poller:null,poll_address:"",post_address:"",last_poll_time:0,privates_and_groups_enabled:false,message_indices:[],pm_indices:[],post_pm_address:"",_get_min_index:function(){if(html_handler.message_indices.length==0){return 0;}
var prev=null;for(var x=0;x<html_handler.message_indices.length;x++){if(prev==null){prev=html_handler.message_indices[x];continue;}
if(html_handler.message_indices[x]!=(prev+1)){return(prev+1);}
prev=html_handler.message_indices[x];}
return(html_handler.message_indices[html_handler.message_indices.length-1]+1);},_get_pm_index:function(){if(html_handler.pm_indices.length==0){return 0;}
var prev=null;for(var x=0;x<html_handler.pm_indices.length;x++){if(prev==null){prev=html_handler.pm_indices[x];continue;}
if(html_handler.pm_indices[x]!=(prev+1)){return(prev+1);}
prev=html_handler.pm_indices[x];}
return(html_handler.pm_indices[html_handler.pm_indices.length-1]+1);},poll_html_chat:function(){$('#html_chat_poll_form_room_slug').val(html_handler.room_owner_nick);$('#html_chat_poll_form_min_index').val(html_handler._get_min_index());$('#html_chat_poll_form_pm_index').val(html_handler._get_pm_index());$.ajax({url:html_handler.poll_address,dataType:'json',data:$('#html_chat_poll_form').serialize(),type:'GET',success:function(response){if(!html_handler.connected){html_handler.connected=true;html_handler.initializer.joined=true;$(document).trigger("connected.defchat");}
for(var x=0;x<response.messages.length;x++){html_handler.consolelog(response.messages[x]);try{var j=$.parseJSON(response.messages[x]);}catch(e){continue;}
var idx=parseInt(response.indices[x]);if($.inArray(idx,html_handler.message_indices)==-1){html_handler.message_indices.push(idx);html_handler.message_indices.sort();if(j["notify_type"]==="title_changed"){html_handler.message_inbound.title_changed(j["subject"],'1',idx);}
else if(j["notify_type"]==="notify"){html_handler.message_inbound.notify(j["message"],'0',idx);}
else if(j["notify_type"]==="settingsupdate"){html_handler.message_inbound.notify_settingsupdate(j["allow_privates"],j["allow_groups"],j["minimum_users_for_group_show"],j["private_price"],j["group_price"],j["spy_price"]);}
else if(j["notify_type"]==="privateshowcancel"){html_handler.message_inbound.notify_privateshowcancel(idx);}
else if(j["notify_type"]==="groupshowcancel"){html_handler.message_inbound.notify_groupshowcancel(idx);}
else if(j["notify_type"]==="groupshowrequest"){html_handler.message_inbound.notify_groupshowrequest(j['users_waiting'],j['users_required'],j['tokens_per_minute'],idx);}
else if(j["notify_type"]==="modpromoted"){html_handler.message_inbound.user_promoted(j['to_username'],j['from_username'],idx);}
else if(j["notify_type"]==="modrevoked"){html_handler.message_inbound.user_revoked(j['to_username'],j['from_username'],idx);}
else if(j["notify_type"]==="usersilenced"){html_handler.message_inbound.user_silenced(j['to_username'],j['from_username'],idx);}
else{html_handler.message_inbound.on_room_message(null,j,idx);}}}
for(x=0;x<response.pms.length;x++){html_handler.consolelog(response.pms[x]);try{$.parseJSON(response.pms[x]);var from=response.pm_froms[x];var to=response.pm_tos[x];}catch(e){continue;}
idx=parseInt(response.pm_indices[x]);if($.inArray(idx,html_handler.pm_indices)==-1){html_handler.pm_indices.push(idx);html_handler.pm_indices.sort();html_handler.message_inbound.on_private_message(from,response.pms[x],from===html_handler.user?to:from);}}
$.mydefchatconn('update_viewer_count',html_handler.sanitize(response.user_count));html_handler.chat_poller=setTimeout(html_handler.poll_html_chat,2000);},error:function(response){html_handler.chat_poller=setTimeout(html_handler.poll_html_chat,2000);}});},post_html_chat:function(message){$('#html_chat_post_public_form_room_slug').val(html_handler.room_owner_nick);$('#html_chat_post_public_form_message').val(message);$.ajax({url:html_handler.post_address,dataType:'json',data:$('#html_chat_post_public_form').serialize(),type:'POST',success:function(response){if(response===""){alert("An error occurred");return;}
if(response["X-Spam"]){html_handler.message_inbound.on_room_message(html_handler.user,response)}
if(response["X-Denied"]){$.mydefchatconn('do_show_system_message',response["X-Denied"]);}}});},post_html_pm:function(message,to_user){$('#html_chat_post_pm_form_room_slug').val(html_handler.room_owner_nick);$('#html_chat_post_pm_form_message').val(message);$('#html_chat_post_pm_form_to_user').val(to_user);$.ajax({url:html_handler.post_pm_address,dataType:'json',data:$("#html_chat_post_pm_form").serialize(),type:'POST',success:function(response){if(response==""){alert("An error occurred");return;}
if(response["X-Spam"]){html_handler.message_inbound.on_room_message(html_handler.user,response)}
if(response["X-Denied"]){$.mydefchatconn('do_show_system_message',response["X-Denied"]);}}});},stop_polling:function(){if(html_handler.chat_poller){clearTimeout(html_handler.chat_poller);html_handler.chat_poller=null;}},start_polling:function(){html_handler.stop_polling();html_handler.poll_html_chat();},connect:function(flash_host,user,password,msg_receiver,room,settings,groups_and_privates){if(user.indexOf("@")!=-1){user=user.split('@')[0];}
html_handler.user=user;html_handler.password=password;html_handler.defchat_message_receiver=msg_receiver;if(room.indexOf("@")!=-1){room=room.split("@")[0];}
html_handler.room_owner_jid=html_handler.room_owner_nick=room;html_handler.defchat_settings=settings;html_handler.defchat_groups_and_privates=groups_and_privates;html_handler.poll_address=settings.html_chat_poll_url;html_handler.post_address=settings.post_html_chat_message_url;html_handler.post_pm_address=settings.post_html_pm_message_url;html_handler.start_polling();},disconnect:function(){html_handler.stop_polling();},reconnect:function(){html_handler.connect();},consolelog:function(msg){},errorlog:function(msg){if('console'in window&&'log'in window.console){console.error(msg);}},reinit:function(){html_handler.initializer.joined=false;html_handler.initializer.attempts=0;html_handler.initializer.is_on_private_room=false;},striphtml:function(data){if(data==null){return"";}
return $('<div/>').text(data).html();},sanitize:function(data){if(data==null){return"";}
return $('<div/>').text(unescape(data)).html();},user_is_ignored:function(nick){if($.inArray(nick,html_handler.defchat_message_receiver.ignored_users)!==-1){return true;}},message_outbound:{send_room_message:function(message,color,font){html_handler.consolelog("User is sending message: "+message);var message=$.toJSON({"m":message,"c":color,"f":font});html_handler.consolelog(message);html_handler.post_html_chat(message);},send_private_message:function(message,color,font,pm_nick){html_handler.consolelog("User is sending private message to user "+
pm_nick+": "+message);var message=$.toJSON({"m":message,"c":color,"f":font});html_handler.consolelog(message);html_handler.post_html_pm(message,pm_nick);},send_kickban_user:function(nick){html_handler.consolelog("User is sending kick user "+"command for "+nick);},send_change_title:function(title){html_handler.consolelog("User is changing room title to "+title);}},message_inbound:{user_personally_joined_room:function(){if(!html_handler.initializer.joined)
{html_handler.initializer.joined=true;html_handler.initializer.joined_at=new Date();if(html_handler.user===html_handler.room_owner_nick){if(html_handler.defchat_settings.current_subject===""&&!$.mydefchatconn('is_goal_set')){html_handler.message_outbound.send_change_title(html_handler.defchat_settings.default_subject);}}}
return true;},user_personally_left_room:function(){if(!html_handler.initializer.joined)
{html_handler.initializer.joined=false;}
return true;},user_personally_kicked:function(reason){reason=html_handler.sanitize(reason);$.mydefchatconn('do_show_kicked_message',reason);return true;},user_promoted:function(to_nick,from_nick,index){if(index===undefined){index=0;}
var to_nick=html_handler.striphtml(to_nick);var from_nick=html_handler.striphtml(from_nick);html_handler.consolelog("User "+to_nick+" has been promoted"+" to moderator from participant");$.mydefchatconn('do_announce_promote',from_nick,to_nick,index);return true;},user_revoked:function(to_nick,from_nick,index){if(index===undefined){index=0;}
var to_nick=html_handler.striphtml(to_nick);var from_nick=html_handler.striphtml(from_nick);html_handler.consolelog("User "+to_nick+" has been revoked "+"from moderator to participant");$.mydefchatconn('do_announce_revoke',from_nick,to_nick,index);return true;},user_silenced:function(silenced_nick,silencer_nick,index){if(index===undefined){index=0;}
silenced_nick=html_handler.sanitize(silenced_nick);silencer_nick=html_handler.sanitize(silencer_nick);html_handler.consolelog("User "+silenced_nick+" has been "+"silenced by "+silencer_nick);html_handler.defchat_message_receiver.on_user_silenced(silenced_nick,silencer_nick,index);return true;},user_kicked:function(nick){nick=html_handler.sanitize(nick);html_handler.consolelog("User "+nick+" has been "+"kick/banned from the room");html_handler.defchat_message_receiver.on_user_banned(nick);return true;},title_changed:function(title,show_in_chat,index){if(show_in_chat==undefined){show_in_chat='1';}
if(index===undefined){index=0;}
title=html_handler.sanitize(title);html_handler.consolelog("Room title has been changed to "+title);html_handler.defchat_message_receiver.on_subject_change(title,show_in_chat,index);return true;},on_room_message:function(nick,msginfo,index){if(nick===null){var nick=html_handler.sanitize(msginfo.user);}
else{var nick=html_handler.sanitize(nick);}
if(index===undefined){index=0;}
var message=html_handler.striphtml(msginfo.m);html_handler.consolelog("Room message: "+message);if($('.broadcaster_panel_away').is(':visible')){return true;}
if(nick==""){html_handler.defchat_message_receiver.add_message('<div id="'+index+'" class="text">'+'<p>'+message+'</p></div>',null,index);}
else{if(html_handler.user_is_ignored(nick)){return true;}
html_handler.defchat_message_receiver.add_message(html_handler.defchat_message_receiver._format_message(message,nick,html_handler.room,msginfo.c,msginfo.f,msginfo.is_mod,msginfo.has_tokens,msginfo.tipped_recently,msginfo.in_fanclub,msginfo.background,index,msginfo.tipped_alot_recently,msginfo.tipped_tons_recently),null,index);$.mydefchatconn('increment_public_tab_counter');}
return true;},on_private_message:function(from_nick,message,tab_nick){message=unescape(message);try{var msginfo=$.parseJSON(message);}catch(e){var msginfo={"m":message,'in_fanclub':false,'is_mod':false,"c":"","f":"","has_tokens":false};}
var from_nick=html_handler.sanitize(from_nick);var message=html_handler.striphtml(msginfo.m);var tab_nick=html_handler.sanitize(tab_nick);if(!tab_nick||tab_nick==""){tab_nick=from_nick;}
if(from_nick==""){html_handler.defchat_message_receiver.add_message('<div class="text"><p>'+message+'</p></div>',$.mydefchatconn('do_get_or_create_pm_tab_for_nick',tab_nick,true));}
else{if(html_handler.user_is_ignored(from_nick)){return true;}
html_handler.defchat_message_receiver.add_message(html_handler.defchat_message_receiver._format_message(message,from_nick,html_handler.room,msginfo.c,msginfo.f,msginfo.is_mod,msginfo.has_tokens,msginfo.tipped_recently,msginfo.in_fanclub,undefined,0,msginfo.tipped_alot_recently,msginfo.tipped_tons_recently),$.mydefchatconn('do_get_or_create_pm_tab_for_nick',tab_nick,true));$.mydefchatconn('do_private_message_received',tab_nick);}
return true;},on_room_user_list:function(user_list,role_list,token_list){user_list=html_handler.sanitize(user_list);role_list=html_handler.sanitize(role_list);token_list=html_handler.sanitize(token_list);if(user_list!=""){html_handler.consolelog("Received room user list. (users: "+
user_list+") (roles: "+
role_list+") "+"(tokens: "+
token_list);var users=user_list.split(',');var roles=role_list.split(',');var tokens=token_list.split(',');if(users.length==roles.length){for(var i in users){html_handler.message_inbound.user_joined_room(users[i],roles[i],tokens[i]);}}}
return true;},on_room_count_update:function(amount){amount=html_handler.sanitize(amount);$.mydefchatconn('update_viewer_count',amount);return true;},notify_goalset:function(amount,current,hightipper,hightipper_amount,lasttipper,lasttipper_amount){amount=html_handler.sanitize(amount);current=html_handler.sanitize(current);hightipper=html_handler.sanitize(hightipper);hightipper_amount=html_handler.sanitize(hightipper_amount);lasttipper=html_handler.sanitize(lasttipper);lasttipper_amount=html_handler.sanitize(lasttipper_amount);html_handler.consolelog("Received goalset notification (amount: "+
amount+") (current: "+current+") "+"(hightipper: "+hightipper+") (hightipper_amount: "+hightipper_amount+") (lasttipper: "+lasttipper+") "+"(lasttipper_amount: "+
lasttipper_amount+")");html_handler.defchat_message_receiver.on_goalset(amount,current,hightipper,hightipper_amount,lasttipper,lasttipper_amount);return true;},notify_messagechangerequest:function(subject){return true;},notify_goalcancel:function(){html_handler.consolelog("Received goalcancel notification");return true;},notify_tipalert:function(amount,from_username,to_username,message,history,index){},notify_goalreached:function(){html_handler.consolelog("Received goalreached notification");html_handler.defchat_message_receiver.on_goalreached();return true;},notify_settingsupdate:function(allow_privates,allow_groups,minimum_users_for_group_show,private_price,group_price,spy_price){allow_privates=html_handler.sanitize(allow_privates);allow_groups=html_handler.sanitize(allow_groups);minimum_users_for_group_show=html_handler.sanitize(minimum_users_for_group_show);private_price=html_handler.sanitize(private_price);group_price=html_handler.sanitize(group_price);spy_price=html_handler.sanitize(spy_price);html_handler.consolelog("Received settingsupdate notification "+"(allow_privates: "+allow_privates+") (allow_groups: "+allow_groups+") (minimum_users_for_group_show: "+minimum_users_for_group_show+") (private_price: "+private_price+") (group_price: "+group_price+") (spy_price: "+spy_price+")");html_handler.defchat_message_receiver.on_settingsupdate(allow_privates,allow_groups,minimum_users_for_group_show,private_price,group_price,spy_price);return true;},notify_privateshowrequest:function(requester_username,tokens_per_minute){requester_username=html_handler.sanitize(requester_username);tokens_per_minute=html_handler.sanitize(tokens_per_minute);html_handler.consolelog("Received privateshowrequest notification"+" (requester_username: "+
requester_username+") (tokens_per_minute"+": "+tokens_per_minute+")");html_handler.defchat_groups_and_privates.on_privateshowrequest_message(requester_username,tokens_per_minute);return true;},notify_groupshowrequest:function(users_waiting,users_required,tokens_per_minute,index)
{if(index===undefined){index=0;}
users_waiting=html_handler.sanitize(users_waiting);users_required=html_handler.sanitize(users_required);tokens_per_minute=html_handler.sanitize(tokens_per_minute);html_handler.consolelog("Received groupshowrequest notification "+"(users_waiting: "+users_waiting+") "+"(users_required: "+users_required+") (tokens_per_minute: "+
tokens_per_minute+")");html_handler.defchat_groups_and_privates.on_groupshowrequest_message(users_waiting,users_required,tokens_per_minute,index);return true;},notify_privateshowcancel:function(index){if(index===undefined){index=0;}
html_handler.consolelog("Received privateshowcancel notification");html_handler.defchat_groups_and_privates.on_privateshowrequest_cancelmessage(index);return true;},notify_groupshowcancel:function(index){if(index===undefined){index=0;}
html_handler.consolelog("Received groupshowcancel notification");html_handler.defchat_groups_and_privates.on_groupshowrequest_cancelmessage(index);return true;},notify_privateshowapprove:function(tokens_per_minute){tokens_per_minute=html_handler.sanitize(tokens_per_minute);html_handler.consolelog("Received privateshowapprove notification");html_handler.defchat_groups_and_privates.on_privateshowrequest_approvemessage(tokens_per_minute);return true;},notify_groupshowapprove:function(tokens_per_minute){tokens_per_minute=html_handler.sanitize(tokens_per_minute);html_handler.consolelog("Received groupshowapprove notification");html_handler.defchat_groups_and_privates.on_groupshowrequest_approvemessage(tokens_per_minute);return true;},notify_awaymodecancel:function(){html_handler.consolelog("Received awaymodecancel notification");html_handler.defchat_groups_and_privates.on_awaystatus_cancelmessage();return true;},notify_tokenbalanceupdate:function(usernames,token_amounts){usernames=html_handler.sanitize(usernames);token_amounts=html_handler.sanitize(token_amounts);html_handler.consolelog("Received tokenbalanceupdate notification"+" (usernames: "+usernames+") "+"(token_amounts: "+token_amounts+")");var names=usernames.split(',');var amounts=token_amounts.split(',');if(names.length!=amounts.length){html_handler.consoleerror("Unexpected names or amounts length");return;}
var user_index=$.inArray(html_handler.defchat_settings.my_username,names);if(user_index!=-1){$.mydefchatconn('do_update_token_balance',amounts[user_index]);}
return true;},notify_leaveprivateroom:function(username){username=html_handler.sanitize(username);html_handler.consolelog("Received leaveprivateroom notification "+"(username: "+username+")");html_handler.defchat_groups_and_privates.on_leaveprivateroom_message(username);return true;},notify:function(message,in_history,index){if(in_history===undefined){in_history='0';}
if(index===undefined){index=0;}
message=html_handler.sanitize(message);flash_handler.consolelog("Received notify notification "+message+" (history: "+in_history+")");var msg_info=$.parseJSON(message);if(msg_info["type"]==="purchase_notification"){html_handler.defchat_message_receiver.on_purchase_alert(msg_info["message"]);}else if(msg_info["type"]==="tip_alert"){html_handler.defchat_message_receiver.on_tipalert(msg_info["amount"],msg_info["from_username"],msg_info["to_username"],msg_info["message"],in_history=='1'?true:false,msg_info["is_mod"],msg_info["in_fanclub"],msg_info["tipped_recently"],msg_info["has_tokens"],index,msg_info["tipped_alot_recently"],msg_info["tipped_tons_recently"]);}else if(msg_info["type"]==="clear_app"){$.mydefchatconn('clear_app');}else if(msg_info["type"]==="refresh_panel"){$.mydefchatconn('update_panel');}else if(msg_info["type"]==="app_tab_refresh"){$.mydefchatconn('app_tab_refresh');}else if(msg_info["type"]==="log"){$.mydefchatconn('debuglog',msg_info['msg']);}else if(msg_info["type"]==="appnotice"){if(msg_info['to_user']){$.each(msg_info['msg'],function(i,msg){$.mydefchatconn('appprivatenotice',msg,msg_info['to_user']);});}else{$.each(msg_info['msg'],function(i,msg){$.mydefchatconn('appnotice',msg);});}}else if(msg_info["type"]==="apperrorlog"){$.mydefchatconn('apperrorlog',msg_info['msg']);}
return true;}},get_conn:function(){return null;},get_account_name:function(jid){return jid;},initializer:{attempts:0,joined:false,joined_at:null,is_on_private_room:false,leave_away_mode:function(){},join_room:function(){},change_to_private_room:function(){},leave_private_room:function(){},leave_room:function(){},on_disconnect:function(){}}};var flash_handler={flash_host:"",user:"",password:"",flash_initialized:false,room:"",room_owner_jid:"",room_owner_nick:"",defchat_message_receiver:null,defchat_settings:null,defchat_groups_and_privates:null,connecting:false,connected:false,first_connection_attempt:false,privates_and_groups_enabled:true,connect:function(flash_host,user,password,msg_receiver,room,settings,groups_and_privates){if(user.indexOf("@")!=-1){user=user.split('@')[0];}
flash_handler.defchat_settings=settings;flash_handler.defchat_message_receiver=msg_receiver;flash_handler.defchat_groups_and_privates=groups_and_privates;if(room.indexOf("@")!=-1){room=room.split("@")[0];}
flash_handler.first_connection_attempt=true;flash_handler.room=room;flash_handler.room_owner_jid=room;flash_handler.room_owner_nick=room;flash_handler.flash_host=flash_host;flash_handler.user=user;flash_handler.password=password;flash_handler.start_connection_process();},disconnect:function(){GetFlashObject("movie").DisconnectFromChat();},start_connection_process:function(){if(!flash_handler.connected&&!flash_handler.connecting){setTimeout("flash_handler.try_to_connect()",500);flash_handler.connecting=true;}},reconnect:function(){flash_handler.start_connection_process();},consolelog:function(msg){},errorlog:function(msg){if('console'in window&&'log'in window.console){console.error(msg);}},reinit:function(){flash_handler.initializer.joined=false;flash_handler.initializer.attempts=0;flash_handler.initializer.is_on_private_room=false;flash_handler.initializer.model_status="public";},connect_callbacks:{connected:function(){flash_handler.connected=true;flash_handler.connecting=false;$(document).trigger("connected.defchat");return true;},connecting:function(){if(!flash_handler.first_connection_attempt){$(document).trigger("connecting.defchat");}
return true;},disconnected:function(){flash_handler.connected=false;flash_handler.connecting=false;$(document).trigger("disconnected.defchat");return true;},failed:function(allow_reconnect){flash_handler.connected=false;flash_handler.connecting=false;if(!flash_handler.first_connection_attempt){$(document).trigger("connectionfailed.defchat");if(allow_reconnect){$.mydefchatconn('do_show_reconnect_message');setTimeout(flash_handler.reconnect,6000);}}else{setTimeout(flash_handler.reconnect,6000);}
flash_handler.first_connection_attempt=false;return true;},initialized:function(){flash_handler.flash_initialized=true;return true;}},striphtml:function(data){if(data==null){return"";}
return $('<div/>').text(data).html();},sanitize:function(data){if(data==null){return"";}
return $('<div/>').text(unescape(data)).html();},user_is_ignored:function(nick){if($.inArray(nick,flash_handler.defchat_message_receiver.ignored_users)!==-1){return true;}},message_outbound:{send_room_message:function(message,color,font){flash_handler.consolelog("User is sending message: "+message);var message=$.toJSON({"m":message,"c":color,"f":font});flash_handler.consolelog(message);GetFlashObject("movie").SendRoomMsg(message);},send_private_message:function(message,color,font,pm_nick){flash_handler.consolelog("User is sending private message to user "+
pm_nick+": "+message);var message=$.toJSON({"m":message,"c":color,"f":font});flash_handler.consolelog(message);GetFlashObject("movie").SendPrivateMsg(message,pm_nick);},send_kickban_user:function(nick){flash_handler.consolelog("User is sending kick user "+"command for "+nick);GetFlashObject("movie").SendKickMsg(nick);},send_change_title:function(title){flash_handler.consolelog("User is changing room title to "+title);$('#change_title_form_room_slug').val(flash_handler.user);$('#change_title_form_subject').val(title);$.post(flash_handler.defchat_settings.change_room_title_url,$('#change_title_form').serialize());}},try_to_connect:function(){if(!flash_handler.flash_initialized||GetFlashObject("movie")==undefined){flash_handler.connecting=false;flash_handler.start_connection_process();}
else{flash_handler.consolelog("Trying to connect to "+
flash_handler.flash_host+" with "+flash_handler.user+":"+flash_handler.password);GetFlashObject("movie").ConnectToChat(flash_handler.flash_host,flash_handler.user,flash_handler.password,flash_handler.room);}},message_inbound:{user_personally_joined_room:function(){if(!flash_handler.initializer.joined){flash_handler.initializer.joined=true;flash_handler.initializer.joined_at=new Date();if(flash_handler.user===flash_handler.room_owner_nick){if(flash_handler.defchat_settings.current_subject===""){flash_handler.message_outbound.send_change_title(flash_handler.defchat_settings.default_subject);}}}
return true;},user_personally_left_room:function(){if(!flash_handler.initializer.joined){flash_handler.initializer.joined=false;}
return true;},user_personally_kicked:function(reason){reason=flash_handler.sanitize(reason);$.mydefchatconn('do_show_kicked_message',reason);return true;},user_promoted:function(to_nick,from_nick){var to_nick=flash_handler.striphtml(to_nick);var from_nick=flash_handler.striphtml(from_nick);flash_handler.consolelog("User "+to_nick+" has been promoted"+" to moderator from participant");$.mydefchatconn('do_announce_promote',from_nick,to_nick);return true;},user_revoked:function(to_nick,from_nick){var to_nick=flash_handler.striphtml(to_nick);var from_nick=flash_handler.striphtml(from_nick);flash_handler.consolelog("User "+to_nick+" has been revoked "+"from moderator to participant");$.mydefchatconn('do_announce_revoke',from_nick,to_nick);return true;},user_silenced:function(silenced_nick,silencer_nick){silenced_nick=flash_handler.sanitize(silenced_nick);silencer_nick=flash_handler.sanitize(silencer_nick);flash_handler.consolelog("User "+silenced_nick+" has been "+"silenced by "+silencer_nick);flash_handler.defchat_message_receiver.on_user_silenced(silenced_nick,silencer_nick);return true;},user_kicked:function(nick){nick=flash_handler.sanitize(nick);flash_handler.consolelog("User "+nick+" has been "+"kick/banned from the room");flash_handler.defchat_message_receiver.on_user_banned(nick);return true;},title_changed:function(title,show_in_chat){if(show_in_chat==undefined){show_in_chat='1';}
title=flash_handler.sanitize(title);if(title==""){title=flash_handler.defchat_settings.current_subject;}
flash_handler.consolelog("Room title has been changed to "+title);flash_handler.defchat_message_receiver.on_subject_change(title,show_in_chat);return true;},on_room_message:function(nick,message){message=unescape(message);try{var msginfo=$.parseJSON(message);}catch(e){var msginfo={"m":message,'in_fanclub':false,'is_mod':false,"c":"","f":"","has_tokens":false,"tipped_recently":false,"tipped_alot_recently":false,"tipped_tons_recently":false};}
var nick=flash_handler.sanitize(nick);var message=flash_handler.striphtml(msginfo.m);flash_handler.consolelog("Room message: "+message);if($('.broadcaster_panel_away').is(':visible')){return true;}
if(nick==""){flash_handler.defchat_message_receiver.add_message('<div class="text"><p>'+message+'</p></div>');}
else{if(flash_handler.user_is_ignored(nick)){return true;}
flash_handler.defchat_message_receiver.add_message(flash_handler.defchat_message_receiver._format_message(message,nick,flash_handler.room,msginfo.c,msginfo.f,msginfo.is_mod,msginfo.has_tokens,msginfo.tipped_recently,msginfo.in_fanclub,msginfo.background,0,msginfo.tipped_alot_recently,msginfo.tipped_tons_recently));$.mydefchatconn('increment_public_tab_counter');}
return true;},on_private_message:function(from_nick,message,tab_nick){message=unescape(message);try{var msginfo=$.parseJSON(message);}catch(e){var msginfo={"m":message,'in_fanclub':false,'is_mod':false,"c":"","f":"","has_tokens":false,"tipped_recently":false,"tipped_alot_recently":false,"tipped_tons_recently":false};}
var from_nick=flash_handler.sanitize(from_nick);var message=flash_handler.striphtml(msginfo.m);var tab_nick=flash_handler.sanitize(tab_nick);if(!tab_nick||tab_nick==""){tab_nick=from_nick;}
if(from_nick==""){flash_handler.defchat_message_receiver.add_message('<div class="text"><p>'+message+'</p></div>',$.mydefchatconn('do_get_or_create_pm_tab_for_nick',tab_nick,true));}
else{if(flash_handler.user_is_ignored(from_nick)){return true;}
flash_handler.defchat_message_receiver.add_message(flash_handler.defchat_message_receiver._format_message(message,from_nick,flash_handler.room,msginfo.c,msginfo.f,msginfo.is_mod,msginfo.has_tokens,msginfo.tipped_recently,msginfo.in_fanclub,undefined,0,msginfo.tipped_alot_recently,msginfo.tipped_tons_recently),$.mydefchatconn('do_get_or_create_pm_tab_for_nick',tab_nick,true));$.mydefchatconn('do_private_message_received',tab_nick);}
return true;},on_room_user_list:function(user_list,role_list,token_list){user_list=flash_handler.sanitize(user_list);role_list=flash_handler.sanitize(role_list);token_list=flash_handler.sanitize(token_list);if(user_list!=""){flash_handler.consolelog("Received room user list. (users: "+
user_list+") (roles: "+
role_list+") "+"(tokens: "+
token_list);var users=user_list.split(',');var roles=role_list.split(',');var tokens=token_list.split(',');if(users.length==roles.length){for(var i in users){flash_handler.message_inbound.user_joined_room(users[i],roles[i],tokens[i]);}}}
return true;},on_room_count_update:function(amount){amount=flash_handler.sanitize(amount);$.mydefchatconn('update_viewer_count',amount);if(flash_handler.initializer.is_on_private_room){$('.num_users_waiting_for_group').html(amount-1);}
return true;},getNextOriginAddress:function(current_origin_address){var xhr=$.ajax({url:'/api/switch_origin/',data:{current_origin:current_origin_address},async:false});return xhr.responseText;},notify_goalset:function(amount,current,hightipper,hightipper_amount,lasttipper,lasttipper_amount){amount=flash_handler.sanitize(amount);current=flash_handler.sanitize(current);hightipper=flash_handler.sanitize(hightipper);hightipper_amount=flash_handler.sanitize(hightipper_amount);lasttipper=flash_handler.sanitize(lasttipper);lasttipper_amount=flash_handler.sanitize(lasttipper_amount);flash_handler.consolelog("Received goalset notification (amount: "+
amount+") (current: "+current+") "+"(hightipper: "+hightipper+") (hightipper_amount: "+hightipper_amount+") (lasttipper: "+lasttipper+") "+"(lasttipper_amount: "+
lasttipper_amount+")");flash_handler.defchat_message_receiver.on_goalset(amount,current,hightipper,hightipper_amount,lasttipper,lasttipper_amount);return true;},notify_messagechangerequest:function(subject){return true;},notify_goalcancel:function(){flash_handler.consolelog("Received goalcancel notification");return true;},notify_tipalert:function(amount,from_username,to_username,message,history){amount=flash_handler.sanitize(amount);from_username=flash_handler.sanitize(from_username);to_username=flash_handler.sanitize(to_username);message=flash_handler.sanitize(message);flash_handler.consolelog("Received tipalert notification (amount: "+
amount+") (from_username: "+to_username+") (to_username: "+to_username+") (message: "+message+") (history: "+
history+")");flash_handler.defchat_message_receiver.on_tipalert(amount,from_username,to_username,message,history=='1'?true:false);return true;},notify_goalreached:function(){flash_handler.consolelog("Received goalreached notification");flash_handler.defchat_message_receiver.on_goalreached();return true;},notify_settingsupdate:function(allow_privates,allow_groups,minimum_users_for_group_show){allow_privates=flash_handler.sanitize(allow_privates);allow_groups=flash_handler.sanitize(allow_groups);minimum_users_for_group_show=flash_handler.sanitize(minimum_users_for_group_show);flash_handler.consolelog("Received settingsupdate notification "+"(allow_privates: "+allow_privates+") (allow_groups: "+allow_groups+") (minimum_users_for_group_show: "+
minimum_users_for_group_show+")");flash_handler.defchat_message_receiver.on_settingsupdate(allow_privates,allow_groups,minimum_users_for_group_show);return true;},notify_privateshowrequest:function(requester_username,tokens_per_minute){requester_username=flash_handler.sanitize(requester_username);tokens_per_minute=flash_handler.sanitize(tokens_per_minute);flash_handler.consolelog("Received privateshowrequest notification"+" (requester_username: "+
requester_username+") (tokens_per_minute"+": "+tokens_per_minute+")");flash_handler.defchat_groups_and_privates.on_privateshowrequest_message(requester_username,tokens_per_minute);return true;},notify_groupshowrequest:function(users_waiting,users_required,tokens_per_minute){users_waiting=flash_handler.sanitize(users_waiting);users_required=flash_handler.sanitize(users_required);tokens_per_minute=flash_handler.sanitize(tokens_per_minute);flash_handler.consolelog("Received groupshowrequest notification "+"(users_waiting: "+users_waiting+") "+"(users_required: "+users_required+") (tokens_per_minute: "+
tokens_per_minute+")");flash_handler.defchat_groups_and_privates.on_groupshowrequest_message(users_waiting,users_required,tokens_per_minute);return true;},notify_privateshowcancel:function(){flash_handler.consolelog("Received privateshowcancel notification");flash_handler.defchat_groups_and_privates.on_privateshowrequest_cancelmessage();return true;},notify_groupshowcancel:function(){flash_handler.consolelog("Received groupshowcancel notification");flash_handler.defchat_groups_and_privates.on_groupshowrequest_cancelmessage();return true;},notify_privateshowapprove:function(tokens_per_minute){tokens_per_minute=flash_handler.sanitize(tokens_per_minute);flash_handler.consolelog("Received privateshowapprove notification");flash_handler.defchat_groups_and_privates.on_privateshowrequest_approvemessage(tokens_per_minute);return true;},notify_groupshowapprove:function(tokens_per_minute){tokens_per_minute=flash_handler.sanitize(tokens_per_minute);flash_handler.consolelog("Received groupshowapprove notification");flash_handler.defchat_groups_and_privates.on_groupshowrequest_approvemessage(tokens_per_minute);return true;},notify_awaymodecancel:function(){flash_handler.consolelog("Received awaymodecancel notification");flash_handler.defchat_groups_and_privates.on_awaystatus_cancelmessage();return true;},notify_tokenbalanceupdate:function(usernames,token_amounts){usernames=flash_handler.sanitize(usernames);token_amounts=flash_handler.sanitize(token_amounts);flash_handler.consolelog("Received tokenbalanceupdate notification"+" (usernames: "+usernames+") "+"(token_amounts: "+token_amounts+")");var names=usernames.split(',');var amounts=token_amounts.split(',');if(names.length!=amounts.length){flash_handler.consoleerror("Unexpected names or amounts length");return;}
var user_index=$.inArray(flash_handler.defchat_settings.my_username,names);if(user_index!=-1){$.mydefchatconn('do_update_token_balance',amounts[user_index]);}
return true;},notify_leaveprivateroom:function(username){username=flash_handler.sanitize(username);flash_handler.consolelog("Received leaveprivateroom notification "+"(username: "+username+")");flash_handler.defchat_groups_and_privates.on_leaveprivateroom_message(username);return true;},notify:function(message,in_history){message=flash_handler.sanitize(message);flash_handler.consolelog("Received notify notification "+message+" (history: "+in_history+")");var msg_info=$.parseJSON(message);if(msg_info["type"]==="purchase_notification"){flash_handler.defchat_message_receiver.on_purchase_alert(msg_info["message"]);}else if(msg_info["type"]==="tip_alert"){flash_handler.defchat_message_receiver.on_tipalert(msg_info["amount"],msg_info["from_username"],msg_info["to_username"],msg_info["message"],in_history=='1'?true:false,msg_info["is_mod"],msg_info["in_fanclub"],msg_info["tipped_recently"],msg_info["has_tokens"],0,msg_info["tipped_alot_recently"],msg_info["tipped_tons_recently"]);}else if(msg_info["type"]==="clear_app"){$.mydefchatconn('clear_app');}else if(msg_info["type"]==="room_entry"){$.mydefchatconn('room_entry',msg_info['username'],msg_info["is_mod"],msg_info["in_fanclub"],msg_info["tipped_recently"],msg_info["has_tokens"],msg_info["tipped_alot_recently"],msg_info["tipped_tons_recently"]);}else if(msg_info["type"]==="room_leave"){$.mydefchatconn('room_leave',msg_info['username'],msg_info["is_mod"],msg_info["in_fanclub"],msg_info["tipped_recently"],msg_info["has_tokens"],msg_info["tipped_alot_recently"],msg_info["tipped_tons_recently"]);}else if(msg_info["type"]==="refresh_panel"){$.mydefchatconn('update_panel');}else if(msg_info["type"]==="app_tab_refresh"){$.mydefchatconn('app_tab_refresh');}else if(msg_info["type"]==="log"){$.mydefchatconn('debuglog',msg_info['msg']);}else if(msg_info["type"]==="appnotice"){if(msg_info["background"]===undefined){msg_info["background"]="#FFFFFF";}
if(msg_info["foreground"]===undefined){msg_info["foreground"]="#000000";}
if(msg_info["weight"]===undefined){msg_info["weight"]="normal";}
if(msg_info['to_user']){$.each(msg_info['msg'],function(i,msg){$.mydefchatconn('appprivatenotice',msg,msg_info['to_user'],msg_info["background"],msg_info["foreground"],msg_info["weight"]);});}else{$.each(msg_info['msg'],function(i,msg){$.mydefchatconn('appnotice',msg,msg_info["background"],msg_info["foreground"],msg_info["weight"]);});}}else if(msg_info["type"]==="apperrorlog"){$.mydefchatconn('apperrorlog',msg_info['msg']);}else if(msg_info["type"]==="settingsupdate"){flash_handler.defchat_message_receiver.on_settingsupdate(msg_info['allow_privates'],msg_info['allow_groups'],msg_info['minimum_users_for_group_show'],msg_info['private_price'],msg_info['group_price'],msg_info['spy_price']);}
return true;}},get_conn:function(){return null;},get_account_name:function(jid){return jid;},initializer:{attempts:0,joined:false,joined_at:null,is_on_private_room:false,model_status:"public",is_broadcasting:false,broadcasting_started:function(){flash_handler.initializer.is_broadcasting=true;},broadcasting_stopped:function(){flash_handler.initializer.is_broadcasting=false;},am_i_broadcasting:function(){return flash_handler.initializer.is_broadcasting;},get_model_status:function(){return flash_handler.initializer.model_status;},retry_join_room:function(){if(flash_handler.initializer.attempts>0){flash_handler.defchat_settings.muc_nickname+='_';}
if(flash_handler.attempts>=5){flash_handler.consolelog("Too many failed attempts, "+"disconnecting");flash_handler.get_conn().disconnect();}
return flash_handler.join_room();},join_room:function(){flash_handler.attempts+=1;if(flash_handler.initializer.is_on_private_room){flash_handler.consolelog("Joining private room for model "+
flash_handler.room+" with "+
flash_handler.defchat_settings.muc_nickname+" and "+
flash_handler.defchat_settings.token_balance+" tokens");GetFlashObject("movie").JoinPrivateRoom(flash_handler.defchat_settings.token_balance);$("#id_tip_room_type").val("private");}
else{flash_handler.consolelog("Joining public room for model "+
flash_handler.room+" with "+
flash_handler.defchat_settings.muc_nickname+" and "+
flash_handler.defchat_settings.token_balance+" tokens");GetFlashObject("movie").JoinRoom(flash_handler.defchat_settings.token_balance);$("#id_tip_room_type").val("public");}},change_to_private_room:function(isGroupShow){if(flash_handler.initializer.is_on_private_room){return;}
flash_handler.defchat_message_receiver.ignore_delayed=true;flash_handler.initializer.leave_room();flash_handler.initializer.attempts=4;flash_handler.initializer.is_on_private_room=true;flash_handler.initializer.model_status=isGroupShow?"group":"private";flash_handler.initializer.join_room();},leave_private_room:function(){if(!flash_handler.initializer.is_on_private_room){return;}
flash_handler.initializer.leave_room();flash_handler.initializer.attempts=4;flash_handler.initializer.is_on_private_room=false;flash_handler.initializer.model_status="away";flash_handler.initializer.join_room();},leave_away_mode:function(){flash_handler.initializer.model_status="public";},leave_room:function(){flash_handler.consolelog("Leaving room "+flash_handler.room);GetFlashObject("movie").LeaveRoom();},on_disconnect:function(){var isOnPrivateRoom=flash_handler.initializer.is_on_private_room;var modelStatus=flash_handler.initializer.model_status;var isBroadcasting=flash_handler.initializer.is_broadcasting;flash_handler.reinit();flash_handler.initializer.is_broadcasting=isBroadcasting;if(flash_handler.initializer.is_broadcasting){flash_handler.initializer.is_on_private_room=isOnPrivateRoom;flash_handler.initializer.model_status=modelStatus;}}}};function HasFlash(){if(swfobject.getFlashPlayerVersion().major<=0){return false;}
return true;}
function GetFlashVersion(){var version=swfobject.getFlashPlayerVersion();return""+version.major+"."+version.minor+"."+version.release;}
function GetUserAgent(){return navigator.userAgent;}
function EmbedBroadcasterSwf(swfname,modelname,fms_address,language,express,pt,captureurl,pk,pe,ea,dom,pw,sa,tv)
{var version=swfobject.getFlashPlayerVersion();var is_flash11="0";if((version.major==11&&version.minor>=0&&version.release>=1)||version.major>=12)
is_flash11="1";var params={allowScriptAccess:"always",allowFullScreen:"false",quality:"high",wmode:"direct",id:"movie",FlashVars:"pid="+modelname+"&address="+fms_address+"&language="+language+"&pt="+pt+"&captureurl="+captureurl+"&pk="+pk+"&pe="+pe+"&ea="+ea+"&dom="+dom+"&pw="+pw+"&i11="+is_flash11+"&sa="+sa+"&tv="+tv};if(!document.getElementById('movie')){return;}
document.getElementById('movie').innerHTML="<center><br><br><br><br><a border='0' href='http://www.adobe.com/go/getflashplayer' target='_blank'>"+"<img alt='Get Adobe Flash player' src='"+MEDIA_URL+"images/160x41_Get_Flash_Player.jpg'></a><br>"+"We've detected that you are missing the latest version of Flash Player.<br>"+"This version of the Chaturbate Broadcaster requires Flash Player 10.2.0 or later.<br>"+"<a href='http://www.adobe.com/go/getflashplayer'>"+"Click here to update your Flash Player for free.</a></center>";if(is_firefox_10_mac()){swfobject.embedSWF(swfname,'movie',"97%","97%","10.2.0",null,"",params);}
else{swfobject.embedSWF(swfname,'movie',"100%","100%","10.2.0",null,"",params);}}
function EmbedViewerSwf(swfname,modelname,fms_address,language,mute,pr,sa,express,uid,jg,jp,js,ws,elu,dom,pw,rp,tv,cv,headless)
{var params={allowScriptAccess:"always",allowFullScreen:"true",quality:"high",wmode:"opaque",id:"movie",scale:'noborder',FlashVars:"pid="+modelname+"&address="+fms_address+"&language="+language+"&mute="+mute+"&pr="+pr+"&sa="+sa+"&uid="+uid+"&jg="+jg+"&jp="+jp+"&js="+js+"&elu="+elu+"&dom="+dom+"&pw="+pw+"&rp="+rp+"&tv="+tv+"&cv="+cv+"&headless="+headless};if(!document.getElementById('movie')){return;}
document.getElementById('movie').innerHTML="<center><br><br><br><br><a border='0' href='http://www.adobe.com/go/getflashplayer' target='_blank'>"+"<img alt='Get Adobe Flash player' src='"+MEDIA_URL+"images/160x41_Get_Flash_Player.jpg'></a><br>"+"We've detected that you are missing the latest version of Flash Player.<br>"+"This version of the Chaturbate Viewer requires Flash Player 10.2.0 or later.<br>"+"<a href='http://www.adobe.com/go/getflashplayer'>"+"Click here to update your Flash Player for free.</a></center>";var swfVersionStr="10.2.0";var attributes={};attributes.id="xmovie";attributes.name="movie";attributes.align="middle";swfobject.embedSWF(swfname,"movie","100%","100%",swfVersionStr,null,null,params,attributes);swfobject.createCSS("#movie","display:block;text-align:left;");if(typeof(resizable_player)!="undefined"){resizable_player.init(ws=="1");}}
function SwfScale(width)
{var swfwidth=parseInt(width);var swfheight=swfwidth*0.75;document.getElementById("player").style.width=swfwidth+"px";document.getElementById("player").style.height=swfheight+"px";}
function GetFlashObject(movieName)
{var isIE=navigator.appName.indexOf("Microsoft")!=-1;return(isIE)?window[movieName]:document[movieName];}
function PlayBeep(level)
{if(GetFlashObject('movie')!=undefined){GetFlashObject('movie').PlayBeep(level);}}
function SetTipVolume(level)
{if(GetFlashObject('movie')!=undefined){GetFlashObject('movie').SetTipVol(level);}}
function is_firefox_10_mac(){var is_firefox=navigator.userAgent.indexOf("Firefox/10")!=-1;var is_mac=navigator.userAgent.indexOf("Mac OS")!=-1;return is_firefox&&is_mac;}
var swfobject=function(){var UNDEF="undefined",OBJECT="object",SHOCKWAVE_FLASH="Shockwave Flash",SHOCKWAVE_FLASH_AX="ShockwaveFlash.ShockwaveFlash",FLASH_MIME_TYPE="application/x-shockwave-flash",EXPRESS_INSTALL_ID="SWFObjectExprInst",ON_READY_STATE_CHANGE="onreadystatechange",win=window,doc=document,nav=navigator,plugin=false,domLoadFnArr=[main],regObjArr=[],objIdArr=[],listenersArr=[],storedAltContent,storedAltContentId,storedCallbackFn,storedCallbackObj,isDomLoaded=false,isExpressInstallActive=false,dynamicStylesheet,dynamicStylesheetMedia,autoHideShow=true,ua=function(){var w3cdom=typeof doc.getElementById!=UNDEF&&typeof doc.getElementsByTagName!=UNDEF&&typeof doc.createElement!=UNDEF,u=nav.userAgent.toLowerCase(),p=nav.platform.toLowerCase(),windows=p?/win/.test(p):/win/.test(u),mac=p?/mac/.test(p):/mac/.test(u),webkit=/webkit/.test(u)?parseFloat(u.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,ie=!+"\v1",playerVersion=[0,0,0],d=null;if(typeof nav.plugins!=UNDEF&&typeof nav.plugins[SHOCKWAVE_FLASH]==OBJECT){d=nav.plugins[SHOCKWAVE_FLASH].description;if(d&&!(typeof nav.mimeTypes!=UNDEF&&nav.mimeTypes[FLASH_MIME_TYPE]&&!nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)){plugin=true;ie=false;d=d.replace(/^.*\s+(\S+\s+\S+$)/,"$1");playerVersion[0]=parseInt(d.replace(/^(.*)\..*$/,"$1"),10);playerVersion[1]=parseInt(d.replace(/^.*\.(.*)\s.*$/,"$1"),10);playerVersion[2]=/[a-zA-Z]/.test(d)?parseInt(d.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0;}}
else if(typeof win.ActiveXObject!=UNDEF){try{var a=new ActiveXObject(SHOCKWAVE_FLASH_AX);if(a){d=a.GetVariable("$version");if(d){ie=true;d=d.split(" ")[1].split(",");playerVersion=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)];}}}
catch(e){}}
return{w3:w3cdom,pv:playerVersion,wk:webkit,ie:ie,win:windows,mac:mac};}(),onDomLoad=function(){if(!ua.w3){return;}
if((typeof doc.readyState!=UNDEF&&doc.readyState=="complete")||(typeof doc.readyState==UNDEF&&(doc.getElementsByTagName("body")[0]||doc.body))){callDomLoadFunctions();}
if(!isDomLoaded){if(typeof doc.addEventListener!=UNDEF){doc.addEventListener("DOMContentLoaded",callDomLoadFunctions,false);}
if(ua.ie&&ua.win){doc.attachEvent(ON_READY_STATE_CHANGE,function(){if(doc.readyState=="complete"){doc.detachEvent(ON_READY_STATE_CHANGE,arguments.callee);callDomLoadFunctions();}});if(win==top){(function(){if(isDomLoaded){return;}
try{doc.documentElement.doScroll("left");}
catch(e){setTimeout(arguments.callee,0);return;}
callDomLoadFunctions();})();}}
if(ua.wk){(function(){if(isDomLoaded){return;}
if(!/loaded|complete/.test(doc.readyState)){setTimeout(arguments.callee,0);return;}
callDomLoadFunctions();})();}
addLoadEvent(callDomLoadFunctions);}}();function callDomLoadFunctions(){if(isDomLoaded){return;}
try{var t=doc.getElementsByTagName("body")[0].appendChild(createElement("span"));t.parentNode.removeChild(t);}
catch(e){return;}
isDomLoaded=true;var dl=domLoadFnArr.length;for(var i=0;i<dl;i++){domLoadFnArr[i]();}}
function addDomLoadEvent(fn){if(isDomLoaded){fn();}
else{domLoadFnArr[domLoadFnArr.length]=fn;}}
function addLoadEvent(fn){if(typeof win.addEventListener!=UNDEF){win.addEventListener("load",fn,false);}
else if(typeof doc.addEventListener!=UNDEF){doc.addEventListener("load",fn,false);}
else if(typeof win.attachEvent!=UNDEF){addListener(win,"onload",fn);}
else if(typeof win.onload=="function"){var fnOld=win.onload;win.onload=function(){fnOld();fn();};}
else{win.onload=fn;}}
function main(){if(plugin){testPlayerVersion();}
else{matchVersions();}}
function testPlayerVersion(){var b=doc.getElementsByTagName("body")[0];var o=createElement(OBJECT);o.setAttribute("type",FLASH_MIME_TYPE);var t=b.appendChild(o);if(t){var counter=0;(function(){if(typeof t.GetVariable!=UNDEF){var d=t.GetVariable("$version");if(d){d=d.split(" ")[1].split(",");ua.pv=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)];}}
else if(counter<10){counter++;setTimeout(arguments.callee,10);return;}
b.removeChild(o);t=null;matchVersions();})();}
else{matchVersions();}}
function matchVersions(){var rl=regObjArr.length;if(rl>0){for(var i=0;i<rl;i++){var id=regObjArr[i].id;var cb=regObjArr[i].callbackFn;var cbObj={success:false,id:id};if(ua.pv[0]>0){var obj=getElementById(id);if(obj){if(hasPlayerVersion(regObjArr[i].swfVersion)&&!(ua.wk&&ua.wk<312)){setVisibility(id,true);if(cb){cbObj.success=true;cbObj.ref=getObjectById(id);cb(cbObj);}}
else if(regObjArr[i].expressInstall&&canExpressInstall()){var att={};att.data=regObjArr[i].expressInstall;att.width=obj.getAttribute("width")||"0";att.height=obj.getAttribute("height")||"0";if(obj.getAttribute("class")){att.styleclass=obj.getAttribute("class");}
if(obj.getAttribute("align")){att.align=obj.getAttribute("align");}
var par={};var p=obj.getElementsByTagName("param");var pl=p.length;for(var j=0;j<pl;j++){if(p[j].getAttribute("name").toLowerCase()!="movie"){par[p[j].getAttribute("name")]=p[j].getAttribute("value");}}
showExpressInstall(att,par,id,cb);}
else{displayAltContent(obj);if(cb){cb(cbObj);}}}}
else{setVisibility(id,true);if(cb){var o=getObjectById(id);if(o&&typeof o.SetVariable!=UNDEF){cbObj.success=true;cbObj.ref=o;}
cb(cbObj);}}}}}
function getObjectById(objectIdStr){var r=null;var o=getElementById(objectIdStr);if(o&&o.nodeName=="OBJECT"){if(typeof o.SetVariable!=UNDEF){r=o;}
else{var n=o.getElementsByTagName(OBJECT)[0];if(n){r=n;}}}
return r;}
function canExpressInstall(){return!isExpressInstallActive&&hasPlayerVersion("6.0.65")&&(ua.win||ua.mac)&&!(ua.wk&&ua.wk<312);}
function showExpressInstall(att,par,replaceElemIdStr,callbackFn){isExpressInstallActive=true;storedCallbackFn=callbackFn||null;storedCallbackObj={success:false,id:replaceElemIdStr};var obj=getElementById(replaceElemIdStr);if(obj){if(obj.nodeName=="OBJECT"){storedAltContent=abstractAltContent(obj);storedAltContentId=null;}
else{storedAltContent=obj;storedAltContentId=replaceElemIdStr;}
att.id=EXPRESS_INSTALL_ID;if(typeof att.width==UNDEF||(!/%$/.test(att.width)&&parseInt(att.width,10)<310)){att.width="310";}
if(typeof att.height==UNDEF||(!/%$/.test(att.height)&&parseInt(att.height,10)<137)){att.height="137";}
doc.title=doc.title.slice(0,47)+" - Flash Player Installation";var pt=ua.ie&&ua.win?"ActiveX":"PlugIn",fv="MMredirectURL="+encodeURI(window.location).toString().replace(/&/g,"%26")+"&MMplayerType="+pt+"&MMdoctitle="+doc.title;if(typeof par.flashvars!=UNDEF){par.flashvars+="&"+fv;}
else{par.flashvars=fv;}
if(ua.ie&&ua.win&&obj.readyState!=4){var newObj=createElement("div");replaceElemIdStr+="SWFObjectNew";newObj.setAttribute("id",replaceElemIdStr);obj.parentNode.insertBefore(newObj,obj);obj.style.display="none";(function(){if(obj.readyState==4){obj.parentNode.removeChild(obj);}
else{setTimeout(arguments.callee,10);}})();}
createSWF(att,par,replaceElemIdStr);}}
function displayAltContent(obj){if(ua.ie&&ua.win&&obj.readyState!=4){var el=createElement("div");obj.parentNode.insertBefore(el,obj);el.parentNode.replaceChild(abstractAltContent(obj),el);obj.style.display="none";(function(){if(obj.readyState==4){obj.parentNode.removeChild(obj);}
else{setTimeout(arguments.callee,10);}})();}
else{obj.parentNode.replaceChild(abstractAltContent(obj),obj);}}
function abstractAltContent(obj){var ac=createElement("div");if(ua.win&&ua.ie){ac.innerHTML=obj.innerHTML;}
else{var nestedObj=obj.getElementsByTagName(OBJECT)[0];if(nestedObj){var c=nestedObj.childNodes;if(c){var cl=c.length;for(var i=0;i<cl;i++){if(!(c[i].nodeType==1&&c[i].nodeName=="PARAM")&&!(c[i].nodeType==8)){ac.appendChild(c[i].cloneNode(true));}}}}}
return ac;}
function createSWF(attObj,parObj,id){var r,el=getElementById(id);if(ua.wk&&ua.wk<312){return r;}
if(el){if(typeof attObj.id==UNDEF){attObj.id=id;}
if(ua.ie&&ua.win){var att="";for(var i in attObj){if(attObj[i]!=Object.prototype[i]){if(i.toLowerCase()=="data"){parObj.movie=attObj[i];}
else if(i.toLowerCase()=="styleclass"){att+=' class="'+attObj[i]+'"';}
else if(i.toLowerCase()!="classid"){att+=' '+i+'="'+attObj[i]+'"';}}}
var par="";for(var j in parObj){if(parObj[j]!=Object.prototype[j]){par+='<param name="'+j+'" value="'+parObj[j]+'" />';}}
el.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+att+'>'+par+'</object>';objIdArr[objIdArr.length]=attObj.id;r=getElementById(attObj.id);}
else{var o=createElement(OBJECT);o.setAttribute("type",FLASH_MIME_TYPE);for(var m in attObj){if(attObj[m]!=Object.prototype[m]){if(m.toLowerCase()=="styleclass"){o.setAttribute("class",attObj[m]);}
else if(m.toLowerCase()!="classid"){o.setAttribute(m,attObj[m]);}}}
for(var n in parObj){if(parObj[n]!=Object.prototype[n]&&n.toLowerCase()!="movie"){createObjParam(o,n,parObj[n]);}}
el.parentNode.replaceChild(o,el);r=o;}}
return r;}
function createObjParam(el,pName,pValue){var p=createElement("param");p.setAttribute("name",pName);p.setAttribute("value",pValue);el.appendChild(p);}
function removeSWF(id){var obj=getElementById(id);if(obj&&obj.nodeName=="OBJECT"){if(ua.ie&&ua.win){obj.style.display="none";(function(){if(obj.readyState==4){removeObjectInIE(id);}
else{setTimeout(arguments.callee,10);}})();}
else{obj.parentNode.removeChild(obj);}}}
function removeObjectInIE(id){var obj=getElementById(id);if(obj){for(var i in obj){if(typeof obj[i]=="function"){obj[i]=null;}}
obj.parentNode.removeChild(obj);}}
function getElementById(id){var el=null;try{el=doc.getElementById(id);}
catch(e){}
return el;}
function createElement(el){return doc.createElement(el);}
function addListener(target,eventType,fn){target.attachEvent(eventType,fn);listenersArr[listenersArr.length]=[target,eventType,fn];}
function hasPlayerVersion(rv){var pv=ua.pv,v=rv.split(".");v[0]=parseInt(v[0],10);v[1]=parseInt(v[1],10)||0;v[2]=parseInt(v[2],10)||0;return(pv[0]>v[0]||(pv[0]==v[0]&&pv[1]>v[1])||(pv[0]==v[0]&&pv[1]==v[1]&&pv[2]>=v[2]))?true:false;}
function createCSS(sel,decl,media,newStyle){if(ua.ie&&ua.mac){return;}
var h=doc.getElementsByTagName("head")[0];if(!h){return;}
var m=(media&&typeof media=="string")?media:"screen";if(newStyle){dynamicStylesheet=null;dynamicStylesheetMedia=null;}
if(!dynamicStylesheet||dynamicStylesheetMedia!=m){var s=createElement("style");s.setAttribute("type","text/css");s.setAttribute("media",m);dynamicStylesheet=h.appendChild(s);if(ua.ie&&ua.win&&typeof doc.styleSheets!=UNDEF&&doc.styleSheets.length>0){dynamicStylesheet=doc.styleSheets[doc.styleSheets.length-1];}
dynamicStylesheetMedia=m;}
if(ua.ie&&ua.win){if(dynamicStylesheet&&typeof dynamicStylesheet.addRule==OBJECT){dynamicStylesheet.addRule(sel,decl);}}
else{if(dynamicStylesheet&&typeof doc.createTextNode!=UNDEF){dynamicStylesheet.appendChild(doc.createTextNode(sel+" {"+decl+"}"));}}}
function setVisibility(id,isVisible){if(!autoHideShow){return;}
var v=isVisible?"visible":"hidden";if(isDomLoaded&&getElementById(id)){getElementById(id).style.visibility=v;}
else{createCSS("#"+id,"visibility:"+v);}}
function urlEncodeIfNecessary(s){var regex=/[\\\"<>\.;]/;var hasBadChars=regex.exec(s)!=null;return hasBadChars&&typeof encodeURIComponent!=UNDEF?encodeURIComponent(s):s;}
var cleanup=function(){if(ua.ie&&ua.win){window.attachEvent("onunload",function(){var ll=listenersArr.length;for(var i=0;i<ll;i++){listenersArr[i][0].detachEvent(listenersArr[i][1],listenersArr[i][2]);}
var il=objIdArr.length;for(var j=0;j<il;j++){removeSWF(objIdArr[j]);}
for(var k in ua){ua[k]=null;}
ua=null;for(var l in swfobject){swfobject[l]=null;}
swfobject=null;});}}();return{registerObject:function(objectIdStr,swfVersionStr,xiSwfUrlStr,callbackFn){if(ua.w3&&objectIdStr&&swfVersionStr){var regObj={};regObj.id=objectIdStr;regObj.swfVersion=swfVersionStr;regObj.expressInstall=xiSwfUrlStr;regObj.callbackFn=callbackFn;regObjArr[regObjArr.length]=regObj;setVisibility(objectIdStr,false);}
else if(callbackFn){callbackFn({success:false,id:objectIdStr});}},getObjectById:function(objectIdStr){if(ua.w3){return getObjectById(objectIdStr);}},embedSWF:function(swfUrlStr,replaceElemIdStr,widthStr,heightStr,swfVersionStr,xiSwfUrlStr,flashvarsObj,parObj,attObj,callbackFn){var callbackObj={success:false,id:replaceElemIdStr};if(ua.w3&&!(ua.wk&&ua.wk<312)&&swfUrlStr&&replaceElemIdStr&&widthStr&&heightStr&&swfVersionStr){setVisibility(replaceElemIdStr,false);addDomLoadEvent(function(){widthStr+="";heightStr+="";var att={};if(attObj&&typeof attObj===OBJECT){for(var i in attObj){att[i]=attObj[i];}}
att.data=swfUrlStr;att.width=widthStr;att.height=heightStr;var par={};if(parObj&&typeof parObj===OBJECT){for(var j in parObj){par[j]=parObj[j];}}
if(flashvarsObj&&typeof flashvarsObj===OBJECT){for(var k in flashvarsObj){if(typeof par.flashvars!=UNDEF){par.flashvars+="&"+k+"="+flashvarsObj[k];}
else{par.flashvars=k+"="+flashvarsObj[k];}}}
if(hasPlayerVersion(swfVersionStr)){var obj=createSWF(att,par,replaceElemIdStr);if(att.id==replaceElemIdStr){setVisibility(replaceElemIdStr,true);}
callbackObj.success=true;callbackObj.ref=obj;}
else if(xiSwfUrlStr&&canExpressInstall()){att.data=xiSwfUrlStr;showExpressInstall(att,par,replaceElemIdStr,callbackFn);return;}
else{setVisibility(replaceElemIdStr,true);}
if(callbackFn){callbackFn(callbackObj);}});}
else if(callbackFn){callbackFn(callbackObj);}},switchOffAutoHideShow:function(){autoHideShow=false;},ua:ua,getFlashPlayerVersion:function(){return{major:ua.pv[0],minor:ua.pv[1],release:ua.pv[2]};},hasFlashPlayerVersion:hasPlayerVersion,createSWF:function(attObj,parObj,replaceElemIdStr){if(ua.w3){return createSWF(attObj,parObj,replaceElemIdStr);}
else{return undefined;}},showExpressInstall:function(att,par,replaceElemIdStr,callbackFn){if(ua.w3&&canExpressInstall()){showExpressInstall(att,par,replaceElemIdStr,callbackFn);}},removeSWF:function(objElemIdStr){if(ua.w3){removeSWF(objElemIdStr);}},createCSS:function(selStr,declStr,mediaStr,newStyleBoolean){if(ua.w3){createCSS(selStr,declStr,mediaStr,newStyleBoolean);}},addDomLoadEvent:addDomLoadEvent,addLoadEvent:addLoadEvent,getQueryParamValue:function(param){var q=doc.location.search||doc.location.hash;if(q){if(/\?/.test(q)){q=q.split("?")[1];}
if(param==null){return urlEncodeIfNecessary(q);}
var pairs=q.split("&");for(var i=0;i<pairs.length;i++){if(pairs[i].substring(0,pairs[i].indexOf("="))==param){return urlEncodeIfNecessary(pairs[i].substring((pairs[i].indexOf("=")+1)));}}}
return"";},expressInstallCallback:function(){if(isExpressInstallActive){var obj=getElementById(EXPRESS_INSTALL_ID);if(obj&&storedAltContent){obj.parentNode.replaceChild(storedAltContent,obj);if(storedAltContentId){setVisibility(storedAltContentId,true);if(ua.ie&&ua.win){storedAltContent.style.display="block";}}
if(storedCallbackFn){storedCallbackFn(storedCallbackObj);}}
isExpressInstallActive=false;}}};}();function play_html_sounds(tipAmount,volumeLevel){if(HasFlash()){return;}
if(getiOSversion()>=7.0){play_html_sound_level(parseInt(tipAmount),volumeLevel);}}
function play_html_sound_level(amount,volumeLevel){var snd=new Audio("/static/sounds/tiny.mp3");if(amount>=1000){snd=new Audio("/static/sounds/huge.mp3");}
else if(amount>=500){snd=new Audio("/static/sounds/large.mp3");}
else if(amount>=100){snd=new Audio("/static/sounds/medium.mp3");}
else if(amount>=15){snd=new Audio("/static/sounds/small.mp3");}
var number=getTipVolumeLevelFromSetting(parseInt(volumeLevel));if(number>0.0){snd.volume=number;snd.play();}}
function getiOSversion(){return parseFloat((''+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,''])[1]).replace('undefined','3_2').replace('_','.').replace('_',''))||9.0;}
function getTipVolumeLevelFromSetting(volumeLevel){if((volumeLevel===undefined)||(volumeLevel>100)||(volumeLevel<0)){return 0.1;}
if(volumeLevel===100){return(1).toFixed(1);}
var audioLevel=volumeLevel/100;if(audioLevel===0){return 0.0;}else{return audioLevel;}}
function isLocalStorageNameSupported(){var testKey='test',storage=window.sessionStorage;try{storage.setItem(testKey,'1');storage.removeItem(testKey);return true;}catch(error){return false;}}
function audio_volume_persist_handle(){if(isLocalStorageNameSupported()){persist_volume_html5_webstorage();}else{persist_volume_cookie();}}
function persist_volume_html5_webstorage(){var vidPlayer=document.getElementById("still_video_object");var volKey='volPlayer';if(vidPlayer!=null){vidPlayer.onvolumechange=function(){if(vidPlayer.muted){sessionStorage.setItem(volKey,0.0);}else{sessionStorage.setItem(volKey,vidPlayer.volume);}
return;};}
var volumeSetFromPlayer=sessionStorage.getItem(volKey);if((volumeSetFromPlayer===null)||(volumeSetFromPlayer=='undefined')){sessionStorage.setItem(volKey,1);return;}
if(volumeSetFromPlayer!=null&&vidPlayer!=null){vidPlayer.volume=parseFloat(volumeSetFromPlayer).toFixed(1);sessionStorage.removeItem(volKey);}}
function persist_volume_cookie(){var vidPlayer=document.getElementById("still_video_object");var name='volPlayer';if(vidPlayer!=null){vidPlayer.onvolumechange=function(){if(vidPlayer.muted){$.cookie(name,0.0,{expires:30,path:'/'});}else{$.cookie(name,vidPlayer.volume,{expires:30,path:'/'});}
return;};}
var volumeSetFromPlayer=$.cookie(name);if((volumeSetFromPlayer===null)||(volumeSetFromPlayer=='undefined')){$.cookie(name,1.0,{expires:30,path:'/'});return;}
if(volumeSetFromPlayer!=null&&vidPlayer!=null){vidPlayer.volume=parseFloat(volumeSetFromPlayer).toFixed(1);}
return;}